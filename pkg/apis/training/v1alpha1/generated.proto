/**
*
* Copyright (C) 2017 modela authors
* For license information, see LICENSE.txt
*/
// This file was autogenerated by go-to-protobuf. Do not edit it manually!

syntax = "proto2";

package github.com.metaprov.modelaapi.pkg.apis.training.v1alpha1;

import "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1/generated.proto";
import "github.com/metaprov/modelaapi/pkg/apis/data/v1alpha1/generated.proto";
import "k8s.io/api/core/v1/generated.proto";
import "k8s.io/apimachinery/pkg/apis/meta/v1/generated.proto";
import "k8s.io/apimachinery/pkg/runtime/generated.proto";
import "k8s.io/apimachinery/pkg/runtime/schema/generated.proto";

// Package-wide variables from generator "generated".
option go_package = "github.com/metaprov/modelaapi/pkg/apis/training/v1alpha1";

// AlgorithmParameterRange defines a custom hyperparameter range for a single algorithm
message AlgorithmParameterRange {
  // Name specifies the name of the algorithm to override
  // +kubebuilder:validation:Optional
  optional string name = 1;

  // Ranges contain the collection of hyperparameter ranges to override
  // +kubebuilder:validation:Optional
  repeated github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ParameterRange ranges = 2;
}

// AlgorithmSearchSpaceSpec defines the algorithms available to models produced by a Study
message AlgorithmSearchSpaceSpec {
  // Which algorithm to include
  // If empty, all algorithms will be available for training
  // +kubebuilder:validation:Optional
  repeated string include = 1;

  // Which algorithm to exclude
  // If empty, all algorithms will be available for training
  // +kubebuilder:validation:Optional
  repeated string exclude = 2;

  // Custom specifies custom hyperparameter ranges for specific algorithms
  // +kubebuilder:validation:Optional
  repeated AlgorithmParameterRange custom = 3;
}

message Anomaly {
  // +kubebuilder:validation:Optional
  optional string name = 1;

  // +kubebuilder:validation:Optional
  optional string valueColumn = 2;

  // +kubebuilder:validation:Optional
  optional string adjDeltaColumn = 3;

  // The start of the anomaly
  // +kubebuilder:validation:Optional
  optional string start = 4;

  // The end of the anomaly
  // +kubebuilder:validation:Optional
  optional string end = 5;
}

// AudioPipelineSpec represents a single pipeline for preprocessing audio data
message AudioPipelineSpec {
  // The date time imputer.
  // +kubebuilder:default:="auto"
  // +kubebuilder:validation:Optional
  optional string featurizer = 1;
}

// BacktestSpec specify the back test
message BacktestSpec {
  // If true, use sliding windows, else use expanding windows
  // +kubebuilder:default = false
  // +kubebuilder:validation:Optional
  optional bool sliding = 1;

  // Number of splits. Default is 5
  // +kubebuilder:default = 5
  // +kubebuilder:validation:Optional
  optional int32 splits = 2;

  // ExpectedValueMax size for a single training set
  // +kubebuilder:default = 0
  // +kubebuilder:validation:Optional
  optional int32 Initial = 3;

  // The number of data points between each windows
  // +kubebuilder:default = 0
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Optional
  optional int32 gap = 5;
}

// BaselineSpec specifies the configuration for the baseline phase of a Study
message BaselineSpec {
  // Indicates if baseline (default hyper-parameters) models will be trained
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool enabled = 1;

  // Algorithms contains a list of estimators that will be trained
  // +kubebuilder:validation:Optional
  repeated string baselines = 2;

  // All indicates if a baseline model will be created for every estimator
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool all = 3;
}

message ChangePoint {
}

// CheckpointSpec specifies where to store model checkpoints
message CheckpointSpec {
  // Indicates if checkpointing is enabled.
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool enabled = 1;

  // The interval, in minutes, at which a snapshot of a partially trained model will be saved.
  // Applicable to models with long training times for resiliency if training is suddenly stopped
  // +kubebuilder:validation:Optional
  // +kubebuilder:default:=10
  // +kubebuilder:validation:Minimum=0
  optional int32 checkpointInterval = 2;

  // The location of the model checkpoint
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.DataLocation location = 3;
}

// ClassicalEstimatorSpec defines the specification for the Model's algorithm
message ClassicalEstimatorSpec {
  // AlgorithmName references the name of an estimator
  optional string algorithmName = 1;

  // Parameters is a list of hyperparameters for the algorithm
  repeated HyperParameterValue parameters = 2;
}

message CustomReportSpec {
  // Pages contains a collection of custom pages that will be appended to a Report
  repeated github.com.metaprov.modelaapi.pkg.apis.data.v1alpha1.PageSpec pages = 8;
}

// DataHashes contains the hashes for datasets used during model training
message DataHashes {
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string trainHash = 1;

  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string testingHash = 2;

  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string validationHash = 3;
}

// DataSplitSpec specifies the configuration to split a dataset into training and testing datasets
message DataSplitSpec {
  // Method defines the type of split method
  // +kubebuilder:default:="auto"
  // +kubebuilder:validation:Optional
  optional string method = 1;

  // The number percentage (0 through 100) of rows that will be allocated to the training dataset
  // +kubebuilder:validation:Optional
  // +kubebuilder:default:=80
  // +kubebuilder:validation:Minimum=1
  // +kubebuilder:validation:Maximum=100
  optional int32 train = 2;

  // The number percentage (0 through 100) of rows that will be allocated to the validation dataset.
  // If Validation is set to 0 the benchmarking process will use cross-validation
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Maximum=50
  // +kubebuilder:validation:Optional
  optional int32 validation = 3;

  // The number percentage (0 through 100) of rows that will be allocated to the training dataset
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Maximum=100
  // +kubebuilder:default:=20
  // +kubebuilder:validation:Optional
  optional int32 test = 4;

  // The name of the column containing a binary value that indicates if the row should be split.
  // The split type must use split-column in order for SplitColumn to have an effect
  // +kubebuilder:validation:Optional
  optional string splitColumn = 5;

  // The reference to the dataset snapshot which will be used as the training dataset
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.SnapshotReference trainSnapshot = 7;

  // The name of the Dataset resource which will be used as the testing dataset
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.SnapshotReference testSnapshot = 8;
}

message DeepEstimatorLayer {
  // Name is the name of the layer
  optional string name = 1;

  // Type is the type of the layers
  optional string type = 2;

  // Parameters are the hyper parameters of this layer
  repeated NNLayerParameter parameters = 3;

  // InputLayers are the layer input to this layer
  repeated string inputLayers = 4;
}

message DeepEstimatorSpec {
  // Layers is the dnn architecture
  // +kubebuilder:validation:Optional
  repeated DeepEstimatorLayer layers = 1;

  // The type of the dnn
  // +kubebuilder:validation:Optional
  optional string type = 2;

  // Batch size specify about
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Optional
  optional int32 batchSize = 3;

  // Budget size specify about
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Optional
  optional int32 epochs = 4;

  // ValidationSplit specify about
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Optional
  optional int32 validationSplit = 5;

  // Is this a seq model
  // +kubebuilder:validation:Optional
  optional bool isSeq = 6;

  // Gpus denote of gpu for trainer, any number more than 1 denote distribute training
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Optional
  optional int32 gpus = 7;

  // compile
  // +kubebuilder:validation:Optional
  optional string loss = 8;
}

// EarlyStopSpec specifies the configuration to automatically abort a model search
// when improvements in the objective metric are not being produced
message EarlyStopSpec {
  // Enabled indicates if early stopping is enabled
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool enabled = 1;

  // The number of models to train before the objective metric will be checked for early stopping.
  // If unspecified, Modela will ignore the first 10 models by default
  // +kubebuilder:default:=20
  // +kubebuilder:validation:Optional
  optional int32 initial = 2;

  // The number of models with no improvement in score that are required to abort the model search.
  // If unspecified, Modela will abort the search after 20 models by default
  // +kubebuilder:default:=5
  // +kubebuilder:validation:Optional
  optional int32 modelsWithNoProgress = 3;
}

// EnsembleSpec specifies the parameters of an ensemble model
message EnsembleSpec {
  // The collection of models (by their name) to be used as estimators in the ensemble
  // +kubebuilder:validation:Optional
  repeated string models = 1;

  // The collection of estimators to be used in the ensemble, derived from Models
  // +kubebuilder:validation:Optional
  repeated ClassicalEstimatorSpec estimators = 2;

  // The base estimator
  // +kubebuilder:validation:Optional
  optional ClassicalEstimatorSpec baseEstimator = 3;

  // The ensemble type method
  // +kubebuilder:validation:Optional
  optional string type = 4;
}

// EnsemblesSpec specifies the configuration to produce ensemble models
message EnsemblesSpec {
  // Indicates if ensemble models will be created
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool enabled = 1;

  // Indicates if a voting ensemble model will be created
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool votingEnsemble = 2;

  // Indicates if a stacking ensemble model will be created
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool stackingEnsemble = 3;

  // The number of top candidate models to include in the ensemble
  // +kubebuilder:default:=3
  // +kubebuilder:validation:Optional
  optional int32 top = 4;
}

message EntityRef {
  // The name of the entity
  optional string name = 1;

  // FeatureGroups to exclude from the link
  // +kubebuilder:validation:Optional
  repeated string exclude = 2;
}

// What metric to evaluate
message EvalMetrics {
  // From: https://linkedin.github.io/greykite/docs/0.1.0/html/pages/stepbystep/0400_configuration.html
  // Used to select the optimal model during cross-validation.
  // +kubebuilder:validation:Optional
  optional string selection = 1;

  // From: https://linkedin.github.io/greykite/docs/0.1.0/html/pages/stepbystep/0400_configuration.html
  // Additional metrics to compute during CV, besides the one specified by ``cv_selection_metric``
  // +kubebuilder:validation:Optional
  repeated string reporting = 2;

  //  From: https://linkedin.github.io/greykite/docs/0.1.0/html/pages/stepbystep/0400_configuration.html
  //  Defines how to aggregate rolling windows of actual and predicted values
  //  before evaluation.
  // +kubebuilder:validation:Optional
  optional string aggFunc = 3;

  //  From: https://linkedin.github.io/greykite/docs/0.1.0/html/pages/stepbystep/0400_configuration.html
  //  Number of periods to aggregate before evaluation.
  // +kubebuilder:validation:Optional
  optional int32 aggPeriod = 4;

  //  From: https://linkedin.github.io/greykite/docs/0.1.0/html/pages/stepbystep/0400_configuration.html
  // Defines baseline model to compute ``R2_null_model_score`` evaluation metric.
  // R2_null_model_score is the improvement in the loss function relative
  // to a null model. It can be used to evaluate model quality with respect to
  // a simple baseline
  // +kubebuilder:validation:Optional
  optional string nullModelParams = 5;

  //  From: https://linkedin.github.io/greykite/docs/0.1.0/html/pages/stepbystep/0400_configuration.html
  // Threshold to compute the ``Outside Tolerance`` metric,
  // defined as the fraction of forecasted values whose relative
  // error is strictly greater than ``relative_error_tolerance``.
  // If `NoneSeasonalityMode`, the metric is not computed.
  // +kubebuilder:validation:Optional
  optional double relErrTolerance = 6;
}

// The cross validation spec, used to evaluate the forecaster during training.
message EvalPeriod {
  //  From: https://linkedin.github.io/greykite/docs/0.1.0/html/pages/stepbystep/0400_configuration.html
  // Numbers of periods held back from end of df for test.
  // The rest is used for cross validation.
  // If None, default is forecast_horizon. Set to 0 to skip backtest.
  // +kubebuilder:validation:Optional
  optional int32 testHorizon = 1;

  // +kubebuilder:validation:Optional
  optional int32 periodsBetweenTrainTest = 2;

  //  From: https://linkedin.github.io/greykite/docs/0.1.0/html/pages/stepbystep/0400_configuration.html
  // Number of periods to slide the test window between CV splits. Has to be greater than or equal to 1.
  // If None, default is cv_horizon.
  // +kubebuilder:validation:Optional
  optional int32 cvPeriodsBetweenSplits = 3;

  // +kubebuilder:validation:Optional
  optional bool cvExpandingWindows = 4;

  //  From: https://linkedin.github.io/greykite/docs/0.1.0/html/pages/stepbystep/0400_configuration.html
  // Number of periods in each CV test set
  // If None, default is forecast_horizon. Set to 0 to skip CV.
  // +kubebuilder:validation:Optional
  optional int32 cvHorizon = 5;

  //  From: https://linkedin.github.io/greykite/docs/0.1.0/html/pages/stepbystep/0400_configuration.html
  // Minimum number of periods for training each CV fold.
  // If cv_expanding_window is False, every training period is this size
  // If None, default is 2 * cv_horizon
  // +kubebuilder:validation:Optional
  optional int32 cvMinTrainPeriods = 6;

  //  From: https://linkedin.github.io/greykite/docs/0.1.0/html/pages/stepbystep/0400_configuration.html
  // Maximum number of CV splits.
  // Given the above configuration, samples up to max_splits train/test splits,
  // preferring splits toward the end of available data. If None, uses all splits.
  // +kubebuilder:validation:Optional
  optional int32 cvMaxSplits = 7;

  //  From: https://linkedin.github.io/greykite/docs/0.1.0/html/pages/stepbystep/0400_configuration.html
  // If True, splits from the end of the dataset are used.
  // Else a sampling strategy is applied. Check
  // +kubebuilder:validation:Optional
  optional bool cvUseMostRecentSplits = 8;
}

// FeatureEngineeringPipeline represents a single pipeline to transform a dataset
message FeatureEngineeringPipeline {
  // Name specifies the unique name of the pipeline
  // +kubebuilder:validation:Required
  optional string name = 1;

  // DataType specifies the data type of the pipeline, which corresponds to the
  // data type of all features in the pipeline
  // +kubebuilder:validation:Required
  optional string dataType = 2;

  // Features contains the collection of features which the pipeline will be applied to
  // +kubebuilder:validation:Optional
  repeated string features = 3;

  // Imputation specifies the imputation method to use when handling missing values
  // +kubebuilder:default:=none
  // +kubebuilder:validation:Optional
  optional string imputation = 4;

  // Encoding specifies the encoding method to use for categorical features
  // +kubebuilder:default:=none
  // +kubebuilder:validation:Optional
  optional string encoding = 5;

  // Scaling specifies the scaling method to use for numerical features
  // +kubebuilder:default:=none
  // +kubebuilder:validation:Optional
  optional string scaling = 6;

  // Discretisation specifies the discretisation method to convert numerical features to discrete variables
  // +kubebuilder:default:=none
  // +kubebuilder:validation:Optional
  optional string discretisation = 7;

  // VariableTransformation specifies the transformation method to use for numerical feature
  // +kubebuilder:default:=none
  // +kubebuilder:validation:Optional
  optional string variableTransformation = 8;

  // OutlierHandling specifies the method to use when handling outliers
  // +kubebuilder:default:=none
  // Apply only to numeric data types.
  optional string outlierHandling = 9;

  // DatetimeTransformation specifies the method to use when handling the date-time data type
  // +kubebuilder:default:=none
  // +kubebuilder:validation:Optional
  optional string datetimeTransformation = 10;

  // Text defines the configuration for the pipeline to handle text features
  // +kubebuilder:validation:Optional
  optional TextPipelineSpec text = 11;

  // Drop indicates if all of all the features for the pipeline will be dropped
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool drop = 12;
}

// FeatureEngineeringSpec specifies the feature engineering to be performed on the training data
message FeatureEngineeringSpec {
  // Pipelines contains the collection of feature engineering pipelines that
  // will be applied to the dataset prior to model training
  // +kubebuilder:validation:Optional
  repeated FeatureEngineeringPipeline pipelines = 1;

  // Imbalance specifies the method which will be used to handle an imbalanced dataset
  // +kubebuilder:default:=auto
  // +kubebuilder:validation:Optional
  optional string imbalance = 2;
}

// FeatureImportance records the computed importance of a single feature
message FeatureImportance {
  // The name of the feature
  optional string feature = 1;

  // The importance of the feature
  // +kubebuilder:validation:Format=float
  // +kubebuilder:validation:Type=number
  optional double importance = 2;
}

message FeatureInfo {
  // The feature name
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string name = 1;

  // The reason that the feature was dropped
  // +kubebuilder:validation:Optional
  optional string reason = 2;

  // +kubebuilder:validation:Optional
  optional double value = 3;
}

message FeaturePair {
  optional string x = 1;

  optional string y = 2;
}

// FeatureSelectionSpec specifies the configuration to run feature selection on a dataset
message FeatureSelectionSpec {
  // Indicates if feature selection is enabled
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool enabled = 1;

  // Indicates if embedded methods will be tested as part of the candidate algorithms (e.g. tree-based selection)
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool embedding = 3;

  // Indicates if filter methods will be tested as part of the candidate algorithms (e.g. chi-square or anova tests)
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool filter = 4;

  // Indicates if wrapper methods will be tested as part of the candidate algorithms
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool wrapper = 5;

  // The collection of feature selection methods that will be applied in order to the dataset
  repeated string pipeline = 6;

  // The threshold as a percentage to remove low variance features
  // +kubebuilder:default:=5
  // +kubebuilder:validation:Optional
  optional int32 varThreshold = 7;

  // The threshold to remove features with high correlations
  // +kubebuilder:default:=95
  // +kubebuilder:validation:Optional
  optional int32 corrThreshold = 8;

  // The number of features that will be selected based on importance. If TopN is 0, all features will be selected
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional int32 maxFeatures = 9;

  // Percent of features to keep
  // +kubebuilder:default:=20
  // +kubebuilder:validation:Optional
  optional int32 percentile = 10;

  // List of features that are reserved and will always be included in the final feature selection
  // +kubebuilder:validation:Optional
  repeated string reserved = 12;
}

// The forecaster search define a search for the forecaster
message ForecasterSpec {
  // The spec for the holiday
  // +kubebuilder:validation:Optional
  repeated TimeSeriesEvent events = 2;

  // Specification for the past windows
  // +kubebuilder:validation:Optional
  optional WindowSpec past = 3;

  // Specification for the future windows
  // +kubebuilder:validation:Optional
  optional WindowSpec future = 4;

  // Make a forecast post training
  // +kubebuilder:validation:Optional
  optional bool forecast = 5;

  // Make a forecast post training
  // +kubebuilder:validation:Optional
  optional double coverage = 6;

  // List of time series features to compute on each time series.
  // +kubebuilder:validation:Optional
  repeated string features = 8;

  // Filter the groups to forecast for. If none forecast only to the leaf group
  // +kubebuilder:validation:Optional
  repeated string groups = 9;

  // +kubebuilder:validation:Optional
  optional string predefinedTemplate = 10;

  // +kubebuilder:validation:Optional
  repeated Anomaly anomalies = 11;

  // +kubebuilder:validation:Optional
  optional string trainEndData = 12;

  // The value column. this is the name of the column to forecast, this will be based on the data source.
  // +kubebuilder:validation:Optional
  optional string valueColumn = 13;

  // +kubebuilder:validation:Optional
  optional int32 hpoBudget = 14;

  // Spec for evaluation metric
  // +kubebuilder:validation:Optional
  optional EvalMetrics evaluationMetrics = 15;

  // Spec for time series cross validation
  // +kubebuilder:validation:Optional
  optional EvalPeriod evaluationPeriod = 16;

  // +kubebuilder:validation:Optional
  optional SeasonalitySpec seasonality = 17;

  // The regressor. Initially those are set from the data source schema
  // +kubebuilder:validation:Optional
  repeated string regressors = 18;

  // Lagged Regressors
  // +kubebuilder:validation:Optional
  repeated string laggedRegressors = 19;

  // Set the growth of the series
  // +kubebuilder:validation:Optional
  optional string growth = 20;

  // In case of group forecast
  // +kubebuilder:validation:Optional
  repeated string key = 21;

  // The estimators to try. By default, we try graykit / auto arima and prophet.
  // +kubebuilder:validation:Optional
  repeated string estimators = 22;

  // +kubebuilder:default:="bottom-up"
  // +kubebuilder:validation:Optional
  optional string hts = 23;
}

// GarbageCollectionSpec specifies the configuration to garbage-collect unused Model resources
message GarbageCollectionSpec {
  // Enabled indicates if garbage collection is enabled, in which case all models will be deleted at the end of the
  // Study excluding an amount of the top highest-performing models defined by the SearchSpec of the Study
  // +kubebuilder:validation:Optional
  // +kubebuilder:default:=true
  optional bool enabled = 1;

  // If true, the best models per algorithm will be prevented from deletion
  // +kubebuilder:validation:Optional
  // +kubebuilder:default:=false
  optional bool keepBestModelPerAlgorithm = 2;

  // +kubebuilder:validation:Optional
  // +kubebuilder:default:=false
  optional bool keepPrunedModels = 3;
}

// GarbageCollectionStatus contains the records for garbage-collected models
message GarbageCollectionStatus {
  // The number of models that were collected, equal to the length of Models
  // +kubebuilder:validation:Optional
  optional int32 collectedModelsCount = 1;

  // The collection of models that were deleted
  // +kubebuilder:validation:Optional
  repeated ModelResult models = 2;
}

// GeneratedColumnSpec describes a column to be generated and applied to a dataset
message GeneratedColumnSpec {
  // The name of the generated column
  optional string name = 1;

  // The resulting data type
  optional string datatype = 2;

  // The name of the first original column
  optional string first = 3;

  // The name of the second original column, if the expression is binary operator
  // +kubebuilder:validation:Optional
  optional string second = 4;

  // The expression to apply in order to generate the new column
  // +kubebuilder:validation:Optional
  optional string original = 5;
}

// HyperParameterValue represent an individual hyperparameter for a machine learning algorithm
message HyperParameterValue {
  // The name of the hyperparameter
  optional string name = 1;

  // The value of the hyperparameter
  optional string value = 2;
}

message HyperbandOptions {
  // A parameter for specifying the minimum resource allocated to a trial noted as ùëü in the paper
  // +kubebuilder:default:=1
  // +kubebuilder:validation:Optional
  optional int32 minResources = 1;

  // A parameter for specifying the maximum resource allocated to a trial
  // +kubebuilder:default:=1
  // +kubebuilder:validation:Optional
  optional int32 maxResources = 2;

  // A parameter for specifying reduction factor of promotable trials
  // +kubebuilder:default:=3
  // +kubebuilder:validation:Optional
  optional int32 reductionFactor = 3;

  // Parameter specifying the number of trials required in a rung before any trial can be promoted
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional int32 bootstrapCount = 4;
}

// ImagePipelineSpec represents a single pipeline for preprocessing image data
message ImagePipelineSpec {
  // The date time imputer.
  // +kubebuilder:default:="auto"
  // +kubebuilder:validation:Optional
  optional string featurizer = 1;
}

// ImbalanceHandlingSpec specifies the configuration to process an imbalanced dataset
message ImbalanceHandlingSpec {
  // Indicates if imbalance handling is enabled
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool enabled = 1;

  // The technique that will be used to handle the imbalanced dataset
  // +kubebuilder:default:=auto
  // +kubebuilder:validation:Optional
  optional string imbalance = 2;
}

// InterpretabilitySpec specifies the configuration to generate interpretability data and diagrams
message InterpretabilitySpec {
  // Indicates if ICE (individual condition expectation) plots will be generated
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool ice = 1;

  // The collection of feature pairs to generate ICE scatter diagrams for each
  repeated FeaturePair icepairs = 2;

  // Indicates if LIME (local interpretable model-agnostic explanations) diagrams will be generated
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool lime = 3;

  // The type of SHAP values to be generated. Linear and tree values are the
  // only recommended types due to the high compute times of other methods
  // +kubebuilder:default:=auto
  // +kubebuilder:validation:Optional
  optional string shap = 4;

  // The collection of feature pairs to generate SHAP scatter diagrams for each
  // +kubebuilder:validation:Optional
  repeated FeaturePair shappairs = 5;

  // Indicates if counter-factual diagrams will be generated
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool counterfactual = 6;

  // Indicates if anchor explanation diagrams will be generated
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool anchor = 7;
}

// InterpretabilityStatus represents the state of the explanation phase of a Model
message InterpretabilityStatus {
  // StartedAt represents the time when the model explanation phase started
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time startedAt = 1;

  // CompletedAt represents the time when the model explanation phase ended
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time completedAt = 2;

  // The location of the generated explanation data
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation explainerLocation = 3;

  // The location of the train SHAP values
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation trainShapValuesLocation = 4;

  // The location of the test SHAP values
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation testShapValuesLocation = 5;

  // The collection of feature importances generated from the computed SHAP values
  repeated FeatureImportance importance = 6;
}

message MedianPrunerOptions {
  // Pruning is disabled until the given number of trials finish in the same ModelClass.
  // +kubebuilder:default:=5
  // +kubebuilder:validation:Optional
  optional int32 startupTrials = 1;

  //  Pruning is disabled until the trial exceeds the given number of step
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional int32 warmupSteps = 2;

  // Interval in number of steps between the pruning checks
  // +kubebuilder:default:=1
  // +kubebuilder:validation:Optional
  optional int32 intervalSteps = 3;

  // Minimum number of reported trials.
  // +kubebuilder:default:=1
  // +kubebuilder:validation:Optional
  optional int32 minTrials = 4;
}

// +kubebuilder:object:root=true
// +kubebuilder:resource:path=models,singular=model,shortName=md,categories={training,modela,all}
// +kubebuilder:subresource:status
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Status",type="string",JSONPath=".status.phase"
// +kubebuilder:printcolumn:name="Progress",type="string",JSONPath=".status.progress",priority=1
// +kubebuilder:printcolumn:name="Best",type="boolean",JSONPath=".status.best"
// +kubebuilder:printcolumn:name="Owner",type="string",JSONPath=".spec.owner",priority=1
// +kubebuilder:printcolumn:name="Study",type="string",JSONPath=".spec.studyName"
// +kubebuilder:printcolumn:name="Task",type="string",JSONPath=".spec.task",priority=1
// +kubebuilder:printcolumn:name="Algorithm",type="string",JSONPath=".spec.estimator.algorithmName"
// +kubebuilder:printcolumn:name="Objective",type="string",JSONPath=".spec.objective.metric"
// +kubebuilder:printcolumn:name="Validation Score",type="number",JSONPath=".status.validationScore"
// +kubebuilder:printcolumn:name="Train Score",type="number",JSONPath=".status.trainScore",priority=1
// +kubebuilder:printcolumn:name="Test Score",type="number",JSONPath=".status.testScore"
// +kubebuilder:printcolumn:name="Last Failure",type="string",JSONPath=".status.failureMessage",priority=1
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp"
// Model represents a machine learning model that can be trained by Modela
message Model {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1;

  optional ModelSpec spec = 2;

  // +optional
  optional ModelStatus status = 3;
}

// +kubebuilder:subresource:status
// +kubebuilder:resource:path=modelclasses,singular=modelclass,shortName=mc,categories={training,modela}
// +kubebuilder:object:root=true
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Owner",type="string",JSONPath=".spec.owner",priority=1
// +kubebuilder:printcolumn:name="Version",type="string",JSONPath=".spec.versionName",priority=1
// +kubebuilder:printcolumn:name="Description",type="string",JSONPath=".spec.description"
// +kubebuilder:printcolumn:name="Task",type="string",JSONPath=".spec.task"
// +kubebuilder:printcolumn:name="Objective",type="string",JSONPath=".spec.objective.metric"
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp"
// ModelClass represents an automatic search for the best machine learning model for a given dataset
message ModelClass {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1;

  optional ModelClassSpec spec = 2;

  // +optional
  optional ModelClassStatus status = 3;
}

// Specification for the label information
message ModelClassDataSpec {
  // The location of the observation file or table.
  // The observations are the source for training (observations which have a value for the target
  // columns) or for prediction (observations with no targets).
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.DataLocation observations = 1;

  // The location of the predictions table. The predictions table contains all the latest predictions.
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.DataLocation predictions = 2;

  // The schema of the observation file. The schema is used as the basis for training and serving.
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.data.v1alpha1.Schema schema = 3;

  // In case where the feature group data is stored as flat file. the flat file format
  // define how to read the file.
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.data.v1alpha1.FlatFileFormatSpec flatFile = 4;

  // The primary key for the observation row
  // If empty the system will set the join key as the primary key based on the schema.
  // +kubebuilder:validation:Optional
  repeated string primaryKey = 5;

  // Define the column name that contains the prediction time for each row in the label data.
  // The system uses the prediction time in order to avoid data leakage.
  // I.e. the training dataset will contain only data that was known before the prediction time
  // If null, the system will set the prediction time column as the time index column in the schema.
  // +kubebuilder:validation:Optional
  optional string predictionTimeColumn = 6;

  // Name of the target column
  // If null, the system will assign this column based on the schema.
  // +kubebuilder:validation:Optional
  optional string target = 7;

  // Tests to run on the training data before training. This assurs data quality is being met.
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuite tests = 8;

  // The name of the online feature store that serve predictions for models from this model class
  // The offline feature stores are stored in the tenant.
  // +kubebuilder:validation:Optional
  optional string onlineFeatureStoreName = 9;

  // The name of the offline feature store, the offline feature store contain the observations and the feature groups
  // The offline feature stores are stored in the tenant.
  // +kubebuilder:validation:Optional
  optional string offlineFeatureStoreName = 10;
}

// ModelClassList contains a list of Studies
// +kubebuilder:object:root= true
message ModelClassList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1;

  repeated ModelClass items = 2;
}

// +kubebuilder:object:root=true
// +kubebuilder:resource:path=modelclassruns,shortName=mcr,singular=modelclassrun,categories={train,modela,all}
// +kubebuilder:subresource:status
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Status",type="string",JSONPath=".status.phase"
// +kubebuilder:printcolumn:name="ModelClass",type="string",JSONPath=".spec.modelClassName"
// +kubebuilder:printcolumn:name="CompletedAt",type="date",JSONPath=".status.completionTime",priority=1
// +kubebuilder:printcolumn:name="Last Failure",type="string",JSONPath=".status.failureMessage"
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp"
// ModelClassRun represent a execution of a model class training
message ModelClassRun {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1;

  optional ModelClassRunSpec spec = 2;

  // +optional
  optional ModelClassRunStatus status = 3;
}

// +kubebuilder:object:root=true
// ModelClassRunList represent list of pipelineruns
message ModelClassRunList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1;

  repeated ModelClassRun items = 2;
}

// ModelClassRunSpec is the desired state of the ModelClassRun resource
message ModelClassRunSpec {
  // VersionName is the data product version of the run
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string versionName = 1;

  // Description is the user provided description
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string description = 2;

  // DatasetName is the name of the dataset that we trained on.
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string datasetName = 3;

  // ModelClassName is the name of the ModelClass for this pipeline
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string modelClassName = 4;

  // The owner of the run.
  // +kubebuilder:default:="no-one"
  // +kubebuilder:validation:Optional
  optional string owner = 5;

  // The priority of this pipeline run. The default is medium.
  // +kubebuilder:default:=medium
  // +kubebuilder:validation:Optional
  optional string priority = 6;

  // Set to true to pause the model pipeline run
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool paused = 7;

  // Set to true to abort the model pipeline run
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool aborted = 8;

  // TTL.
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional int32 ttl = 9;

  // What triggered the run
  // +kubebuilder:validation:Optional
  optional string triggeredBy = 10;
}

// ModelClassRunStatus is the observed state of the ModelClassRun resource .
message ModelClassRunStatus {
  // The name of the dataset that was captured by the label filter.
  // +kubebuilder:validation:Optional
  optional string datasetName = 1;

  // The name of the study generated.
  // +kubebuilder:validation:Optional
  optional string studyName = 2;

  // The name of the best model
  // +kubebuilder:validation:Optional
  optional string modelName = 3;

  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time completedAt = 5;

  // The phase of the pipeline run
  // +kubebuilder:default:="Pending"
  // +kubebuilder:validation:Optional
  optional string phase = 6;

  // ObservedGeneration is the Last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 7;

  // Folder for pipeline run artifacts. This is assigned by the system
  // The folder contains all the pipeline artifacts - metadata, logs
  // +kubebuilder:validation:Optional
  optional string evalMetrics = 8;

  // UpdateUpdateStrategy in case of terminal failure message
  // +kubebuilder:validation:Optional
  optional string failureMessage = 10;

  // Last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time updatedAt = 12;

  // The log file specification that determines the location of all logs produced by the object
  repeated github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ContainerLog logs = 13;

  // Last promotion was done
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time promotedAt = 14;

  // If true the promotion was automatic
  optional bool auto = 15;

  // for manual promotion, who approved the promotion
  optional k8s.io.api.core.v1.ObjectReference approvedBy = 16;

  // for manual promotion, who approved the promotion
  optional int32 modelsCount = 17;

  // +patchMergeKey=type
  // +patchStrategy=merge
  // +kubebuilder:validation:Optional
  repeated k8s.io.apimachinery.pkg.apis.meta.v1.Condition conditions = 18;
}

message ModelClassServingSpec {
  // Define the serving of the best model.
  // +kubebuilder:validation:Optional
  optional ServingSpec template = 1;

  // Schedule for monitoring drift
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.RunSchedule monitoringSchedule = 2;

  // BatchPrediction schedule
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.RunSchedule predictionSchedule = 3;

  // List of SQL statements to run before training
  // +kubebuilder:validation:Optional
  repeated string preSQL = 4;

  // List of SQL statements to run after training
  // +kubebuilder:validation:Optional
  repeated string postSQL = 5;
}

// ModelClassSpec defines the desired state of a ModelClass and the parameters for a model search
message ModelClassSpec {
  // The name of the Account which created the object, which exists in the same tenant as the object
  // +kubebuilder:default:="no-one"
  // +kubebuilder:validation:Optional
  optional string owner = 1;

  // VersionName references the name of a Data Product Version that describes the version of the resource
  // +kubebuilder:validation:Optional
  optional string versionName = 2;

  // The user-provided description of the ModelClass
  // +kubebuilder:default:=""
  // +kubebuilder:validation:MaxLength=512
  // +kubebuilder:validation:Optional
  optional string description = 3;

  // The machine learning task type (i.e. regression, classification)
  // +kubebuilder:validation:Required
  // +required
  optional string task = 4;

  // The machine learning subtask relevant to the primary task (text classification, image object detection, etc.)
  // +kubebuilder:default:=none
  // +kubebuilder:validation:Optional
  optional string subtask = 5;

  // The optimization objective. The objective is also used when promoting models
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ObjectiveSpec objective = 6;

  // Entities contains a list of Entity resources that will be used to construct the training data.
  // +kubebuilder:validation:Optional
  repeated EntityRef entities = 7;

  // The model class data
  // +kubebuilder:validation:Optional
  optional ModelClassDataSpec data = 8;

  // TrainingTemplate specifies the configuration to train and evaluate models
  // +kubebuilder:validation:Optional
  optional ModelClassTrainingSpec training = 9;

  // ServingTemplate specifies the model format and resource requirements that will be applied to
  // the Predictor created for the Model that will be selected by the ModelClass
  // +kubebuilder:validation:Optional
  optional ModelClassServingSpec serving = 10;

  // The notification specification that determines which notifiers will receive Alerts generated by the object
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.NotificationSpec notification = 11;

  // The schedule for summary report
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.RunSchedule reportSchedule = 12;

  // Fast indicates if Dataset, Model and Study resources associated with the ModelClass should run in fast mode.
  // Running in fast mode will skip unnecessary workloads such as profiling, reporting, explaining, etc.
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool fast = 13;

  // If true, pause the model class activities.
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool paused = 14;

  // Registered indicate if this model class is registered with the model registry.
  // A registred model cannot be garbage collected, and apper in the model registry page.
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool registered = 15;

  // The name of a Virtual Bucket that will be applied as the artifact bucket to resources created by the ModelClass
  // +kubebuilder:validation:Optional
  optional string artifactBucketName = 16;
}

message ModelClassStatus {
  // ObservedGeneration is the last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 1;

  // The last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time updatedAt = 2;

  // BestFE specifies the best feature engineering pipeline produced by the ModelClass
  // +kubebuilder:validation:Optional
  optional FeatureEngineeringSpec bestFE = 3;

  // Training schedule status
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.RunScheduleStatus trainingScheduleStatus = 4;

  // Batch Prediction schedule
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.RunScheduleStatus predictionScheduleStatus = 5;

  // Batch Prediction schedule
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.RunScheduleStatus monitoringScheduleStatus = 6;

  // Batch Prediction schedule
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.RunScheduleStatus reportScheduleStatus = 7;

  // The highest score out of all ModelsCount created by the associated Study resource
  // +kubebuilder:validation:Optional
  optional double bestModelScore = 8;

  // List of the last 5 retired models
  repeated string retired = 9;

  // The name of the current predictor for this model class.
  optional string predictorName = 10;

  // The name of the current dataaoo for the model class
  optional string dataAppName = 11;

  // The name of triggered by.
  // +kubebuilder:validation:Optional
  optional string triggeredBy = 12;

  // UpdateUpdateStrategy in case of terminal failure message
  // +kubebuilder:validation:Optional
  optional string failureMessage = 14;

  // The last time a new model was trained as part of this model class
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastRunAt = 15;

  // The name of the last prediction for this class
  // +kubebuilder:validation:Optional
  optional string lastRunName = 16;

  // The last time a batch prediction was made
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastPredictionAt = 17;

  // The name of the last prediction for this class
  // +kubebuilder:validation:Optional
  optional string lastPredictionName = 18;

  // Total number of batch predictions
  // +kubebuilder:validation:Optional
  optional int32 predictionsCount = 19;

  // Total number of batch  mode class run in the system for this model class.
  // +kubebuilder:validation:Optional
  optional int32 runsCount = 20;

  // Total models in the system for this model class
  // +kubebuilder:validation:Optional
  optional int32 modelsCount = 21;

  // If true, a model of this class is in production
  // +kubebuilder:validation:Optional
  optional bool live = 22;

  // Total predictors in the system for this model class
  // +kubebuilder:validation:Optional
  optional int32 predictorsCount = 23;

  // +optional
  // +patchMergeKey=type
  // +patchStrategy=merge
  repeated k8s.io.apimachinery.pkg.apis.meta.v1.Condition conditions = 24;
}

// Specification for model training.
message ModelClassTrainingSpec {
  // The reference to the Lab under which the Model for the class will be trained
  // If unspecified, the default Lab from the parent DataProduct will be used
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference labRef = 1;

  // Define a reference to a study template. The study template will be the basis for training models
  // From this model class.
  // +kubebuilder:validation:Optional
  optional string studyTemplateName = 2;

  // A template for models unit tests
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuite modelUnitTests = 3;

  // Training schedule
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.RunSchedule trainingSchedule = 4;

  // Define custom search space for this model class.
  // The search space defines which algorithm to include or execlude
  // If not defined, we would use the search space in the model template.
  // +kubebuilder:validation:Optional
  optional AlgorithmSearchSpaceSpec searchSpace = 8;

  // Training resources
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ResourceSpec resources = 9;

  // What triggered the training
  // +kubebuilder:validation:Optional
  optional string triggeredBy = 10;

  // Pause the training job or any additional training job
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool paused = 11;

  // The deadline for models to complete training, in seconds
  // +kubebuilder:validation:Maximum=36000
  // +kubebuilder:validation:Minimum=1
  // +kubebuilder:default:=3600
  // +kubebuilder:validation:Optional
  optional int32 maxTime = 12;

  // The number of candidate models that will be sampled and trained
  // +kubebuilder:validation:Maximum=512
  // +kubebuilder:validation:Minimum=1
  // +kubebuilder:default:=10
  // +kubebuilder:validation:Optional
  optional int32 maxModels = 13;

  // The desired number of trainers that will train candidate models in parallel. The number
  // of trainers is restricted based on the allowance provided by the active License
  // +kubebuilder:default:=1
  // +kubebuilder:validation:Optional
  optional int32 trainers = 14;

  // Aborted indicates that the execution.
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool aborted = 15;

  // Explained indicates that we want to explain models.
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool explained = 16;

  // List of SQL statements to run before training
  // +kubebuilder:validation:Optional
  repeated string preSQL = 17;

  // List of SQL statements to run after training
  // +kubebuilder:validation:Optional
  repeated string postSQL = 18;
}

message ModelGroupByStatus {
  // The locations of the datasets profile files. Each file is the group
  // +kubebuilder:validation:Optional
  optional string modelsURI = 1;

  // The locations of the datasets profiles files.
  // +kubebuilder:validation:Optional
  optional string profilesURI = 2;

  // The locations of forecasts
  // +kubebuilder:validation:Optional
  optional string forecastsURI = 3;

  // Holds the worker on-going result, when a worker finish, we update the location of their result files
  // +kubebuilder:validation:Optional
  repeated github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.WorkerRunResult workerResults = 4;
}

// +kubebuilder:object:root=true
// ModelList is a list of Models
message ModelList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1;

  repeated Model items = 2;
}

// ModelResult contains the records of a single garbage-collected model
message ModelResult {
  // The name of the model
  // +kubebuilder:validation:Optional
  optional string name = 1;

  // The type of estimator of the model
  // +kubebuilder:validation:Optional
  optional string algorithm = 2;

  // The objective score of the model
  // +kubebuilder:validation:Optional
  optional double score = 3;

  // Indicates if the model experience an error whilst training
  // +kubebuilder:validation:Optional
  optional bool error = 4;

  // The optimizer trial ID of the model
  // +kubebuilder:validation:Optional
  optional int32 trialID = 5;
}

// ModelSpec defines the desired state of the Model resource
message ModelSpec {
  // Owner specifies the name of the Account which the object belongs to
  // +kubebuilder:default:="no-one"
  // +kubebuilder:validation:Optional
  optional string owner = 1;

  // The name of the Study Run which created the Model. If empty, the Model will be trained as a stand-alone model
  // +kubebuilder:validation:Required
  // +kubebuilder:validation:MaxLength=63
  // +required
  optional string studyRunName = 2;

  // The machine learning task type of the Model (i.e. regression, classification), derived from the parent Study
  // +kubebuilder:validation:Required
  // +required
  optional string task = 3;

  // The machine learning subtask relevant to the primary task (text classification, image object detection, etc.)
  // +kubebuilder:default:="none"
  // +kubebuilder:validation:Optional
  optional string subtask = 4;

  // The objective metric that will be used to evaluate the performance of the model
  // +kubebuilder:validation:Required
  // +required
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ObjectiveSpec objective = 5;

  // FeatureEngineering specifies the preprocessing pipelines that will be applied to the model prior to training
  // +kubebuilder:validation:Optional
  optional FeatureEngineeringSpec featureEngineering = 6;

  // Estimator defines the machine learning algorithm and hyperparameters for the Model
  // +kubebuilder:validation:Optional
  optional ClassicalEstimatorSpec estimator = 7;

  // Ensemble specifies the configuration to create an ensemble model
  // +kubebuilder:validation:Optional
  optional EnsembleSpec ensemble = 8;

  // Interpretability specifies the configuration to generate model interpretability visualizations
  // +kubebuilder:validation:Optional
  optional InterpretabilitySpec interpretability = 9;

  // TrainingSpec specifies the configuration to prepare and train a model
  // +kubebuilder:validation:Optional
  optional TrainingSpec training = 10;

  // Forecasting specifies the configuration to generate a forecast
  // +kubebuilder:validation:Optional
  optional ForecasterSpec forecasting = 11;

  // Approval specifies the model approval requirements (unimplemented)
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.data.v1alpha1.ApprovalSpec approval = 12;

  // UnitTests defines the test suite that will be executed on the Model succeeding training
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuite unitTests = 13;

  // The notification specification that determines which notifiers will receive Alerts generated by the object
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.NotificationSpec notification = 14;

  // Test indicates if the model will be moved to testing. The model will be measured against all available benchmarks
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool test = 15;

  // If true, all workloads created by the Model will be removed and the Model will no longer be reconciled
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool abort = 16;

  // If true, the Model's estimator and other artifacts will be packaged for use in a Predictor
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool package = 17;

  // If true, a Report resource will be generated for the Model succeeding completion
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool report = 18;

  // If true, the execution of new workloads associated with the Model will be paused
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool pause = 19;

  // If true, a profile will be generated for the Model succeeding training
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool profile = 20;

  // If true, a forecast will be generated for the Model (applicable if the task type is forecasting)
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool forecast = 21;

  // If true, Shapley values (and relevant visualizations) will be calculated for the highest-performing Model
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool explain = 22;

  // If true, the Model will be unit-tested against the test suite specified by UnitTests
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool unitTest = 23;

  // Fast indicates if the Model will skip profiling, unit testing, explaining, and reporting
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool fast = 24;

  // The name of the Virtual Bucket where Study artifacts (metadata, reports, and model artifacts) generated by
  // the Study will be stored. If empty, it will default to the default Virtual Bucket of the Data Product
  // +kubebuilder:validation:Optional
  optional string artifactBucketName = 25;

  // The deadline for any Jobs associated with the Model to be completed in seconds
  // +kubebuilder:default:=600
  // +kubebuilder:validation:Optional
  optional int64 timeout = 26;

  // The type of model, relevant to the Study phase which the Model was created for
  // +kubebuilder:validation:Optional
  optional string modelClass = 27;

  // The trial ID of the Model, designated by the parent Study of the Model
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional int32 trialID = 28;

  // The Model Class which created the Model, if applicable
  // +kubebuilder:validation:Optional
  optional string modelClassName = 29;

  // The Model Class Run which created the Model, if applicable
  // +kubebuilder:validation:Optional
  optional string modelClassRunName = 30;
}

message ModelStageStatus {
  // Phase is the phase of the stage
  // +kubebuilder:default:="Pending"
  // +kubebuilder:validation:Optional
  optional string phase = 1;

  // Start time is the start time of the stage
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time startedAt = 7;

  // End time is the end time of the stage.
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time completedAt = 8;

  // Results is the results of running the test datasets against the new model
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuiteResult unitTestsResult = 9;

  // Error record error.
  // +kubebuilder:validation:Optional
  optional string error = 10;
}

// ModelStatus defines the observed state of a Model
message ModelStatus {
  // ObservedGeneration is the last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 1;

  // ModelVersion specifies the version of the model, determined by the Study Run which created it
  // +kubebuilder:validation:Optional
  optional uint32 modelVersion = 2;

  // The validation score for the objective metric produced through cross validation or the validation dataset
  // +kubebuilder:validation:Optional
  optional double validationScore = 3;

  // The score for the objective metric based on the training dataset
  // +kubebuilder:validation:Optional
  optional double trainingScore = 4;

  // The score for the objective metric based on the testing dataset
  // +kubebuilder:validation:Optional
  optional double testScore = 5;

  // The number of rows in the training dataset
  // +kubebuilder:validation:Optional
  optional int32 trainingRows = 6;

  // The number of rows in the testing dataset
  // +kubebuilder:validation:Optional
  optional int32 testingRows = 7;

  // The number of rows in the validation dataset, if applicable
  // +kubebuilder:validation:Optional
  optional int32 validationRows = 8;

  // The name of the Report resource produced by the Model
  // +kubebuilder:validation:Optional
  optional string reportName = 9;

  // In the case of failure, the Model resource controller will set this field with a failure message
  // +kubebuilder:validation:Optional
  optional string failureMessage = 10;

  // The progress percentage of the Model, which is derived from the Model's current phase
  // +kubebuilder:validation:Optional
  optional int32 progress = 11;

  // The name of the Dataset resource which the Model was trained with
  optional string datasetName = 12;

  // The name of the Study resource which the Model was trained with
  optional string studyName = 13;

  // The name of the Data Source resource which the Model was trained with
  optional string dataSourceName = 14;

  // The phase of the Model
  // +kubebuilder:default:="Pending"
  // +kubebuilder:validation:Optional
  optional string phase = 15;

  // Train contains the collection of measurements produced by validation on the training dataset
  // +kubebuilder:validation:Optional
  repeated github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.Measurement train = 16;

  // Train contains the collection of measurements produced by validation on the testing dataset
  // +kubebuilder:validation:Optional
  repeated github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.Measurement test = 17;

  // Validation contains the collection of measurements produced by cross-validation or validation on the validation dataset
  // +kubebuilder:validation:Optional
  repeated github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.Measurement validation = 18;

  // The location of the Report produced by the Model
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation reportLocation = 19;

  // TrainDatasetLocation specifies the location of the training dataset
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation trainDatasetLocation = 20;

  // TestDatasetLocation specifies the location of the testing dataset
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation testDatasetLocation = 21;

  // ValidationDatasetLocation specifies the location of the validation dataset
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation validationDatasetLocation = 22;

  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation trainWeightsLocation = 23;

  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation testWeightsLocation = 24;

  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation fullWeightsLocation = 25;

  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation labelEncoderLocation = 26;

  // The location of the model profile, which contains visualizations produced during the profiling phase
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation profileLocation = 27;

  // The location of the misclassification file produced during the testing phase
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation misclassificationLocation = 28;

  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation forecastLocation = 29;

  // The location of the packaged model
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation packageLocation = 30;

  // The collection of feature importance values, determined by impurity importance. Impurity importance
  // can only be set by estimators that natively support it, such as Random Forest
  // +kubebuilder:validation:Optional
  repeated FeatureImportance impurityImportance = 31;

  // The collection of feature importance values, determined by permutation importance
  // +kubebuilder:validation:Optional
  repeated FeatureImportance permutationImportance = 32;

  // Runtime contains information about the workload runtime
  // +kubebuilder:validation:Optional
  optional RuntimeStatus runtime = 33;

  // ServingStatus contains the status of the model in the case that it was deployed to a Predictor or Data App
  // +kubebuilder:validation:Optional
  optional ServingStatus serving = 34;

  // Sha256 of the model tar file
  // +kubebuilder:validation:Optional
  optional string tarFileHash = 35;

  // TrainingDataHash specifies the hashes for datasets used by the Model
  // +kubebuilder:validation:Optional
  optional DataHashes trainingDataHash = 36;

  // TrainingResources details the resources that were consumed by the training workload
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ResourceConsumption trainingResources = 37;

  // TestingResources details the resources that were consumed by the testing workload
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ResourceConsumption testingResources = 38;

  // Logs specifies the location of logs produced by workloads associated with the Model
  // +kubebuilder:validation:Optional
  repeated github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ContainerLog logs = 39;

  // The Roc/Auc curve of the trained model
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.RocAucCurve rocCurve = 40;

  // The Precision/Recall curve of the trained model
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.PRCurve prCurve = 41;

  // The confusion matrix of the train data.
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ConfusionMatrix trainConfusionMatrix = 42;

  // The confusion matrix of the test data
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ConfusionMatrix testConfusionMatrix = 43;

  // Approval specifies the current approval status for the Model
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.data.v1alpha1.ApprovalStatus approval = 44;

  // Interpretability contains results produced during the explaining phase of the Model
  // +kubebuilder:validation:Optional
  optional InterpretabilityStatus interpretability = 45;

  // Images specifies the container images used to train the model
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.Images images = 46;

  // The result of running the unit tests
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuiteResult unitTestResults = 47;

  // The sub models uri file contain the results of running the sub model
  // +kubebuilder:validation:Optional
  optional ModelGroupByStatus groupBy = 48;

  // Usage contains the resource consumption of the model
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ResourceConsumption usage = 49;

  // TrainStartTime represents the time at which the Model started training
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time trainingStartedAt = 50;

  // TrainCompletionTime represents the time at which the Model completed training
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time trainingCompletedAt = 51;

  // TestingStartedAt represents the time at which the Model started testing
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time testingStartedAt = 52;

  // TestingCompletedAt represents the time at which the Model completed testing
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time testingCompletedAt = 53;

  // CompletedAt represents the time at which the Model was marked as ready, failed, or aborted
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time completedAt = 54;

  // The last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time updatedAt = 55;

  // +kubebuilder:validation:Optional
  // +patchMergeKey=type
  // +patchStrategy=merge
  repeated k8s.io.apimachinery.pkg.apis.meta.v1.Condition conditions = 56;
}

message ModelTestSuite {
  // Baseline Model Ref specifies a previous model to compare against
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference baselineModelRef = 1;

  // The name of a labeled dataset used to test the model, when measuring a performance metric
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference datasetRef = 2;

  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuite unitTests = 3;
}

message NNLayerParameter {
  optional string name = 1;

  optional string value = 2;
}

message OutlierDetectorStatus {
  // The location of the drift detector model
  optional string outlierModelURI = 1;
}

// OutlierModelSpec specifies the configuration to train an outlier model
message OutlierModelSpec {
  // Enabled indicates if a density models should be trained
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool enabled = 1;

  // The density model alg.
  // +kubebuilder:default:="isolation-forest"
  // +kubebuilder:validation:Optional
  optional string outlierAlgorithm = 2;
}

message PercentilePrunerOptions {
  // Percentile which must be between 0 and 100 inclusive
  // +kubebuilder:default:=25
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Maximum=100
  // +kubebuilder:validation:Optional
  optional int32 percentile = 1;

  // Pruning is disabled until the given number of trials finish in the same ModelClass.
  // +kubebuilder:default:=5
  // +kubebuilder:validation:Optional
  optional int32 startupTrials = 2;

  //  Pruning is disabled until the trial exceeds the given number of step
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional int32 warmupSteps = 3;

  // Interval in number of steps between the pruning checks
  // +kubebuilder:default:=1
  // +kubebuilder:validation:Optional
  optional int32 intervalTrials = 4;

  // Minimum number of reported trials.
  // +kubebuilder:default:=1
  // +kubebuilder:validation:Optional
  optional int32 minTrials = 5;
}

message PrunerSpec {
  // The type of pruner to use during model search
  // +kubebuilder:default:=median-pruner
  // +kubebuilder:validation:Optional
  optional string type = 1;

  // +kubebuilder:validation:Optional
  optional MedianPrunerOptions median = 2;

  // +kubebuilder:validation:Optional
  optional PercentilePrunerOptions percentile = 3;

  // +kubebuilder:validation:Optional
  optional SuccessiveHalvingOptions successiveHalving = 4;

  // +kubebuilder:validation:Optional
  optional HyperbandOptions hyperband = 5;

  // +kubebuilder:validation:Optional
  optional ThresholdPrunerOptions threshold = 6;
}

// Define how to build a regression model for forecasting (including feature engineering)
// This is not implemented today
message RegressionForecasterSpec {
  // If true this is an ensemble pipeline
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool ensemble = 1;

  // +kubebuilder:default:=none
  // +kubebuilder:validation:Optional
  optional string imputation = 2;

  // The encoding method to use for categorical data types
  // +kubebuilder:default:=none
  // +kubebuilder:validation:Optional
  optional string encoding = 3;

  // The scaling method to use for numerical data types
  // +kubebuilder:default:=none
  // +kubebuilder:validation:Optional
  optional string scaling = 4;

  // If true apply the data transofmer to
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool date = 5;

  // The list of windows to use when generating features.
  // +kubebuilder:validation:Optional
  repeated int32 windows = 6;

  // The list of lags to use when generating features
  // +kubebuilder:validation:Optional
  repeated int32 lags = 7;

  // The list of metrics to generate for each combination of lag and windows.
  // The default list is min,max,median,stddev
  // +kubebuilder:validation:Optional
  repeated string functions = 8;

  // when computing moving avg, use exponential moving avg, other use regular moving avg
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool ema = 9;

  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool log = 10;

  // If we are using reduced model, this is the way the reduced model will make prediction
  // Default to none
  // +kubebuilder:validation:Optional
  optional string reduction = 11;
}

// +kubebuilder:object:root=true
// +kubebuilder:resource:path=reports,singular=report,categories={training,modela,all}
// +kubebuilder:subresource:status
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Status",type="string",JSONPath=".status.phase"
// +kubebuilder:printcolumn:name="Owner",type="string",JSONPath=".spec.owner",priority=1
// +kubebuilder:printcolumn:name="Version",type="string",JSONPath=".spec.versionName"
// +kubebuilder:printcolumn:name="Type",type="string",JSONPath=".spec.reportType"
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp",description=""
// Report represents a PDF file containing information compiled about another resource
message Report {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1;

  optional ReportSpec spec = 2;

  // +optional
  optional ReportStatus status = 3;
}

message ReportGroupByStatus {
  // The locations of the datasets profile files. Each file is the group
  // +kubebuilder:validation:Optional
  optional string reportsURI = 1;

  // Holds the worker on going result, when a worker finish, we update the location of thier result files
  // +kubebuilder:validation:Optional
  repeated github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.WorkerRunResult workerResults = 4;
}

// ReportList contains a list of Reports
// +kubebuilder:object:root=true
message ReportList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1;

  repeated Report items = 2;
}

// ReportSpec specifies the desired state of a Report
message ReportSpec {
  // VersionName references the name of a Data Product Version that describes the version of the resource
  // +kubebuilder:default:="latest"
  optional string versionName = 1;

  // EntityRef specifies the entity which the Report references. The supported entities consist of Dataset, Model, and Study resources
  optional k8s.io.api.core.v1.ObjectReference entityRef = 2;

  // The type of report (e.g. classification model report, study report)
  // +kubebuilder:validation:Required
  // +required
  optional string reportType = 3;

  // The format of the Report. `pdf` is the only supported type as of the current release
  // +kubebuilder:default:=pdf
  // +kubebuilder:validation:Optional
  optional string format = 4;

  // The name of the Notifier resource which Alerts created by the Report will be forwarded to
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.NotificationSpec notification = 5;

  // The name of the Account which created the object, which exists in the same tenant as the object
  // +kubebuilder:default:="no-one"
  // +kubebuilder:validation:Optional
  optional string owner = 6;

  // Resources specifies the resource requirements that will be allocated for the Report
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ResourceSpec resources = 7;

  // The deadline for any Jobs associated with the Report to be completed in seconds
  // +kubebuilder:default:=600
  // +kubebuilder:validation:Optional
  optional int64 timeout = 8;

  // The reference to the Lab namespace under which the report generation Job will be executed under.
  // If unspecified, the default Lab for the Data Product of the Report will be used
  // +kubebuilder:validation:Optional
  optional string labName = 9;

  // For group forecasting, this is the key of the group
  // +kubebuilder:validation:Optional
  repeated string key = 10;

  // The name of the Virtual Bucket where report artifacts will be stored.
  // If empty, it will default to the default Virtual Bucket for the Data Product of the Report
  // +kubebuilder:validation:Optional
  optional string artifactBucketName = 11;

  // ModelClassName specifies the name of the Model Class which created the Dataset, if applicable
  // +kubebuilder:validation:Optional
  optional string modelClassName = 12;

  // ModelClassRunName specifies the name of the Model Class Run which created the Dataset, if applicable
  // +kubebuilder:validation:Optional
  optional string modelClassRunName = 13;
}

// ReportStatus defines the observed state of a Report
message ReportStatus {
  // CompletedAt represents the time at which the Report was marked as completed, failed, or aborted
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time completedAt = 1;

  // The phase of the Report
  // +kubebuilder:default:="Pending"
  // +kubebuilder:validation:Optional
  optional string phase = 2;

  // The location of the report file, set after the Report is finished generating
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation location = 3;

  // ObservedGeneration is the last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 4;

  // In the case of failure, the Report resource controller will set this field with a failure reason
  // +kubebuilder:validation:Optional
  optional string failureReason = 5;

  // In the case of failure, the Report resource controller will set this field with a failure message
  // +kubebuilder:validation:Optional
  optional string failureMessage = 6;

  // Logs specifies the location of logs produced by workloads associated with the Report
  // +kubebuilder:validation:Optional
  repeated github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ContainerLog logs = 7;

  // The last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time updatedAt = 8;

  // The sub models uri file contain the results of running the sub model
  // +kubebuilder:validation:Optional
  optional ReportGroupByStatus groupby = 9;

  // +patchMergeKey=type
  // +patchStrategy=merge
  // +kubebuilder:validation:Optional
  repeated k8s.io.apimachinery.pkg.apis.meta.v1.Condition conditions = 10;
}

// RuntimeStatus contains information about the execution environment of the Model
message RuntimeStatus {
  // The Python version of the model trainer
  // +kubebuilder:validation:Optional
  optional string pythonVersion = 1;

  // The OS of the trainer container
  // +kubebuilder:validation:Optional
  optional string os = 3;

  // The Python packages used during training (produced by pip freeze)
  // +kubebuilder:validation:Optional
  map<string, string> pythonPackages = 4;
}

// SearchSpec specifies the configuration for a distributed model search
message SearchSpec {
  // The hyper-parameter optimization search method
  // +kubebuilder:default:=tpe
  // +kubebuilder:validation:Optional
  optional string sampler = 1;

  // Pruner specifies the configuration to run a model search using a pruning algorithm. Using a pruning
  // algorithm allows you to train a large number of candidate models with a subset of the dataset
  // +kubebuilder:validation:Optional
  optional PrunerSpec pruner = 2;

  // The maximum number of minutes, that the model search can run for
  // +kubebuilder:default:=60
  // +kubebuilder:validation:Minimum=1
  // +kubebuilder:validation:Maximum=10000
  // +kubebuilder:validation:Optional
  optional int32 maxTime = 4;

  // The maximum number of candidate models that will be sampled and trained
  // +kubebuilder:default:=10
  // +kubebuilder:validation:Minimum=1
  // +kubebuilder:validation:Maximum=1000
  // +kubebuilder:validation:Optional
  optional int32 maxModels = 5;

  // The maximum value for the primary objective needed to finish the search, after which the
  // search will automatically conclude if it is reached
  // +kubebuilder:default:=9999999999
  // +kubebuilder:validation:Optional
  optional double maxScore = 6;

  // The desired number of trainers that will train candidate models in parallel. The number
  // of trainers is restricted based on the allowance provided by the active License
  // +kubebuilder:default:=1
  // +kubebuilder:validation:Optional
  // +kubebuilder:validation:Maximum=50
  // +kubebuilder:validation:Minimum=0
  optional int32 trainers = 7;

  // The number of top candidate models that will be moved to the testing phase once the model search is complete.
  // If unspecified, only the best model will be retained
  // +kubebuilder:default:=1
  // +kubebuilder:validation:Minimum=1
  // +kubebuilder:validation:Maximum=5
  optional int32 test = 8;

  // The number of top candidate models, sorted by their objective score, that will be retained in
  // the case that garbage collection is enabled. If this number is less than Test, then RetainTop will
  // be ignored and the value of Test will be used instead
  // +kubebuilder:default:=1
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Maximum=100
  optional int32 retainTop = 9;

  // The time, in minutes, for which candidate models (excluding the best model) will be
  // retained, after which they will be garbage collected
  // +kubebuilder:default:=60
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Maximum=2400
  // +kubebuilder:validation:Optional
  optional int32 retainFor = 10;

  // SearchSpace specifies the algorithms available to candidate models
  // +kubebuilder:validation:Optional
  optional AlgorithmSearchSpaceSpec searchSpace = 11;

  // EarlyStop specifies the configuration for early stopping
  // +kubebuilder:validation:Optional
  optional EarlyStopSpec earlyStop = 12;

  // The objective metric that will be measured against all models to evaluate their performance
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ObjectiveSpec objective = 13;

  // The second objective metric that will be measured and evaluated in tandem with the primary objective.
  // The model search optimizer will attempt to optimize both metrics
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ObjectiveSpec secondaryObjective = 14;

  // +kubebuilder:default:="maximize"
  // +kubebuilder:validation:Optional
  optional string goal = 15;
}

// Define the seasonality for a period (yearly / monthly / daily)
message SeasonalityPeriodSpec {
  // Is the seasonality exist
  // +kubebuilder:validation:Optional
  optional bool enabled = 1;

  // Infer the seasonality
  // +kubebuilder:validation:Optional
  optional bool auto = 2;

  // If enabled, the number of data points in the interval
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional int32 fourierOrder = 3;
}

message SeasonalitySpec {
  // If true infer the seasonality
  // +kubebuilder:validation:Optional
  optional bool auto = 1;

  // +kubebuilder:validation:Optional
  optional SeasonalityPeriodSpec yearly = 2;

  // +kubebuilder:validation:Optional
  optional SeasonalityPeriodSpec quarterly = 3;

  // +kubebuilder:validation:Optional
  optional SeasonalityPeriodSpec monthly = 4;

  // +kubebuilder:validation:Optional
  optional SeasonalityPeriodSpec weekly = 5;

  // +kubebuilder:validation:Optional
  optional SeasonalityPeriodSpec daily = 6;
}

// Define a test stage
message ServingEnvironment {
  // The stage name
  optional string name = 1;

  // the Tests to run in this environment, once the predictor is ready.
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuite tests = 2;

  // The serving site ref
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference servingSiteRef = 3;

  // Define the predictor access in this environment.
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.AccessSpec access = 4;

  // The number of replicas in this environment.
  // +kubebuilder:default:=1
  // +kubebuilder:validation:Optional
  optional int32 replicas = 5;

  // Deploy the predictor for online serving in this environment
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool online = 6;

  // Deploy the dashboard for online serving in this environment
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool dashboard = 7;

  // The resources to use when running tests at this stage
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ResourceSpec resources = 8;

  // List of SQL statements to run before training
  // +kubebuilder:validation:Optional
  repeated string preSQL = 9;

  // List of SQL statements to run after training
  // +kubebuilder:validation:Optional
  repeated string postSQL = 10;
}

// ServingSpec specifies the requirements to serve a model
message ServingSpec {
  // Enabled indicates if automatic model serving is enabled. If false or unspecified, the Study or Model Class
  // managing the model will not create or update serving resources for the Model
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool enabled = 1;

  // PredictorName specifies the name of a Predictor to create or update.
  // If unspecified, a live Predictor will not be created for the model
  optional string predictorName = 2;

  // Resources specifies the resources that will be allocated to the Predictor
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ResourceSpec resources = 3;

  // The reference to the Serving Site under which serving resources will be created
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference servingSiteRef = 6;

  // Dashboard indicates if a Data App will be created for the Model
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool dashboard = 8;

  // Access specifies the configuration for the Predictor service to be exposed externally
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.AccessSpec access = 9;

  // Replicas specifies the number of replicas that will be created for the Predictor
  // +kubebuilder:default:=1
  // +kubebuilder:validation:Optional
  optional int32 replicas = 10;

  // Promotion specifies the promotion policy for the Predictor
  // +kubebuilder:default:=none
  // +kubebuilder:validation:Optional
  optional string promotion = 12;
}

message ServingStatus {
  // The name of the Predictor hosting this model
  // +kubebuilder:validation:Optional
  optional string predictorName = 2;

  // The name of the Data App hosting the model
  // +kubebuilder:validation:Optional
  optional string dataAppName = 3;

  // The endpoint of the model served by a Predictor
  // +kubebuilder:validation:Optional
  optional string predictorEndpoint = 4;

  // The endpoint of the model served by a Data App
  // +kubebuilder:validation:Optional
  optional string dashboardEndpoint = 5;

  // Role indicates the role of the model deployed after it is deployed within a Predictor
  // +kubebuilder:default:="none"
  // +kubebuilder:validation:Optional
  optional string role = 6;
}

// +kubebuilder:subresource:status
// +kubebuilder:resource:path=studies,singular=study,shortName=sd,categories={training,modela}
// +kubebuilder:object:root=true
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Owner",type="string",JSONPath=".spec.owner",priority=1
// +kubebuilder:printcolumn:name="Dataset",type="string",JSONPath=".spec.snapshot.dataset"
// +kubebuilder:printcolumn:name="Task",type="string",JSONPath=".spec.task"
// +kubebuilder:printcolumn:name="Objective",type="string",JSONPath=".spec.search.objective.metric"
// +kubebuilder:printcolumn:name="Last Run",type="date",JSONPath=".status.lastRunAt",description=""
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp"
// Study represents an automatic search for the best machine learning model for a given dataset
message Study {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1;

  optional StudySpec spec = 2;

  // +optional
  optional StudyStatus status = 3;
}

// StudyList contains a list of Studies
// +kubebuilder:object:root=true
message StudyList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1;

  repeated Study items = 2;
}

// +kubebuilder:subresource:status
// +kubebuilder:resource:path=studyruns,singular=studyrun,shortName=sr,categories={training,modela}
// +kubebuilder:object:root=true
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Phase",type="string",JSONPath=".status.phase"
// +kubebuilder:printcolumn:name="Owner",type="string",JSONPath=".spec.owner",priority=1
// +kubebuilder:printcolumn:name="Version",type="string",JSONPath=".status.runVersion",priority=1
// +kubebuilder:printcolumn:name="Progress",type="number",JSONPath=".status.progress",priority=1
// +kubebuilder:printcolumn:name="Study",type="string",JSONPath=".spec.studyName"
// +kubebuilder:printcolumn:name="Best Score",type="number",JSONPath=".status.bestModelScore"
// +kubebuilder:printcolumn:name="Best Model",type="string",JSONPath=".status.bestModel"
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp"
// StudyRun represents the single execution of a Study
message StudyRun {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1;

  optional StudyRunSpec spec = 2;

  // +optional
  optional StudyRunStatus status = 3;
}

// StudyRunList contains a list of StudyRuns
// +kubebuilder:object:root=true
message StudyRunList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1;

  repeated StudyRun items = 2;
}

// StudyRunPhaseStatus contains the statistics for a single phase of a Study
message StudyRunPhaseStatus {
  // The time at which the phase started
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time startedAt = 1;

  // The time at which the phase concluded
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time completedAt = 2;

  // The number of models pending training
  // +kubebuilder:validation:Optional
  optional int32 waitingModelsCount = 3;

  // The number of models currently being trained
  // +kubebuilder:validation:Optional
  optional int32 runningModelsCount = 4;

  // The number of models that experienced an error whilst training
  // +kubebuilder:validation:Optional
  optional int32 failedModelsCount = 5;

  // The number of models that have been successfully trained
  // +kubebuilder:validation:Optional
  optional int32 completedModelsCount = 6;

  // Best score so far in this phase. The best score is the value of the objective.
  // +kubebuilder:validation:Optional
  optional double bestScore = 7;

  // Actual number of models where no progress was made. This used to decide on early stop.
  // +kubebuilder:validation:Optional
  optional int32 modelsWithNoProgress = 8;
}

// StudyRunSpec defines the run configuration for a Study
message StudyRunSpec {
  // Owner specifies the name of the Account which the object belongs to
  // +kubebuilder:default:="no-one"
  // +kubebuilder:validation:Optional
  optional string owner = 1;

  // DatasetName specifies the name of the Study resource which the run will use to
  // determine the parameters for the model search
  // +kubebuilder:validation:Required
  // +required
  optional string studyName = 2;

  // Timout specifies the time in seconds for the run to be completed
  // +kubebuilder:validation:Optional
  optional int32 timeout = 3;

  // If true, the execution of new workloads associated with the run will be paused
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool pause = 4;

  // If true, the run will be permanently aborted and all workloads created by the run will be removed
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool abort = 5;

  // ModelClassRunName specifies the name of the Model Class Run which created the run, if applicable
  // +kubebuilder:validation:Optional
  optional string modelClassRunName = 6;
}

// StudyRunStatus defines the observed state of a StudyRun
message StudyRunStatus {
  // ObservedGeneration is the last generation that was reconciled
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 1;

  // StudyManifestLocation specifies the location of the Study manifest used during the course of the run
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ManifestLocation studyManifestLocation = 2;

  // RunVersion specifies the version of the run, which is determined when the Study manifest is saved
  optional uint32 runVersion = 4;

  // The phase of the Study
  // +kubebuilder:default:="Pending"
  // +kubebuilder:validation:Optional
  optional string phase = 5;

  // The number of rows in the training dataset
  // +kubebuilder:validation:Optional
  optional int32 trainingRowsCount = 6;

  // The number of rows in the testing dataset
  // +kubebuilder:validation:Optional
  optional int32 testingRowsCount = 7;

  // The number of rows in the validation dataset
  // +kubebuilder:validation:Optional
  optional int32 validationRowsCount = 8;

  // The progress percentage of the Study, which is derived from the Study's current phase
  // +kubebuilder:validation:Optional
  optional int32 progress = 9;

  // Total models created for the study
  // +kubebuilder:validation:Optional
  optional int32 modelsCount = 10;

  // The name of the Model resource which was determined to be the highest-performing
  // +kubebuilder:validation:Optional
  optional string bestModel = 11;

  // The score of the Model resource which was determined to be the highest-performing
  // +kubebuilder:validation:Optional
  optional double bestModelScore = 12;

  // ReportName specifies the name of the Report generated by the StudyRun
  // +kubebuilder:validation:Optional
  optional string reportName = 13;

  // ProfileLocation specifies the location of the profile file produced by the StudyRun
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation profileLocation = 14;

  // TrainDatasetLocation specifies the location of the training dataset
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation trainDatasetLocation = 15;

  // TestDatasetLocation specifies the location of the testing dataset
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation testDatasetLocation = 16;

  // ValidationDatasetLocation specifies the location of the validation dataset
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation validationDatasetLocation = 17;

  // OptimizerLocation specifies the location of the optimizer database relevant to the Study
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.FileLocation optimizerLocation = 18;

  // The Kubernetes-internal ID of the last Model resource generated by the Study
  optional int64 lastModelID = 19;

  // FailureMessage is set to a failure message in the case that an error occurred during the run
  // +kubebuilder:validation:Optional
  optional string failureMessage = 20;

  // GC specifies the status of garbage collection relevant to the Study
  optional GarbageCollectionStatus gc = 21;

  // TrainingDataHash specifies the hashes for datasets used by the Study
  // +kubebuilder:validation:Optional
  optional DataHashes trainingDataHash = 22;

  // Logs specifies the location of logs produced by workloads associated with the Study
  // +kubebuilder:validation:Optional
  repeated github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ContainerLog logs = 23;

  // BaselineStatus contains the status of the baseline phase
  // +kubebuilder:validation:Optional
  optional StudyRunPhaseStatus baseline = 24;

  // SearchStatus contains the status of the model search phase
  // +kubebuilder:validation:Optional
  optional StudyRunPhaseStatus search = 25;

  // EnsembleStatus contains the status of the ensemble phase
  // +kubebuilder:validation:Optional
  optional StudyRunPhaseStatus ensemble = 26;

  // TestStatus contains the status of the testing phase
  // +kubebuilder:validation:Optional
  optional StudyRunPhaseStatus test = 27;

  // ExplainStatus contains the status of the explaining phase
  // +kubebuilder:validation:Optional
  optional StudyRunPhaseStatus explain = 28;

  // OutlierDetection is the status for outlier detection
  // +kubebuilder:validation:Optional
  optional OutlierDetectorStatus outlierDetection = 29;

  // UpdatedAt specifies the last time the run was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time updatedAt = 30;

  // CompletedAt represents the time at which the Study was marked as completed, failed, or aborted
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time completedAt = 31;

  // +optional
  // +patchMergeKey=type
  // +patchStrategy=merge
  repeated k8s.io.apimachinery.pkg.apis.meta.v1.Condition conditions = 32;
}

// StudySpec defines the desired parameters for a Study
message StudySpec {
  // Owner specifies the name of the Account which the object belongs to
  // +kubebuilder:default:="no-one"
  // +kubebuilder:validation:Optional
  optional string owner = 1;

  // The user-provided description of the Study
  // +kubebuilder:default:=""
  // +kubebuilder:validation:MaxLength=512
  // +kubebuilder:validation:Optional
  optional string description = 2;

  // RunSpec specifies the configuration for runs created by the Study
  // +kubebuilder:validation:Required
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.RunSpec run = 3;

  // The name of the Virtual Bucket where artifacts generated by the Study will be stored.
  // If empty, default to the Data Product's default artifact bucket
  // +kubebuilder:validation:Optional
  optional string artifactBucketName = 4;

  // The name of the Lab under which Jobs created by the Study will be executed.
  // If empty, default to the Data Product's default Lab
  // +kubebuilder:validation:Optional
  optional string labName = 5;

  // Snapshot contains the reference to the Dataset Snapshot that will be used to train models.
  // The dataset will be split into individual training, testing, and validation datasets
  // +kubebuilder:validation:Required
  // +required
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.SnapshotReference snapshot = 6;

  // The machine learning task type (i.e. regression, classification)
  // +kubebuilder:validation:Required
  // +required
  optional string task = 7;

  // The machine learning subtask relevant to the primary task (text classification, image object detection, etc.)
  // +kubebuilder:default:=none
  // +kubebuilder:validation:Optional
  optional string subtask = 8;

  // FeatureEngineering specifies the feature engineering pipeline for models created by the Study
  // +kubebuilder:validation:Optional
  optional FeatureEngineeringSpec featureEngineering = 9;

  // ImbalanceHandler specifies the configuration to train models with imbalance handling
  // +kubebuilder:validation:Optional
  optional ImbalanceHandlingSpec imbalanceHandler = 10;

  // Baseline specifies the parameters to generate baseline (default hyper-parameters) models
  // +kubebuilder:validation:Optional
  optional BaselineSpec baseline = 11;

  // Search specifies the configuration to perform the model search for the best algorithm and hyperparameters
  // +kubebuilder:validation:Optional
  optional SearchSpec search = 12;

  // Ensembles specifies to parameters to generate ensemble models
  // +kubebuilder:validation:Optional
  optional EnsemblesSpec ensembles = 13;

  // TrainingTemplate specifies the configuration to train and evaluate models
  // +kubebuilder:validation:Optional
  optional TrainingSpec trainingTemplate = 14;

  // Split specifies the configuration to generate training and testing datasets prior to model training
  // +kubebuilder:validation:Optional
  optional DataSplitSpec split = 15;

  // ForecastSpec specifies the parameters required when generating a forecasting model
  // +kubebuilder:validation:Optional
  optional ForecasterSpec forecastTemplate = 16;

  // Interpretability specifies the parameters to create interpretability visualizations for the final model
  // +kubebuilder:validation:Optional
  optional InterpretabilitySpec interpretability = 17;

  // +kubebuilder:validation:Optional
  optional OutlierModelSpec outlierModel = 18;

  // UnitTestsTemplate defines the test suite that will be executed on the model produced by the Study
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuite unitTestsTemplate = 19;

  // Serving defines the serving and promotion policy for the selected model of the Study
  // by default there is no serving policy
  // +kubebuilder:validation:Optional
  optional ServingSpec serving = 20;

  // GarbageCollectionSpec specifies the configuration to automatically clean-up unused models
  // +kubebuilder:validation:Optional
  optional GarbageCollectionSpec gc = 21;

  // The notification specification that determines which notifiers will receive Alerts generated by the object
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.NotificationSpec notification = 22;

  // If true, a report will be generated for the Study
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool report = 23;

  // If true, the Study will be profiled after the conclusion of it's model search
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool profile = 24;

  // If true, Shapley values (and relevant visualizations) will be calculated for the highest-performing Model
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool explain = 25;

  // Fast indicates if Models associated with the Study should skip profiling, explaining, and reporting
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool fast = 26;

  // The Model Class which created the Study, if applicable
  // +kubebuilder:validation:Optional
  optional string modelClassName = 27;
}

// StudyStatus defines the observed state of a Study
message StudyStatus {
  // ObservedGeneration specifies the last generation that was reconciled
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 1;

  // Active contains a collection of references to currently active runs
  // +optional
  repeated github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.RunReference active = 2;

  // LastRunVersion contains the integer version last used to create a run
  // +kubebuilder:default:=0
  optional uint32 lastRunVersion = 4;

  // AvailableRuns contains the collection of run versions which are ready for use.
  // Each version corresponds with an existing StudyRun resource
  // +kubebuilder:validation:Optional
  repeated github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.RunReference availableRuns = 5;

  // LastRunAt specifies the time at which a run was last created for the Study
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastRunAt = 6;

  // LastFailureMessage specifies the failure message of the last run. If the last snapshot succeeded, the field will be cleared
  // +kubebuilder:validation:Optional
  optional string lastFailureMessage = 7;

  // Schedule specifies the status of the run schedule
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.RunScheduleStatus schedule = 8;

  // UpdatedAt specifies the last time the Study was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time updatedAt = 9;

  // +optional
  // +patchMergeKey=type
  // +patchStrategy=merge
  repeated k8s.io.apimachinery.pkg.apis.meta.v1.Condition conditions = 10;
}

message SuccessiveHalvingOptions {
  // Minimum number of reported trials.
  // +kubebuilder:default:=1
  // +kubebuilder:validation:Optional
  optional int32 minResources = 1;

  // A parameter for specifying reduction factor of promotable trials
  // +kubebuilder:default:=4
  // +kubebuilder:validation:Optional
  optional int32 reductionFactor = 2;

  // A parameter for specifying the minimum early-stopping rate
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional int32 minEarlyStoppingRate = 3;

  // Minimum number of trials that need to complete a rung before any trial is considered for promotion into the next rung.
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional int32 bootstrapCount = 4;
}

// SuccessiveHalvingSpec records the position of a single model in a successive halving search
message SuccessiveHalvingSpec {
  // The budget to be used in a multi-fidelity search, for example the number of epochs
  // or the percentage of data to train the model with
  // +kubebuilder:validation:Optional
  // +kubebuilder:validation:Maximum=128
  // +kubebuilder:validation:Minimum=0
  optional int32 budget = 1;

  // The bracket of the model
  // +kubebuilder:validation:Optional
  // +kubebuilder:validation:Maximum=128
  // +kubebuilder:validation:Minimum=0
  optional int32 bracket = 2;

  // The rung of the model
  // +kubebuilder:validation:Optional
  // +kubebuilder:validation:Maximum=128
  // +kubebuilder:validation:Minimum=0
  optional int32 rung = 3;

  // The configuration ID allocated to the model
  // +kubebuilder:validation:Optional
  optional int32 confID = 4;

  // The type of modality, based on the type of model
  // For classical models, it should be based on data percentage
  // For deep models, it should be based on epochs
  // +kubebuilder:validation:Optional
  optional string modality = 26;
}

// TextPipelineSpec represents a single pipeline for transforming text data
message TextPipelineSpec {
  // The text encoder (e.g. TFIDF)
  // +kubebuilder:default:=auto
  // +kubebuilder:validation:Optional
  optional string encoder = 1;

  // The text tokenizer character
  // +kubebuilder:validation:Optional
  optional string tokenizer = 2;

  // Indicates if the pipeline will add stop word handling
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool stopwords = 3;

  // Indicates if the pipeline will add part-of-speech handling
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool pos = 4;

  // Indicates if the pipeline will implement lemmatization
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool lemma = 5;

  // Indicates if the pipeline will implement word stemming
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool stem = 6;

  // Indicates if the pipeline will generate a word embedding
  // +kubebuilder:validation:Optional
  optional string embedding = 7;

  // Indicates if the pipeline will add singular value decomposition
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool svd = 8;

  // The maximum number of SVD components to use, if applicable
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional int32 maxSvdComponents = 9;
}

message ThresholdPrunerOptions {
  // A minimum value which determines whether pruner prunes or not. If an intermediate value is smaller than lower, it prunes.
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional double lower = 1;

  // A maximum value which determines whether pruner prunes or not. If an intermediate value is larger than upper, it prunes.
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional double upper = 2;

  //  Pruning is disabled until the trial exceeds the given number of step
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional int32 warmupSteps = 3;

  // Interval in number of steps between the pruning checks
  // +kubebuilder:default:=1
  // +kubebuilder:validation:Optional
  optional int32 intervalSteps = 4;
}

message TimeSeriesEvent {
  // Set to true if this event is an holiday
  // +kubebuilder:validation:Optional
  optional string name = 1;

  // Set to true if this event is an holiday
  // +kubebuilder:validation:Optional
  optional string method = 2;

  // Set to true if this event is an holiday
  // +kubebuilder:validation:Optional
  optional bool holiday = 3;

  // If this event is an holiday, this is the holiday country
  // +kubebuilder:validation:Optional
  optional string country = 4;

  // Pre event window, that might have event effects
  // +kubebuilder:validation:Optional
  optional int32 preEvent = 5;

  // Post event windows the might have event effects.
  // +kubebuilder:validation:Optional
  optional int32 postEvent = 6;

  // The time points to mark the events
  // +kubebuilder:validation:Optional
  repeated string timePoints = 7;
}

// TrainingSpec specifies the configuration of a model training workload
message TrainingSpec {
  // The name of the Lab under which the model training Job will be created
  optional string labName = 1;

  // The priority of the Kubernetes Job created by the Model (medium, by default)
  // +kubebuilder:validation:Optional
  // +kubebuilder:default:="medium"
  optional string priority = 2;

  // The type of cross-validation to use, in the case that a validation dataset is not enabled
  // +kubebuilder:default:=kfold
  // +kubebuilder:validation:Optional
  optional string cvType = 3;

  // The number of folds to use during cross-validation. If set to 0, cross-validation will be disabled
  // +kubebuilder:default:=5
  // +kubebuilder:validation:Optional
  optional int32 folds = 5;

  // SuccessiveHalving specifies the configuration for a Study to execute a model search using successive halving
  // +kubebuilder:validation:Optional
  optional SuccessiveHalvingSpec sh = 10;

  // The random state used for the model's estimator, if applicable (for example, in RandomForestClassifier)
  // +kubebuilder:default:=42
  // +kubebuilder:validation:Optional
  optional double seed = 11;

  // Resources specifies the resource requirements allocated to the model training workload
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ResourceSpec resources = 12;

  // Indicates if a GPU will be allocated for model training
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool gpu = 13;

  // Indicates if feature importance for the model will be computed as part of training. Some algorithms
  // (e.g. Random Forest) have built in support for feature importance
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool featureImportance = 15;

  // The number percentage (0 through 100) of rows to be used during training
  // +kubebuilder:default:=100
  // +kubebuilder:validation:Optional
  optional int32 samplePct = 17;

  // Checkpoint specifies the location to store model checkpoints
  // +kubebuilder:validation:Optional
  optional CheckpointSpec checkpoint = 18;

  // The maximum log level for logs produced by Jobs associated with the Model
  // +kubebuilder:default:=info
  // +kubebuilder:validation:Optional
  optional string logLevel = 19;

  // The maximum time, in seconds, that Jobs associated with the Model can run for before being forcefully cancelled
  // +kubebuilder:default:=600
  // +kubebuilder:validation:Optional
  optional int32 timeout = 20;
}

message UnivariateForecastStatus {
  // URI for the grid search result
  // +kubebuilder:validation:Optional
  optional string gridSearchResultURI = 1;

  // The best estimator
  // +kubebuilder:validation:Optional
  optional ClassicalEstimatorSpec baseEstimator = 2;

  // URI of the model
  // +kubebuilder:validation:Optional
  optional string modelURI = 3;

  // URI of the backtest result
  // +kubebuilder:validation:Optional
  optional string cvResultURI = 4;

  // URI to the actual forecast
  // +kubebuilder:validation:Optional
  optional string forecastURI = 5;
}

// VideoPipelineSpec represents a single pipeline for preprocessing video data
message VideoPipelineSpec {
  // The date time imputer.
  // +kubebuilder:default:="auto"
  // +kubebuilder:validation:Optional
  optional string featurizer = 1;
}

// Define a window on the time series.
message WindowSpec {
  // The period interval
  // +kubebuilder:validation:Optional
  optional string interval = 1;

  // The number of intervals to start. If the start is more than 0, there is a gap.
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional int32 start = 2;

  // The window length
  // +kubebuilder:validation:Optional
  optional int32 length = 3;
}


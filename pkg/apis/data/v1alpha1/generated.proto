/**
*
* Copyright (C) 2017 modela authors
* For license information, see LICENSE.txt
*/
// This file was autogenerated by go-to-protobuf. Do not edit it manually!

syntax = "proto2";

package github.com.metaprov.modelaapi.pkg.apis.data.v1alpha1;

import "github.com/gogo/protobuf/gogoproto/gogo.proto";
import "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1/generated.proto";
import "k8s.io/api/core/v1/generated.proto";
import "k8s.io/apimachinery/pkg/apis/meta/v1/generated.proto";
import "k8s.io/apimachinery/pkg/runtime/generated.proto";
import "k8s.io/apimachinery/pkg/runtime/schema/generated.proto";

// Package-wide variables from generator "generated".
option (gogoproto.marshaler_all) = true;
option (gogoproto.stable_marshaler_all) = true;
option (gogoproto.sizer_all) = true;
option (gogoproto.goproto_stringer_all) = false;
option (gogoproto.stringer_all) = true;
option (gogoproto.unmarshaler_all) = true;
option (gogoproto.goproto_unrecognized_all) = false;
option (gogoproto.goproto_enum_prefix_all) = false;
option (gogoproto.goproto_getters_all) = false;
option go_package = "github.com/metaprov/modelaapi/pkg/apis/data/v1alpha1";

// Bar Chart
message BarChartSpec {
  // Dataset is the name of the dataset
  // +kubebuilder:validation:Optional
  optional string datasetName = 1 [(gogoproto.customname) = "DatasetName"];

  // name of the X column
  // +kubebuilder:validation:Optional
  optional string x = 2 [(gogoproto.customname) = "X"];

  // Y column
  // +kubebuilder:validation:Optional
  optional string y = 3 [(gogoproto.customname) = "Y"];

  // Show borther
  // +kubebuilder:validation:Optional
  optional bool legend = 4 [(gogoproto.customname) = "Legend"];

  // Show borther
  // +kubebuilder:validation:Optional
  optional bool sort = 5 [(gogoproto.customname) = "Sort"];
}

// Column specifies the attribute of a single column in a dataset. The fields of the Column align with the
// JSON schema standard; you can view detailed documentation at https://json-schema.org/draft/2020-12/json-schema-validation.html
message Column {
  // The name of the column
  // +kubebuilder:validation:MaxLength=63
  // +kubebuilder:validation:MinLength=1
  optional string name = 1 [(gogoproto.customname) = "Name", (gogoproto.nullable) = false];

  // The display name of the column, which is used in reports and other visual elements. If omitted, it will use the raw name
  // +kubebuilder:validation:MaxLength=63
  // +kubebuilder:validation:Optional
  optional string displayName = 2 [(gogoproto.customname) = "DisplayName"];

  // The data type of the feature (e.g. number, string, boolean, etc.)
  optional string datatype = 3 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.DataType", (gogoproto.customname) = "DataType", (gogoproto.nullable) = false];

  // The data domain of the feature, which constrains the contents of the feature to a specific set of values
  // +kubebuilder:validation:Optional
  optional string format = 4 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.DataDomain", (gogoproto.customname) = "Format"];

  // The user-specified description of the feature
  // +kubebuilder:validation:MaxLength=63
  // +kubebuilder:validation:Optional
  optional string description = 5 [(gogoproto.customname) = "Description"];

  // Indicates if the feature should be ignored when building models
  // +kubebuilder:validation:Optional
  optional bool ignore = 6 [(gogoproto.customname) = "Ignore"];

  // Indicates if the feature is the target feature of the model, and the feature which predictions will be made on
  // +kubebuilder:validation:Optional
  optional bool target = 7 [(gogoproto.customname) = "Target"];

  // Indicates if the column can contain null values
  // +kubebuilder:validation:Optional
  optional bool nullable = 8 [(gogoproto.customname) = "Nullable"];

  // Denotes if the column specifies a primary key of a database table (i.e. a users ID)
  // +kubebuilder:validation:Optional
  optional bool pk = 9 [(gogoproto.customname) = "PK"];

  // Denotes if the column specifies a foreign key of another database table
  // +kubebuilder:validation:Optional
  optional bool fk = 10 [(gogoproto.customname) = "FK"];

  // The integer value which the values of the column should be a multiple of
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Optional
  optional int32 multipleOf = 11 [(gogoproto.customname) = "MultipleOf"];

  // The maximum value of values all values in the column
  // +kubebuilder:validation:Optional
  optional double maximum = 12 [(gogoproto.customname) = "Maximum"];

  // The exclusive upper limit of all values in the column, which does not include the maximum value
  // +kubebuilder:validation:Optional
  optional bool exclusiveMaximum = 13 [(gogoproto.customname) = "ExclusiveMaximum"];

  // The minimum value of values all values in the column
  // +kubebuilder:validation:Optional
  optional double minimum = 14 [(gogoproto.customname) = "Minimum"];

  // The exclusive lower limit of all values in the column, which does not include the minimum value
  // +kubebuilder:validation:Optional
  optional bool exclusiveMinimum = 15 [(gogoproto.customname) = "ExclusiveMinimum"];

  // The maximum length of values in the column, if the column data type is a string
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Optional
  optional int32 maxLength = 16 [(gogoproto.customname) = "MaxLength"];

  // The minimum length of values in the column, if the column data type is a string
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Optional
  optional int32 minLength = 17 [(gogoproto.customname) = "MinLength"];

  // The regex pattern which values in the column must adhere to
  // +kubebuilder:validation:Optional
  optional string pattern = 18 [(gogoproto.customname) = "Pattern"];

  // Required
  // +kubebuilder:validation:Optional
  optional bool required = 19 [(gogoproto.customname) = "Required"];

  // A user-specified example value
  // +kubebuilder:validation:Optional
  optional string example = 20 [(gogoproto.customname) = "Example"];

  // A link to user-specified external documentation
  // +kubebuilder:validation:Optional
  optional string externalDocs = 21 [(gogoproto.customname) = "ExternalDocs"];

  // The collection of unique values for categorical features
  // +kubebuilder:validation:Optional
  repeated string enum = 22 [(gogoproto.customname) = "Enum"];

  // Indicates if the feature is ordinal, in the case of categorical features
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool ordinal = 23 [(gogoproto.customname) = "Ordinal"];

  // The maximum number of items if the column is a list of values
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Optional
  optional int32 maxItems = 24 [(gogoproto.customname) = "MaxItems"];

  // The minimum number of items if the column is a list of values
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Optional
  optional int32 minItems = 25 [(gogoproto.customname) = "MinItems"];

  // Enforce that all the items in the list are unique
  // +kubebuilder:validation:Optional
  optional bool uniqueItems = 26 [(gogoproto.customname) = "UniqueItems"];

  // Indicates if the column contains personally identifiable information
  // +kubebuilder:validation:Optional
  optional bool pii = 28 [(gogoproto.customname) = "PII"];

  // Indicates if the column contains personal health information
  // +kubebuilder:validation:Optional
  optional bool phi = 29 [(gogoproto.customname) = "PHI"];

  // Indicates if the column contains any personal data
  // +kubebuilder:validation:Optional
  optional bool personalData = 30 [(gogoproto.customname) = "PersonalData"];

  // Protected means that this feature is important for ethical AI / Fairness
  // +kubebuilder:validation:Optional
  optional bool protected = 31 [(gogoproto.customname) = "Protected"];

  // The default value for number types; used internally for synthetic data and validation
  optional double defaultValueNum = 32 [(gogoproto.customname) = "DefaultValueNum"];

  // Indicates if values from this column will be sampled on a logarithmic scale
  // +kubebuilder:validation:Optional
  optional bool log = 33 [(gogoproto.customname) = "Log"];

  // Mu is the mean of the normal distribution
  // +kubebuilder:validation:Optional
  optional double mu = 34 [(gogoproto.customname) = "Mu"];

  // Sigma is the standard deviation of the distribution
  // +kubebuilder:validation:Optional
  optional double sigma = 35 [(gogoproto.customname) = "Sigma"];

  // The threshold skew for skew detection for the feature represented by this feature.
  // +kubebuilder:validation:Optional
  optional double skewThreshold = 36 [(gogoproto.customname) = "SkewThreshold"];

  // The threshold drift value for model drift detection for the feature represented by this feature
  // +kubebuilder:validation:Optional
  optional double driftThreshold = 37 [(gogoproto.customname) = "DriftThreshold"];

  // Indicates if the column is an key column
  // +kubebuilder:validation:Optional
  optional bool key = 38 [(gogoproto.customname) = "Key"];

  // Indicates if the column holds fold values
  // +kubebuilder:validation:Optional
  optional bool fold = 39 [(gogoproto.customname) = "Fold"];

  // If True than this is a weight column
  // +kubebuilder:validation:Optional
  optional bool weight = 40 [(gogoproto.customname) = "Weight"];

  // Indicates that the feature should always be used in training
  // +kubebuilder:validation:Optional
  optional bool reserved = 41 [(gogoproto.customname) = "Reserved"];

  // The recommended imputation method for the column
  // +kubebuilder:validation:Optional
  optional string imputation = 42 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.Imputation", (gogoproto.customname) = "Imputation"];

  // The recommended scaling method for the column
  // +kubebuilder:validation:Optional
  optional string scaling = 43 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.Scaling", (gogoproto.customname) = "Scaling"];

  // Indicates if the feature was automatically generated
  // +kubebuilder:validation:Optional
  optional bool generated = 44 [(gogoproto.customname) = "Generated"];

  // The formula used to generate the column
  // +kubebuilder:validation:Optional
  optional string formula = 45 [(gogoproto.customname) = "Formula"];

  // Indicates if the column is an ID column
  // +kubebuilder:validation:Optional
  optional bool id = 46 [(gogoproto.customname) = "ID"];

  // The step value if the column values are a sequence of numbers
  // +kubebuilder:validation:Optional
  optional double step = 47 [(gogoproto.customname) = "Step"];

  // Contain the Index for the column in the schema
  // +kubebuilder:validation:Optional
  optional int32 loc = 48 [(gogoproto.customname) = "Loc", (gogoproto.nullable) = false];

  // The format of the datetime column. This is only setup if the column contain datetime type.
  // +kubebuilder:validation:Optional
  optional string datetimeFormat = 49 [(gogoproto.customname) = "DateTimeFormat"];

  // Indicates if the column is contain a time series,
  // In case of forecasting, if only one column is a time series, this is a univariate time series
  // Otherwise, if two or more columns contain time series, than this is a univariate time series.
  // +kubebuilder:validation:Optional
  optional bool timeseries = 50 [(gogoproto.customname) = "TimeSeries"];

  // In forecasting based data sets Indicates if the column is regressor
  // This is relevant only for time series schema
  // +kubebuilder:validation:Optional
  optional bool regressor = 51 [(gogoproto.customname) = "Regressor"];

  // In forecasting based data sets Indicates if the column is regressor
  // This is relevant only for time series schema
  // +kubebuilder:validation:Optional
  optional bool laggedRegressor = 52 [(gogoproto.customname) = "LaggedRegressor"];

  // For time series, the field indicate tha this column will be used as the data time index
  // for the time series. Note that there can multiple datatime type columns, but only one
  // time column.
  // +kubebuilder:validation:Optional
  optional bool timeIndex = 53 [(gogoproto.customname) = "TimeIndex"];

  // If this column is aggregate. Define the aggregate
  // +kubebuilder:validation:Optional
  optional string aggr = 54 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.Aggregate", (gogoproto.customname) = "Aggr"];

  // If this column is aggregate
  // +kubebuilder:validation:Optional
  optional int32 window = 55 [(gogoproto.customname) = "Window"];
}

message ColumnHistogram {
  // The name of the column
  // +kubebuilder:validation:Optional
  optional string name = 1 [(gogoproto.customname) = "Name", (gogoproto.nullable) = false];

  // Measure of drift for a column
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.HistogramData histogram = 2 [(gogoproto.customname) = "Histogram", (gogoproto.nullable) = false];

  // Measure of drift for this column
  // +kubebuilder:validation:Optional
  repeated github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.Measurement metrics = 3 [(gogoproto.customname) = "Metrics", (gogoproto.nullable) = false];

  // true if drift was detected for this column
  // +kubebuilder:validation:Optional
  optional bool drift = 4 [(gogoproto.customname) = "Drift"];
}

// The spec for a column in the row. A column can span multiple grid based columns
message ColumnSpec {
  // If true this column is an empty spacer
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool spacer = 1 [(gogoproto.customname) = "Spacer"];

  // The width in columns, each row is divided into 12 columns
  // +kubebuilder:validation:Optional
  optional int32 width = 2 [(gogoproto.customname) = "Width"];

  // The actual
  optional ComponentSpec content = 3 [(gogoproto.customname) = "Content", (gogoproto.nullable) = false];
}

// ColumnStatistics contains statistical parameters for a single feature from a dataset
message ColumnStatistics {
  // The name of the column
  // +kubebuilder:validation:Optional
  optional string name = 1 [(gogoproto.customname) = "Name", (gogoproto.nullable) = false];

  // The data type of the column
  // +kubebuilder:validation:Optional
  optional string datatype = 2 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.DataType", (gogoproto.customname) = "DataType", (gogoproto.nullable) = false];

  // Amount of rows which contain a value for the feature
  // +kubebuilder:validation:Optional
  optional double count = 3 [(gogoproto.customname) = "Count", (gogoproto.nullable) = false];

  // Amount of unique values present in the column
  // +kubebuilder:validation:Optional
  optional int32 distinct = 4 [(gogoproto.customname) = "Distinct", (gogoproto.nullable) = false];

  // Amount of missing values present in the column
  // +kubebuilder:validation:Optional
  optional int32 missing = 5 [(gogoproto.customname) = "Missing", (gogoproto.nullable) = false];

  // Percentage of missing values in the column
  // +kubebuilder:validation:Optional
  optional double percentMissing = 6 [(gogoproto.customname) = "PercentMissing", (gogoproto.nullable) = false];

  // The mean of all values in the column, if the column data type is a number
  // +kubebuilder:validation:Optional
  optional double mean = 7 [(gogoproto.customname) = "Mean", (gogoproto.nullable) = false];

  // The standard deviation of the columns values
  // +kubebuilder:validation:Optional
  optional double stddev = 8 [(gogoproto.customname) = "StdDev", (gogoproto.nullable) = false];

  // The variability of the columns values from the columns mean
  // +kubebuilder:validation:Optional
  optional double variance = 9 [(gogoproto.customname) = "Variance", (gogoproto.nullable) = false];

  // The minimum value of all values in the column
  // +kubebuilder:validation:Optional
  optional double min = 10 [(gogoproto.customname) = "Min", (gogoproto.nullable) = false];

  // The maximum value of all values in the column
  // +kubebuilder:validation:Optional
  optional double max = 11 [(gogoproto.customname) = "Max", (gogoproto.nullable) = false];

  // The computed kurtosis, which measures the peakedness of the distribution of values in the column
  // +kubebuilder:validation:Optional
  optional double kurtosis = 12 [(gogoproto.customname) = "Kurtosis", (gogoproto.nullable) = false];

  // The computed skewness, which measures the asymmetry of the distribution of values in the column
  // +kubebuilder:validation:Optional
  optional double skewness = 13 [(gogoproto.customname) = "Skewness", (gogoproto.nullable) = false];

  // Skewness is the standard deviation value of the attribute
  // +kubebuilder:validation:Optional
  optional double sum = 14 [(gogoproto.customname) = "Sum", (gogoproto.nullable) = false];

  // The sum of all values in the column
  // +kubebuilder:validation:Optional
  optional double mad = 15 [(gogoproto.customname) = "Mad", (gogoproto.nullable) = false];

  // The 25% point of all the values of the column in order
  // +kubebuilder:validation:Optional
  optional double p25 = 16 [(gogoproto.customname) = "P25", (gogoproto.nullable) = false];

  // The 50% point of all the values of the column in order, also known as the median
  // +kubebuilder:validation:Optional
  optional double p50 = 17 [(gogoproto.customname) = "P50", (gogoproto.nullable) = false];

  // The 75% point of all the values of the column in order
  // +kubebuilder:validation:Optional
  optional double p75 = 18 [(gogoproto.customname) = "P75", (gogoproto.nullable) = false];

  // The interquartile range of the columns values
  // +kubebuilder:validation:Optional
  optional double iqr = 19 [(gogoproto.customname) = "IQR", (gogoproto.nullable) = false];

  // The mode value of the column, also known as the most frequent value
  // +kubebuilder:validation:Optional
  optional string mode = 20 [(gogoproto.customname) = "Mode", (gogoproto.nullable) = false];

  // The number of zero values in the column
  // +kubebuilder:validation:Optional
  optional double zeros = 21 [(gogoproto.customname) = "Zeros", (gogoproto.nullable) = false];

  // The number of invalid values in the column
  // +kubebuilder:validation:Optional
  optional int32 invalid = 22 [(gogoproto.customname) = "Invalid", (gogoproto.nullable) = false];

  // The feature importance of the column
  // +kubebuilder:validation:Optional
  optional double importance = 23 [(gogoproto.customname) = "Importance", (gogoproto.nullable) = false];

  // Indicates if the feature is the target attribute for a Study, as specified by the Dataset's DataSource
  // +kubebuilder:validation:Optional
  optional bool target = 24 [(gogoproto.customname) = "Target", (gogoproto.nullable) = false];

  // Indicates if the column should be ignored, as specified by the Dataset's DataSource
  // +kubebuilder:validation:Optional
  optional bool ignore = 25 [(gogoproto.customname) = "Ignore", (gogoproto.nullable) = false];

  // Indicates if the column may contain null values, as specified by the Dataset's DataSource
  // +kubebuilder:validation:Optional
  optional bool nullable = 26 [(gogoproto.customname) = "Nullable", (gogoproto.nullable) = false];

  // Indicates if the column has high cardinality and should use the high cardinality encoder during feature engineering
  // +kubebuilder:validation:Optional
  optional bool highCardinality = 27 [(gogoproto.customname) = "HighCardinality", (gogoproto.nullable) = false];

  // Indicates if the column has high correlation with another feature, and that it should be dropped
  // +kubebuilder:validation:Optional
  optional bool highCorrWithOtherFeatures = 28 [(gogoproto.customname) = "HighCorrWithOtherFeatures", (gogoproto.nullable) = false];

  // Indicate that the feature has low correlation with the target feature, and that it should be dropped
  // +kubebuilder:validation:Optional
  optional bool lowCorrWithTarget = 29 [(gogoproto.customname) = "LowCorrWithTarget", (gogoproto.nullable) = false];

  // Indicates if the column has a high percentage of missing values, and that it should be dropped
  // +kubebuilder:validation:Optional
  optional bool highMissingPct = 30 [(gogoproto.customname) = "HighMissingPct", (gogoproto.nullable) = false];

  // Marks that the column is skewed and would require a power transform.
  //
  // If skewness is less than -1 or greater than 1, the distribution is highly skewed.
  // If skewness is between -1 and -0.5 or between 0.5 and 1, the distribution is moderately skewed.
  // If skewness is between -0.5 and 0.5, the distribution is approximately symmetric
  // +kubebuilder:validation:Optional
  optional bool skewed = 31 [(gogoproto.customname) = "Skewed", (gogoproto.nullable) = false];

  // Indicates if the column is an ID column, such as a primary key
  // +kubebuilder:validation:Optional
  optional bool id = 32 [(gogoproto.customname) = "Id", (gogoproto.nullable) = false];

  // +kubebuilder:validation:Optional
  optional bool constant = 33 [(gogoproto.customname) = "Constant", (gogoproto.nullable) = false];

  // Indicates if the column is a duplicate of another column
  // +kubebuilder:validation:Optional
  optional bool duplicate = 34 [(gogoproto.customname) = "Duplicate", (gogoproto.nullable) = false];

  // Indicates if the column is reserved and must be a feature included in model training
  // +kubebuilder:validation:Optional
  optional bool reserved = 35 [(gogoproto.customname) = "Reserved", (gogoproto.nullable) = false];

  // The ratio between non-null and null values in the column
  // +kubebuilder:validation:Optional
  optional double completeness = 37 [(gogoproto.customname) = "Completeness", (gogoproto.nullable) = false];

  // The ratio between unique values and non-unique values in the column
  // +kubebuilder:validation:Optional
  optional double distinctValueCount = 38 [(gogoproto.customname) = "DistinctValueCount", (gogoproto.nullable) = false];

  // The ratio between most the most frequent value to the number of total values in the column
  // +kubebuilder:validation:Optional
  optional double mostFreqValuesRatio = 39 [(gogoproto.customname) = "MostFreqValuesRatio", (gogoproto.nullable) = false];

  // Used for text attributes
  // +kubebuilder:validation:Optional
  optional double indexOfPeculiarity = 40 [(gogoproto.customname) = "IndexOfPeculiarity", (gogoproto.nullable) = false];

  // Histogram data representing the distribution of the values in the column
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.HistogramData histogram = 41 [(gogoproto.customname) = "Histogram", (gogoproto.nullable) = false];

  // Correlation to the target feature
  // +kubebuilder:validation:Optional
  optional double corrToTarget = 42 [(gogoproto.customname) = "CorrToTarget", (gogoproto.nullable) = false];

  // The column index in the dataset
  optional int32 index = 43 [(gogoproto.customname) = "Index", (gogoproto.nullable) = false];

  // Outlier statistics.
  optional OutlierStat outliers = 44 [(gogoproto.customname) = "Outliers", (gogoproto.nullable) = false];
}

message ComponentSpec {
  // +kubebuilder:validation:Optional
  optional string title = 1 [(gogoproto.customname) = "Title"];

  // +kubebuilder:validation:Optional
  optional string subtitle = 2 [(gogoproto.customname) = "SubTitle"];

  // +kubebuilder:validation:Optional
  optional string footer = 3 [(gogoproto.customname) = "Footer"];

  optional ComponentView content = 4 [(gogoproto.customname) = "ComponentView", (gogoproto.nullable) = false];
}

// Represent the view part of a component. Only one part should be specified per component
message ComponentView {
  // +kubebuilder:validation:Optional
  optional MetricSpec metric = 1 [(gogoproto.customname) = "Metric"];

  // +kubebuilder:validation:Optional
  optional GaugeSpec gauge = 2 [(gogoproto.customname) = "Gauge"];

  // +kubebuilder:validation:Optional
  optional HistogramSpec histogram = 3 [(gogoproto.customname) = "Histogram"];

  // +kubebuilder:validation:Optional
  optional TableSpec table = 4 [(gogoproto.customname) = "Table"];

  // +kubebuilder:validation:Optional
  optional LineChartSpec lineChart = 5 [(gogoproto.customname) = "LineChart"];

  // +kubebuilder:validation:Optional
  optional BarChartSpec barChart = 6 [(gogoproto.customname) = "BarChart"];

  // +kubebuilder:validation:Optional
  optional ScatterPlotSpec scatterPlot = 7 [(gogoproto.customname) = "ScatterChart"];
}

// Correlation records the correlation between two features in a Dataset
message Correlation {
  // The first feature name
  optional string feature1 = 1 [(gogoproto.customname) = "Feature1", (gogoproto.nullable) = false];

  // The second feature name
  optional string feature2 = 2 [(gogoproto.customname) = "Feature2", (gogoproto.nullable) = false];

  // The correlation value
  optional double value = 3 [(gogoproto.customname) = "Value", (gogoproto.nullable) = false];

  // How the value was calculated
  optional string method = 4 [(gogoproto.customname) = "Method", (gogoproto.nullable) = false];
}

// CorrelationSpec specifies how the correlations between features in a Dataset should be computed
message CorrelationSpec {
  // The minimum value of a computed correlation to be stored as a result
  // +kubebuilder:default:=50
  // +kubebuilder:validation:Optional
  optional double cutoff = 1 [(gogoproto.customname) = "Cutoff"];

  // The method to be used when computing correlations
  // +kubebuilder:default:="pearson"
  // +kubebuilder:validation:Optional
  optional string method = 2 [(gogoproto.customname) = "Method"];

  // The number of top correlations to be included in the correlation results
  // +kubebuilder:default:=10
  // +kubebuilder:validation:Optional
  optional int32 top = 3 [(gogoproto.customname) = "Top"];
}

// CsvFileSpec specifies the format of a CSV (comma-separated values) file
message CsvFileSpec {
  // The character used to separate fields (by default, a comma)
  // +kubebuilder:default:="comma"
  // +kubebuilder:validation:Optional
  optional string columnDelimiter = 1 [(gogoproto.casttype) = "Delimiter", (gogoproto.customname) = "ColumnDelimiter"];

  // The character used to signal the end of a row (by default, a newline \n)
  // +kubebuilder:default:="crlf"
  // +kubebuilder:validation:Optional
  optional string rowDelimiter = 2 [(gogoproto.casttype) = "Delimiter", (gogoproto.customname) = "RowDelimiter"];

  // The charcter used for quotes (by default, a double quote ")
  // +kubebuilder:default:="double-quote"
  // +kubebuilder:validation:Optional
  optional string quote = 3 [(gogoproto.casttype) = "QuoteChar", (gogoproto.customname) = "QuoteChar", (gogoproto.nullable) = false];

  // The character used to escape the delimiter
  // +kubebuilder:default:="none"
  // +kubebuilder:validation:Optional
  optional string escapeChar = 4 [(gogoproto.casttype) = "EscapeChar", (gogoproto.customname) = "EscapeChar", (gogoproto.nullable) = false];

  // The comment character used to split comments off the end of lines (by default, a hashtag #)
  // +kubebuilder:default:="#"
  // +kubebuilder:validation:Optional
  optional string commentChars = 5 [(gogoproto.customname) = "CommentChars"];

  // Indicates if a header is present in the file
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool header = 6 [(gogoproto.customname) = "Header"];

  // The number of rows to skip from the top of the file
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Optional
  optional int32 skipRows = 7 [(gogoproto.customname) = "SkipRows"];

  // NullValues is a sequence of values to replace with NA.
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string nullValues = 8 [(gogoproto.customname) = "NullValues"];

  // The unicode encoding of the file (e.g. 'utf-8' for UTF-8 encoded text)
  // +kubebuilder:default:="utf-8"
  // +kubebuilder:validation:Optional
  optional string encoding = 9 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.FileEncoding", (gogoproto.customname) = "Encoding"];

  // The maximum number of rows to read
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Optional
  optional int32 maxRows = 10 [(gogoproto.customname) = "MaxRows"];

  // Indicates if the read of the CSV file should fail if there are any errors
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool strict = 11 [(gogoproto.customname) = "Strict"];

  // The compression type, if the file is compressed
  // +kubebuilder:default:="none"
  // +kubebuilder:validation:Optional
  optional string compression = 12 [(gogoproto.customname) = "Compression"];

  // Indicates if the file contains an index column
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool hasIndexColumn = 13 [(gogoproto.customname) = "HasIndexColumn"];
}

// DataInputSpec specifies the format and location of an input dataset
message DataInputSpec {
  // The physical location of the dataset
  // +kubebuilder:validation:Optional
  optional DataLocation location = 2 [(gogoproto.customname) = "Location"];

  // The file format of the dataset, if applicable
  // +kubebuilder:default:="csv"
  // +kubebuilder:validation:Optional
  optional string format = 3 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.DatastoreType", (gogoproto.customname) = "Format"];
}

// DataLocation describes the external location of data that will be accessed by Modela, and additional
// information on how to query the data if the location is a non flat-file source.
message DataLocation {
  // The type of location where the data resides, which can either be an object inside an object storage system (i.e. Minio), a SQL location
  // like a table or a view, a data stream (i.e. Kafka, currently unsupported), or a web location (currently unsupported)
  // +kubebuilder:default:="object"
  // +kubebuilder:validation:Optional
  optional string type = 1 [(gogoproto.casttype) = "DataLocationType", (gogoproto.customname) = "Type"];

  // In the case of the type of location being a database, ConnectionName specifies the name of the Connection resource
  // that exists in the same tenant as the resource specifying the DataLocation. Modela will attempt to connect
  // to the database using the credentials specified in the Connection, and will execute the query specified by the SQL field
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string connectionName = 2 [(gogoproto.customname) = "ConnectionName"];

  // In the case of the location type being an object storage system, BucketName is the name of the VirtualBucket resource
  // that exists in the same tenant as the resource specifying the DataLocation. Modela will connect to the external
  // object storage system, and will access the file from the path specified by the Path field
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string bucketName = 3 [(gogoproto.customname) = "BucketName"];

  // The path to a flat-file inside an object storage system. When using the Modela API to upload files (through the
  // FileService API), Modela will upload the data to a predetermined path based on the Tenant, DataProduct,
  // DataProductVersion, and resource type of the resource in relation to the file being uploaded.
  // The path does not need to adhere to this format; you can give the path to a file inside a bucket not managed by Modela
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string path = 4 [(gogoproto.customname) = "Path"];

  // The name of a table inside a database, if applicable
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string table = 5 [(gogoproto.customname) = "Table"];

  // The name of a database inside the database system specified by the ConnectionName field
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string database = 6 [(gogoproto.customname) = "Database"];

  // The SQL statement which will be executed to query data from the table specified by Table
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string sql = 7 [(gogoproto.customname) = "Sql"];

  // The name of the streaming topic (currently unsupported)
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string topic = 8 [(gogoproto.customname) = "Topic"];

  // In the case of the location type being WebApi, URL specifies the external location (HTTP or Git) that will be queried
  // and then stored as flat-file by the resource which specifies the DataLocation
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string url = 9 [(gogoproto.customname) = "URL"];

  // In the case of the location type being Dataset or PublicDataset, ResourceRef references another resource that
  // containing data that will be used as a data source
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference resourceRef = 10 [(gogoproto.customname) = "ResourceRef"];
}

// DataOutputSpec specifies the format, features, and output location of a transformed dataset
message DataOutputSpec {
  // DatasetName is the name of a new Dataset resource that will be created.
  // If empty, the system will save the dataset to a file
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string datasetName = 1 [(gogoproto.customname) = "DatasetName"];

  // The location where the dataset will be stored
  // +kubebuilder:validation:Optional
  optional DataLocation location = 2 [(gogoproto.customname) = "Location"];

  // The format of the dataset, applicable if the output location is a flat-file
  // +kubebuilder:default:="csv"
  // +kubebuilder:validation:Optional
  optional string format = 3 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.DatastoreType", (gogoproto.customname) = "Format"];

  // The update strategy for the dataset in the case that the output location already exists (i.e a database table)
  // Upsert will insert new records and update existing ones;
  // Insert will insert new records and not update existing ones;
  // Update will not insert new records and only update existing ones
  // +kubebuilder:default:="upsert"
  // +kubebuilder:validation:Optional
  optional string action = 4 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.UpdateStrategy", (gogoproto.customname) = "Action"];

  // If true, the database table specified by Location will be created if it does not exist
  // +kubebuilder:validation:Optional
  optional bool createTableIfNotExist = 5 [(gogoproto.customname) = "CreateTableIfNotExist"];

  // Indicates if the features (i.e. all the columns) of the input dataset, excluding the
  // feature which was predicted on, will be included in the output dataset
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool includeFeatures = 6 [(gogoproto.customname) = "IncludeFeatures"];

  // If true, SHAP values for each predicted row will be included as JSON as an additional column of the dataset
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool xai = 7 [(gogoproto.customname) = "XAI"];

  // If true, an additional column will be added to the dataset which
  // indicates if each predicted row was detected to be an outlier
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool detectOutliers = 8 [(gogoproto.customname) = "DetectOutliers"];
}

// +kubebuilder:object:root=true
// +kubebuilder:subresource:status
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Ready",type="string",JSONPath=".status.conditions[?(@.type==\"Ready\")].status",description=""
// +kubebuilder:printcolumn:name="Description",type="string",JSONPath=".spec.description",description=""
// +kubebuilder:printcolumn:name="Schedule",type="string",JSONPath=".spec.schedule",description=""
// +kubebuilder:printcolumn:name="Last Run",type="date",JSONPath=".status.lastRun.at",description=""
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp",description=""
// +kubebuilder:resource:path=datapipelines,singular=datapipeline,shortName="dpl",categories={data,modela}
// DataPipeline represents the ETL flow from the data sources to a processed dataset, ready for training.
message DataPipeline {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1 [(gogoproto.customname) = "ObjectMeta", (gogoproto.nullable) = false];

  optional DataPipelineSpec spec = 2 [(gogoproto.customname) = "Spec", (gogoproto.nullable) = false];

  // +optional
  optional DataPipelineStatus status = 3 [(gogoproto.customname) = "Status", (gogoproto.nullable) = false];
}

// DataPipelineCondition describes the state of a wrangler at a certain point.
message DataPipelineCondition {
  // Type of account condition.
  optional string type = 1 [(gogoproto.casttype) = "DataPipelineConditionType", (gogoproto.customname) = "Type", (gogoproto.nullable) = false];

  // Status of the condition, one of True, False, Unknown.
  optional string status = 2 [(gogoproto.casttype) = "k8s.io/api/core/v1.ConditionStatus", (gogoproto.customname) = "Status", (gogoproto.nullable) = false];

  // Last time the condition transitioned from one status to another.
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastTransitionTime = 4 [(gogoproto.customname) = "LastTransitionTime"];

  // The reason for the condition's last transition.
  optional string reason = 5 [(gogoproto.customname) = "Reason", (gogoproto.nullable) = false];

  // A human readable message indicating details about the transition.
  optional string message = 6 [(gogoproto.customname) = "Message", (gogoproto.nullable) = false];
}

// +kubebuilder:object:root=true
// DataPipelineList contain the list of DataPipeline
message DataPipelineList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1 [(gogoproto.customname) = "ListMeta", (gogoproto.nullable) = false];

  repeated DataPipeline items = 2 [(gogoproto.customname) = "Items", (gogoproto.nullable) = false];
}

// +kubebuilder:object:root=true
// +kubebuilder:subresource:status
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Status",type="string",JSONPath=".status.phase"
// +kubebuilder:printcolumn:name="Progress",type="string",JSONPath=".status.progress",priority=1
// +kubebuilder:printcolumn:name="Pipeline",type="string",JSONPath=".spec.datapipelineName"
// +kubebuilder:printcolumn:name="StartTime",type="date",JSONPath=".status.startTime",priority=1
// +kubebuilder:printcolumn:name="CompletionTime",type="date",JSONPath=".status.completionTime",priority=1
// +kubebuilder:printcolumn:name="Failure",type="string",JSONPath=".metadata.failureMessage"
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp"
// +kubebuilder:resource:path=datapipelineruns,singular=datapipelinerun,shortName="dpr",categories={data,modela,all}
// DataPipelineRun represent one execution of the data pipeline
message DataPipelineRun {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1 [(gogoproto.customname) = "ObjectMeta", (gogoproto.nullable) = false];

  optional DataPipelineRunSpec spec = 2 [(gogoproto.customname) = "Spec", (gogoproto.nullable) = false];

  // +optional
  optional DataPipelineRunStatus status = 3 [(gogoproto.customname) = "Status", (gogoproto.nullable) = false];
}

// DataPipelineRunCondition describes the state of a data processor run at a certain point.
message DataPipelineRunCondition {
  // Type of account condition.
  optional string type = 1 [(gogoproto.casttype) = "DataPipelineRunConditionType", (gogoproto.customname) = "Type", (gogoproto.nullable) = false];

  // Status of the condition, one of True, False, Unknown.
  optional string status = 2 [(gogoproto.casttype) = "k8s.io/api/core/v1.ConditionStatus", (gogoproto.customname) = "Status", (gogoproto.nullable) = false];

  // Last time the condition transitioned from one status to another.
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastTransitionTime = 4 [(gogoproto.customname) = "LastTransitionTime"];

  // The reason for the condition's last transition.
  optional string reason = 5 [(gogoproto.customname) = "Reason", (gogoproto.nullable) = false];

  // A human readable message indicating details about the transition.
  optional string message = 6 [(gogoproto.customname) = "Message", (gogoproto.nullable) = false];
}

// +kubebuilder:object:root=true
// DataPipelineRunList contains a list of DataPipelineRun
message DataPipelineRunList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1 [(gogoproto.customname) = "ListMeta", (gogoproto.nullable) = false];

  repeated DataPipelineRun items = 2 [(gogoproto.customname) = "Items", (gogoproto.nullable) = false];
}

// DataPipelineRunSpec defines the desired state of a schema
message DataPipelineRunSpec {
  // The data product version of the run
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string versionName = 1 [(gogoproto.customname) = "VersionName"];

  // The data product
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string datapipelineName = 2 [(gogoproto.customname) = "DataPipelineName"];

  // The owner of the run, set to the owner of the pipeline
  // +kubebuilder:default:="no-one"
  // +kubebuilder:validation:Pattern="[a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*"
  // +kubebuilder:validation:Optional
  optional string owner = 4 [(gogoproto.customname) = "Owner"];

  // Specify the resources for the data pipeline run
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ResourceSpec resources = 5 [(gogoproto.customname) = "Resources", (gogoproto.nullable) = false];

  // The priority of this data pipeline. The default is medium.
  // +kubebuilder:default:=medium
  // +kubebuilder:validation:Optional
  optional string priority = 6 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.PriorityLevel", (gogoproto.customname) = "Priority"];

  // Set to true to pause the pipeline run
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool paused = 7 [(gogoproto.customname) = "Paused"];

  // Set to true to abort the  pipeline run
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool aborted = 8 [(gogoproto.customname) = "Aborted"];

  // The Lab where the data pipeline run.
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference labRef = 9 [(gogoproto.customname) = "LabRef", (gogoproto.nullable) = false];
}

// DataPipelineRunStatus defines the observed state of DataPipelineRun
message DataPipelineRunStatus {
  // RecipeRuns is the names of the recipe runs that occur during running of the pipeline.
  // +kubebuilder:validation:Optional
  repeated string recipeRuns = 1 [(gogoproto.customname) = "RecipeRuns"];

  // the resulting dataset from the flow
  // +kubebuilder:validation:Optional
  optional DataLocation output = 2 [(gogoproto.customname) = "Output", (gogoproto.nullable) = false];

  // the phase of the run
  // +kubebuilder:default:="Pending"
  // +kubebuilder:validation:Optional
  optional string phase = 3 [(gogoproto.casttype) = "DataPipelineRunPhase", (gogoproto.customname) = "Phase", (gogoproto.nullable) = false];

  // StartTime is the start time of the pipeline
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time startTime = 4 [(gogoproto.customname) = "StartTime"];

  // CompletionTime is the end time of the pipeline
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time endTime = 5 [(gogoproto.customname) = "EndTime"];

  // ObservedGeneration is the Last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 6 [(gogoproto.customname) = "ObservedGeneration", (gogoproto.nullable) = false];

  // Update in case of terminal failure
  // Borrowed from cluster api controller
  optional string failureReason = 7 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.StatusError", (gogoproto.customname) = "FailureReason"];

  // Update in case of terminal failure message
  optional string failureMessage = 8 [(gogoproto.customname) = "FailureMessage"];

  // Pipeline progress Progress in percent, the progress takes into account the different stages of the pipeline
  // +kubebuilder:validation:Optional
  optional int32 progress = 9 [(gogoproto.customname) = "Progress"];

  // Holds the location of log paths
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.Logs logs = 10 [(gogoproto.customname) = "Logs", (gogoproto.nullable) = false];

  // Last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastUpdated = 11 [(gogoproto.customname) = "LastUpdated"];

  // +patchMergeKey=type
  // +patchStrategy=merge
  // +kubebuilder:validation:Optional
  repeated DataPipelineRunCondition conditions = 12 [(gogoproto.customname) = "Conditions", (gogoproto.nullable) = false];
}

// DataPipelineSpec defines the desired state of a DataPipeline
message DataPipelineSpec {
  // VersionName is the data product version of the data pipeline
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string versionName = 1 [(gogoproto.customname) = "VersionName"];

  // The model class for this pipeline
  // +kubebuilder:validation:Optional
  optional string modelClassName = 2 [(gogoproto.customname) = "ModelClassName"];

  // Description of the data pipeline
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string description = 3 [(gogoproto.customname) = "Description"];

  // DatasetSelector is used to select datasets for processing in the pipeline
  // +kubebuilder:validation:Optional
  map<string, string> datasetSelector = 4 [(gogoproto.customname) = "DatasetSelector", (gogoproto.nullable) = false];

  // RecipeOrder defines the list of recipes and the order they need to run
  // +kubebuilder:validation:Optional
  repeated RecipePartSpec recipes = 5 [(gogoproto.customname) = "Recipes", (gogoproto.nullable) = false];

  // The output definition
  // +kubebuilder:validation:Optional
  optional DataOutputSpec output = 6 [(gogoproto.customname) = "Output", (gogoproto.nullable) = false];

  // Schedule for running the pipeline
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.RunSchedule schedule = 7 [(gogoproto.customname) = "Schedule", (gogoproto.nullable) = false];

  // Specification for notification
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.NotificationSpec notification = 8 [(gogoproto.customname) = "Notification", (gogoproto.nullable) = false];

  // Owner of this data pipeline
  // +kubebuilder:default:="no-one"
  // +kubebuilder:validation:Pattern="[a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*"
  // +kubebuilder:validation:Optional
  optional string owner = 9 [(gogoproto.customname) = "Owner"];

  // Resources are hardware resource req.
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ResourceSpec resources = 10 [(gogoproto.customname) = "Resources", (gogoproto.nullable) = false];

  // The priority of this data pipeline. The default is medium.
  // +kubebuilder:default:="medium"
  // +kubebuilder:validation:Optional
  optional string priority = 11 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.PriorityLevel", (gogoproto.customname) = "Priority"];

  // Set to true to pause the cron prediction
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool paused = 12 [(gogoproto.customname) = "Paused"];

  // TTL for the data product run. Set to 0 if no garbage collected is needed.
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional int32 ttl = 13 [(gogoproto.customname) = "TTL"];
}

// DataPipelineStatus is the observed state of the DataPipeline object.
message DataPipelineStatus {
  // ObservedGeneration is the Last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 1 [(gogoproto.customname) = "ObservedGeneration", (gogoproto.nullable) = false];

  // Last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastUpdated = 2 [(gogoproto.customname) = "LastUpdated"];

  // Last run is the last time a data pipeline run was created
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.LastRunStatus lastRun = 3 [(gogoproto.customname) = "LastRun", (gogoproto.nullable) = false];

  // The time of the next schedule run
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time nextRun = 4 [(gogoproto.customname) = "NextRun"];

  // +patchMergeKey=type
  // +patchStrategy=merge
  // +kubebuilder:validation:Optional
  repeated DataPipelineCondition conditions = 5 [(gogoproto.customname) = "Conditions", (gogoproto.nullable) = false];
}

// DataProduct represents a single DataProduct namespace, which contains all non-infrastructure resources. Additionally,
// it specifies default parameters for resources to be created under the namespace, such as workload class and storage location
// +kubebuilder:object:root=true
// +kubebuilder:subresource:status
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Ready",type="string",JSONPath=".status.conditions[?(@.type==\"Ready\")].status"
// +kubebuilder:printcolumn:name="Owner",type="string",JSONPath=".spec.owner"
// +kubebuilder:printcolumn:name="Task",type="string",JSONPath=".spec.task"
// +kubebuilder:printcolumn:name="Public",type="boolean",JSONPath=".spec.public"
// +kubebuilder:printcolumn:name="Errors",type="integer",JSONPath=".status.totalErrorAlerts"
// +kubebuilder:printcolumn:name="Data Sources",type="integer",JSONPath=".status.totalDatasources",priority=1
// +kubebuilder:printcolumn:name="Datasets",type="integer",JSONPath=".status.totalDatasets",priority=1
// +kubebuilder:printcolumn:name="Studies",type="integer",JSONPath=".status.totalStudies",priority=1
// +kubebuilder:printcolumn:name="Models",type="integer",JSONPath=".status.totalModels",priority=1
// +kubebuilder:printcolumn:name="Predictors",type="integer",JSONPath=".status.totalPredictors",priority=1
// +kubebuilder:printcolumn:name="Apps",type="integer",JSONPath=".status.totalApps",priority=1
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp",description=""
// +kubebuilder:resource:path=dataproducts,shortName=prod,singular=dataproduct,shortName="prod",categories={data,modela,all}
message DataProduct {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1 [(gogoproto.customname) = "ObjectMeta", (gogoproto.nullable) = false];

  optional DataProductSpec spec = 2 [(gogoproto.customname) = "Spec", (gogoproto.nullable) = false];

  // +optional
  optional DataProductStatus status = 3 [(gogoproto.customname) = "Status", (gogoproto.nullable) = false];
}

// DataProductCondition describes the state of a DataProduct at a certain point
message DataProductCondition {
  // Type of condition.
  optional string type = 1 [(gogoproto.casttype) = "DataProductConditionType", (gogoproto.customname) = "Type", (gogoproto.nullable) = false];

  // Status of the condition, one of True, False, Unknown
  optional string status = 2 [(gogoproto.casttype) = "k8s.io/api/core/v1.ConditionStatus", (gogoproto.customname) = "Status", (gogoproto.nullable) = false];

  // Last time the condition transitioned from one status to another
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastTransitionTime = 4 [(gogoproto.customname) = "LastTransitionTime"];

  // The reason for the condition's last transition
  optional string reason = 5 [(gogoproto.customname) = "Reason", (gogoproto.nullable) = false];

  // A human readable message indicating details about the transition
  optional string message = 6 [(gogoproto.customname) = "Message", (gogoproto.nullable) = false];
}

// +kubebuilder:object:root=true
// DataProductList contains a list of DataProducts
message DataProductList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1 [(gogoproto.customname) = "ListMeta", (gogoproto.nullable) = false];

  repeated DataProduct items = 2 [(gogoproto.customname) = "Items", (gogoproto.nullable) = false];
}

// DataProductSpec defines the desired state of the DataProduct
message DataProductSpec {
  // The name of the Account which created the object, which exists in the same tenant as the object
  // +kubebuilder:default:="no-one"
  // +kubebuilder:validation:Optional
  optional string owner = 1 [(gogoproto.customname) = "Owner"];

  // Indicates if the DataProduct is public and can be accessed without permissions
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool public = 2 [(gogoproto.customname) = "Public"];

  // The reference to the Tenant which owns the DataProduct. Defaults to `default-tenant`
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference tenantRef = 3 [(gogoproto.customname) = "TenantRef"];

  // GitLocation is the default Git location where all child resources will be tracked as YAML
  // +kubebuilder:validation:Optional
  optional GitLocation gitLocation = 4 [(gogoproto.customname) = "GitLocation", (gogoproto.nullable) = false];

  // ImageLocation is the default Docker image repository where model images produced under the DataProduct will be stored
  // +kubebuilder:validation:Optional
  optional ImageLocation imageLocation = 5 [(gogoproto.customname) = "ImageLocation"];

  // The name of the Lab that will be used by default with all compute-requiring child resources
  // +kubebuilder:validation:Pattern="[a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*"
  // +kubebuilder:validation:MaxLength=63
  // +kubebuilder:validation:Optional
  optional string labName = 7 [(gogoproto.customname) = "LabName"];

  // The name of the Serving Site which will be used by default with all Predictor resources
  // +kubebuilder:validation:MaxLength=63
  // +kubebuilder:validation:Pattern="[a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*"
  // +kubebuilder:validation:Optional
  optional string servingSiteName = 8 [(gogoproto.customname) = "ServingSiteName"];

  // Task specifies the default machine learning task of the product (classification, regression, etc.)
  // +kubebuilder:validation:Optional
  optional string task = 9 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.MLTask", (gogoproto.customname) = "Task"];

  // Subtask specifies the default subtask relevant to the primary task (text classification, image object detection, etc.)
  // +kubebuilder:default:=none
  // +kubebuilder:validation:Optional
  optional string subtask = 10 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.MLSubtask", (gogoproto.customname) = "SubTask"];

  // User-provided description of the object
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  // +kubebuilder:validation:MaxLength=512
  optional string description = 11 [(gogoproto.customname) = "Description"];

  // The default location for all artifacts created under the DataProduct. All data-producing resources will
  // use the VirtualBucket specified by the DataLocation by default
  // +kubebuilder:validation:Optional
  optional DataLocation dataLocation = 12 [(gogoproto.customname) = "DataLocation", (gogoproto.nullable) = false];

  // The default notification specification for all resources under the DataProduct
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.NotificationSpec notification = 13 [(gogoproto.customname) = "Notification", (gogoproto.nullable) = false];

  // The default resource allocation for model training and data workloads that takes place under the DataProduct
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ResourceSpec trainingResources = 14 [(gogoproto.customname) = "DefaultTrainingResources", (gogoproto.nullable) = false];

  // The default resource allocation for model serving workloads that takes place under the DataProduct
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ResourceSpec servingResources = 15 [(gogoproto.customname) = "DefaultServingResources", (gogoproto.nullable) = false];

  // Specifies how many times Jobs created under the DataProduct namespace will retry after failure
  // +kubebuilder:default:=3
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Maximum=10
  // +kubebuilder:validation:Optional
  optional int32 retriesOnFailure = 16 [(gogoproto.customname) = "RetriesOnFailure"];

  // KPIs define key performance indicators for the DataProduct (not functional as of the current release)
  // +kubebuilder:validation:Optional
  repeated KPI kpis = 17 [(gogoproto.customname) = "KPIs", (gogoproto.nullable) = false];

  // The name of the Account which should be responsible for events that occur under the DataProduct
  // +kubebuilder:validation:Optional
  optional string onCallAccountName = 18 [(gogoproto.customname) = "OnCallAccountName", (gogoproto.nullable) = false];

  // The default compilation specification for Study resources created under the DataProduct
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.CompilerSpec compilation = 19 [(gogoproto.customname) = "Compilation", (gogoproto.nullable) = false];

  // The clearance level required to access the DataProduct. Accounts which do not have a clearance level
  // greater than or equal to ClearanceLevel will be denied access to the DataProduct namespace
  // +kubebuilder:default:=unclassified
  // +kubebuilder:validation:Optional
  optional string clearanceLevel = 20 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.SecurityClearanceLevel", (gogoproto.customname) = "ClearanceLevel"];

  // The default priority level assigned to Jobs created under the DataProduct namespace
  // +kubebuilder:validation:Optional
  // +kubebuilder:default:="medium"
  optional string priority = 21 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.PriorityLevel", (gogoproto.customname) = "DefaultPriority"];

  // The color assigned to the product, for visual purposes only
  // +kubebuilder:default:="none"
  // +kubebuilder:validation:Optional
  optional string color = 22 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.Color", (gogoproto.customname) = "Color"];

  // The Governance requirements (not functional as of the current release)
  // +kubebuilder:validation:Optional
  optional GovernanceSpec governance = 23 [(gogoproto.customname) = "Governance", (gogoproto.nullable) = false];

  // Permissions denotes the specification that determines which Accounts
  // can access the DataProduct and what actions they can perform
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.PermissionsSpec permissions = 24 [(gogoproto.customname) = "Permissions", (gogoproto.nullable) = false];
}

// DataProductStatus defines the observed state of DataProduct
message DataProductStatus {
  // ObservedGeneration is the last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 1 [(gogoproto.customname) = "ObservedGeneration", (gogoproto.nullable) = false];

  // The last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastUpdated = 2 [(gogoproto.customname) = "LastUpdated"];

  // The number of DataSource resources that exist under the namespace
  // +kubebuilder:validation:Optional
  optional int32 totalDatasources = 3 [(gogoproto.customname) = "TotalDatasources", (gogoproto.nullable) = false];

  // The number of Dataset resources that exist under the namespace
  // +kubebuilder:validation:Optional
  optional int32 totalDatasets = 4 [(gogoproto.customname) = "TotalDatasets", (gogoproto.nullable) = false];

  // The number of DataPipeline resources that exist under the namespace
  // +kubebuilder:validation:Optional
  optional int32 totalDataPipelines = 5 [(gogoproto.customname) = "TotalDataPipelines", (gogoproto.nullable) = false];

  // The number of DataPipelineRun resources that exist under the namespace
  // +kubebuilder:validation:Optional
  optional int32 totalDataPipelineRuns = 6 [(gogoproto.customname) = "TotalDataPipelineRuns", (gogoproto.nullable) = false];

  // The number of Study resources that exist under the namespace
  // +kubebuilder:validation:Optional
  optional int32 totalStudies = 7 [(gogoproto.customname) = "TotalStudies", (gogoproto.nullable) = false];

  // The number of Model resources that exist under the namespace
  // +kubebuilder:validation:Optional
  optional int32 totalModels = 8 [(gogoproto.customname) = "TotalModels", (gogoproto.nullable) = false];

  // The number of ModelPipeline resources that exist under the namespace
  // +kubebuilder:validation:Optional
  optional int32 totalModelPipelines = 9 [(gogoproto.customname) = "TotalModelPipelines", (gogoproto.nullable) = false];

  // The number of ModelPipelineRun resources that exist under the namespace
  // +kubebuilder:validation:Optional
  optional int32 totalModelPipelineRuns = 10 [(gogoproto.customname) = "TotalModelPipelineRuns", (gogoproto.nullable) = false];

  // The number of Predictor resources that exist under the namespace
  // +kubebuilder:validation:Optional
  optional int32 totalPredictors = 11 [(gogoproto.customname) = "TotalPredictors", (gogoproto.nullable) = false];

  // The number of ModelAutoBuilder resources that exist under the namespace
  // +kubebuilder:validation:Optional
  optional int32 totalBuilders = 12 [(gogoproto.customname) = "TotalBuilders", (gogoproto.nullable) = false];

  // The number of DataApp resources that exist under the namespace
  // +kubebuilder:validation:Optional
  optional int32 totalApps = 13 [(gogoproto.customname) = "TotalApps", (gogoproto.nullable) = false];

  // The number of Prediction resources that exist under the namespace
  // +kubebuilder:validation:Optional
  optional int32 totalPredictions = 14 [(gogoproto.customname) = "TotalPredictions", (gogoproto.nullable) = false];

  // The number of informative alerts produced under the namespace
  // +kubebuilder:validation:Optional
  optional int32 totalInfoAlerts = 15 [(gogoproto.customname) = "TotalInfoAlerts", (gogoproto.nullable) = false];

  // The number of error alerts produced under the namespace
  // +kubebuilder:validation:Optional
  optional int32 totalErrorAlerts = 16 [(gogoproto.customname) = "TotalErrorsAlerts", (gogoproto.nullable) = false];

  // In the case of failure, the DataProduct resource controller will set this field with a failure reason
  optional string failureReason = 17 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.StatusError", (gogoproto.customname) = "FailureReason"];

  // In the case of failure, the DataProduct resource controller will set this field with a failure message
  optional string failureMessage = 18 [(gogoproto.customname) = "FailureMessage"];

  // The name of the DataProductVersion which currently represents the latest version of the DataProduct.
  // Newly-created resources will be instantiated with this version by default
  optional string baselineVersion = 19 [(gogoproto.customname) = "BaselineVersion"];

  // +patchMergeKey=type
  // +patchStrategy=merge
  // +kubebuilder:validation:Optional
  repeated DataProductCondition conditions = 20 [(gogoproto.customname) = "Conditions", (gogoproto.nullable) = false];
}

// DataProductVersion represents a single version of a DataProduct, which should increment versions in response to changes in data
// +kubebuilder:object:root=true
// +kubebuilder:subresource:status
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Ready",type="string",JSONPath=".status.conditions[?(@.type==\"Ready\")].status",description=""
// +kubebuilder:printcolumn:name="Owner",type="string",JSONPath=".spec.owner"
// +kubebuilder:printcolumn:name="Product",type="string",JSONPath=".spec.productRef.name",description=""
// +kubebuilder:printcolumn:name="Base",type="boolean",JSONPath=".spec.baseline",description=""
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp",description=""
// +kubebuilder:resource:path=dataproductversions,shortName=dpv,singular=dataproductversion,categories={data,modela,all}
message DataProductVersion {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1 [(gogoproto.customname) = "ObjectMeta", (gogoproto.nullable) = false];

  optional DataProductVersionSpec spec = 2 [(gogoproto.customname) = "Spec", (gogoproto.nullable) = false];

  // +optional
  optional DataProductVersionStatus status = 3 [(gogoproto.customname) = "Status", (gogoproto.nullable) = false];
}

// DataProductVersionCondition describes the state of a DataProductVersion at a certain point
message DataProductVersionCondition {
  // Type of condition.
  optional string type = 1 [(gogoproto.casttype) = "DataProductVersionConditionType", (gogoproto.customname) = "Type", (gogoproto.nullable) = false];

  // Status of the condition, one of True, False, Unknown.
  optional string status = 2 [(gogoproto.casttype) = "k8s.io/api/core/v1.ConditionStatus", (gogoproto.customname) = "Status", (gogoproto.nullable) = false];

  // Last time the condition transitioned from one status to another.
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastTransitionTime = 4 [(gogoproto.customname) = "LastTransitionTime"];

  // The reason for the condition's last transition.
  optional string reason = 5 [(gogoproto.customname) = "Reason", (gogoproto.nullable) = false];

  // A human readable message indicating details about the transition.
  optional string message = 6 [(gogoproto.customname) = "Message", (gogoproto.nullable) = false];
}

// +kubebuilder:object:root=true
// DataProductVersionList contains a list of DataProductVersion
message DataProductVersionList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1 [(gogoproto.customname) = "ListMeta", (gogoproto.nullable) = false];

  repeated DataProductVersion items = 2 [(gogoproto.customname) = "Items", (gogoproto.nullable) = false];
}

// DataProductVersionSpec defines the desired state of a DataProductVersion
message DataProductVersionSpec {
  // ProductRef contains the object reference to the DataProduct
  // resource which the DataProductVersion describes the version of
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference productRef = 1 [(gogoproto.customname) = "ProductRef", (gogoproto.nullable) = false];

  // User-provided description of the object
  // +kubebuilder:validation:Optional
  // +kubebuilder:default:=""
  // +kubebuilder:validation:MaxLength=512
  optional string description = 2 [(gogoproto.customname) = "Description"];

  // The name of the version which preceded the current version
  // +kubebuilder:validation:MaxLength=63
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string prevVersionName = 3 [(gogoproto.customname) = "PrevVersionName"];

  // Indicates if the version is a baseline, and if so will cause Modela to garbage collect the resources from previous versions
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool baseline = 4 [(gogoproto.customname) = "Baseline"];

  // The name of the Account which created the object, which exists in the same tenant as the object
  // +kubebuilder:default:="no-one"
  // +kubebuilder:validation:Optional
  optional string owner = 5 [(gogoproto.customname) = "Owner"];
}

// DataProductVersionStatus defines the observed state of a DataProductVersion
message DataProductVersionStatus {
  // ObservedGeneration is the last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 1 [(gogoproto.customname) = "ObservedGeneration", (gogoproto.nullable) = false];

  // The last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastUpdated = 2 [(gogoproto.customname) = "LastUpdated"];

  // In the case of failure, the Dataset resource controller will set this field with a failure reason
  // Borrowed from cluster api controller
  optional string failureReason = 3 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.StatusError", (gogoproto.customname) = "FailureReason"];

  // In the case of failure, the Dataset resource controller will set this field with a failure message
  optional string failureMessage = 4 [(gogoproto.customname) = "FailureMessage"];

  // +patchMergeKey=type
  // +patchStrategy=merge
  // +kubebuilder:validation:Optional
  repeated DataProductVersionCondition conditions = 5 [(gogoproto.customname) = "Conditions", (gogoproto.nullable) = false];
}

// DataSource defines the specification for the file format and column-level schema of data to be used within Modela
// +kubebuilder:object:root=true
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Ready",type="string",JSONPath=".status.conditions[?(@.type==\"Ready\")].status",description=""
// +kubebuilder:printcolumn:name="Owner",type="string",JSONPath=".spec.owner"
// +kubebuilder:printcolumn:name="Version",type="string",JSONPath=".spec.versionName"
// +kubebuilder:printcolumn:name="Format",type="string",JSONPath=".spec.flatfile.fileType"
// +kubebuilder:printcolumn:name="Type",type="string",JSONPath=".spec.datasetType"
// +kubebuilder:printcolumn:name="Task",type="string",JSONPath=".spec.task"
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp"
// +kubebuilder:subresource:status
// +kubebuilder:resource:path=datasources,singular=datasource,shortName="dsrc",categories={data,modela,all}
message DataSource {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1 [(gogoproto.customname) = "ObjectMeta", (gogoproto.nullable) = false];

  optional DataSourceSpec spec = 2 [(gogoproto.customname) = "Spec", (gogoproto.nullable) = false];

  // +optional
  optional DataSourceStatus status = 3 [(gogoproto.customname) = "Status", (gogoproto.nullable) = false];
}

// DataSourceCondition describes the state of a DataSource at a certain point
message DataSourceCondition {
  // Type of condition.
  optional string type = 1 [(gogoproto.casttype) = "DataSourceConditionType", (gogoproto.customname) = "Type", (gogoproto.nullable) = false];

  // Status of the condition, one of True, False, or Unknown
  optional string status = 2 [(gogoproto.casttype) = "k8s.io/api/core/v1.ConditionStatus", (gogoproto.customname) = "Status", (gogoproto.nullable) = false];

  // Last time the condition transitioned from one status to another
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastTransitionTime = 4 [(gogoproto.customname) = "LastTransitionTime"];

  // The reason for the condition's last transition.
  optional string reason = 5 [(gogoproto.customname) = "Reason", (gogoproto.nullable) = false];

  // A human readable message indicating details about the transition
  optional string message = 6 [(gogoproto.customname) = "Message", (gogoproto.nullable) = false];
}

// DataSourceList contains a list of DataSource objects
// +kubebuilder:object:root=true
message DataSourceList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1 [(gogoproto.customname) = "ListMeta", (gogoproto.nullable) = false];

  repeated DataSource items = 2 [(gogoproto.customname) = "Items", (gogoproto.nullable) = false];
}

// DataSourceSpec defines the desired state of the DataSource
message DataSourceSpec {
  // The name of the Account which created the object, which exists in the same tenant as the object
  // +kubebuilder:default:="no-one"
  // +kubebuilder:validation:Optional
  optional string owner = 1 [(gogoproto.customname) = "Owner"];

  // The name of the DataProductVersion which describes the version of the resource
  // that exists in the same DataProduct namespace as the resource
  // +kubebuilder:validation:MaxLength=63
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string versionName = 2 [(gogoproto.customname) = "VersionName"];

  // User-provided description of the object
  // +kubebuilder:default:=""
  // +kubebuilder:validation:MaxLength=512
  // +kubebuilder:validation:Optional
  optional string description = 3 [(gogoproto.customname) = "Description"];

  // The type of dataset; currently, the only supported type is `tabular`
  // +kubebuilder:default:="tabular"
  // +kubebuilder:validation:Optional
  optional string datasetType = 4 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.DatasetType", (gogoproto.customname) = "DatasetType"];

  // The schema which will be used during the ingestion process of any Dataset resources which specify the DataSource
  optional Schema schema = 5 [(gogoproto.customname) = "Schema", (gogoproto.nullable) = false];

  // Flat file spec define the paramter needed to read a flat file.
  // +kubebuilder:validation:Optional
  optional FlatFileFormatSpec flatfile = 6 [(gogoproto.customname) = "FlatFile"];

  // If true, this datasource is for labeled data.
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool labeled = 7 [(gogoproto.customname) = "Labeled"];

  // The specification for how incoming data should be sampled (i.e. how many rows should be used). Applicable
  // primarily for very large datasets
  optional SampleSpec sample = 9 [(gogoproto.customname) = "Sample", (gogoproto.nullable) = false];

  // The default task for Dataset resources created from the Data Source. If null, the task type will default to the
  // the default task type of the Data Product which contains the Data Source
  // +kubebuilder:validation:Optional
  optional string task = 10 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.MLTask", (gogoproto.customname) = "Task"];

  // The machine learning subtask relevant to the primary task (text classification, image object detection, etc.)
  // +kubebuilder:default:="none"
  // +kubebuilder:validation:Optional
  optional string subtask = 11 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.MLSubtask", (gogoproto.customname) = "SubTask"];

  // List of relationships to other data sources
  // +kubebuilder:validation:Optional
  repeated RelationshipSpec relationships = 12 [(gogoproto.customname) = "Relationships", (gogoproto.nullable) = false];

  // Labeling specificies how to automatically label the dataset using positive and negative rules
  // +kubebuilder:validation:Optional
  optional LabelingSpec labeling = 13 [(gogoproto.customname) = "Labeling", (gogoproto.nullable) = false];

  // InferredFrom specifies the location of the data that was used to generate the schema of the Data Source
  // +kubebuilder:validation:Optional
  optional DataLocation inferredFrom = 14 [(gogoproto.customname) = "InferredFrom"];

  // The specification for tests for a new dataset
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuite unitTestsTemplate = 15 [(gogoproto.customname) = "UnitTestsTemplate", (gogoproto.nullable) = false];

  // +kubebuilder:validation:Optional
  optional string ingestMethod = 16 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.FeatureStoreIngestType", (gogoproto.customname) = "IngestMethod"];
}

// DataSourceStatus defines the observed state of a DataSource object
message DataSourceStatus {
  // The number of columns determined to be present in the DataSource's schema
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Optional
  optional int32 cols = 1 [(gogoproto.customname) = "Cols", (gogoproto.nullable) = false];

  // ObservedGeneration is the last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 2 [(gogoproto.customname) = "ObservedGeneration", (gogoproto.nullable) = false];

  // Last time the DataSource was used to create a Dataset
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastDatasetCreated = 3 [(gogoproto.customname) = "LastDatasetCreated"];

  // The name of the last Dataset created using the DataSource
  // +kubebuilder:validation:Optional
  optional string lastDatasetName = 4 [(gogoproto.customname) = "LastDatasetName", (gogoproto.nullable) = false];

  // Last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastUpdated = 5 [(gogoproto.customname) = "LastUpdated"];

  // In the case of failure, the DataSource resource controller will set this field with a failure reason
  // +kubebuilder:validation:Optional
  optional string failureReason = 6 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.StatusError", (gogoproto.customname) = "FailureReason"];

  // In the case of failure, the DataSource resource controller will set this field with a failure message
  // +kubebuilder:validation:Optional
  optional string failureMessage = 7 [(gogoproto.customname) = "FailureMessage"];

  // +patchMergeKey=type
  // +patchStrategy=merge
  // +kubebuilder:validation:Optional
  repeated DataSourceCondition conditions = 8 [(gogoproto.customname) = "Conditions", (gogoproto.nullable) = false];
}

// Dataset represents a chunk of data that has been analyzed and stored inside a managed bucket
// +kubebuilder:object:root=true
// +kubebuilder:subresource:status
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Status",type="string",JSONPath=".status.phase"
// +kubebuilder:printcolumn:name="Owner",type="string",JSONPath=".spec.owner"
// +kubebuilder:printcolumn:name="Version",type="string",JSONPath=".spec.versionName"
// +kubebuilder:printcolumn:name="Data Source",type="string",JSONPath=".spec.datasourceName"
// +kubebuilder:printcolumn:name="Type",type="string",JSONPath=".spec.type"
// +kubebuilder:printcolumn:name="Rows",type="integer",JSONPath=".status.statistics.rows"
// +kubebuilder:printcolumn:name="Columns",type="integer",JSONPath=".status.statistics.cols"
// +kubebuilder:printcolumn:name="Size",type="integer",JSONPath=".status.statistics.fileSize"
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp",description=""
// +kubebuilder:resource:path=datasets,shortName=dset,singular=dataset,categories={data,modela,all}
message Dataset {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1 [(gogoproto.customname) = "ObjectMeta", (gogoproto.nullable) = false];

  optional DatasetSpec spec = 2 [(gogoproto.customname) = "Spec", (gogoproto.nullable) = false];

  // +optional
  optional DatasetStatus status = 3 [(gogoproto.customname) = "Status", (gogoproto.nullable) = false];
}

// DatasetCondition describes the state of a dataset at a certain point
message DatasetCondition {
  optional string type = 1 [(gogoproto.casttype) = "DatasetConditionType", (gogoproto.customname) = "Type", (gogoproto.nullable) = false];

  // Status of the condition, one of True, False, Unknown
  optional string status = 2 [(gogoproto.casttype) = "k8s.io/api/core/v1.ConditionStatus", (gogoproto.customname) = "Status", (gogoproto.nullable) = false];

  // Last time the condition transitioned from one status to another.
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastTransitionTime = 4 [(gogoproto.customname) = "LastTransitionTime"];

  // The reason for the condition's last transition.
  // +kubebuilder:validation:Optional
  optional string reason = 5 [(gogoproto.customname) = "Reason", (gogoproto.nullable) = false];

  // A human readable message indicating details about the transition.
  // +kubebuilder:validation:Optional
  optional string message = 6 [(gogoproto.customname) = "Message", (gogoproto.nullable) = false];
}

// Represent the status of a groupby
message DatasetGroupByStatus {
  // The locations of the datasets files. Each file is the group
  // +kubebuilder:validation:Optional
  optional string datasetsURI = 1 [(gogoproto.customname) = "DatasetsURI", (gogoproto.nullable) = false];

  // The locations of the datasets files.
  // +kubebuilder:validation:Optional
  optional string profilesURI = 2 [(gogoproto.customname) = "ProfilesURI", (gogoproto.nullable) = false];

  // The locations of the report file. One report for each key
  // +kubebuilder:validation:Optional
  optional string reportsURI = 3 [(gogoproto.customname) = "ReportsURI", (gogoproto.nullable) = false];

  // The locations of the report file. One report for each key
  // +kubebuilder:validation:Optional
  optional string unitTestsURI = 4 [(gogoproto.customname) = "UnitTestsURI", (gogoproto.nullable) = false];

  // The locations of the time series feature files. The file contain a line for each feature
  // +kubebuilder:validation:Optional
  optional string featuresURI = 5 [(gogoproto.customname) = "FeaturesURI", (gogoproto.nullable) = false];

  // Holds the worker on going result, when a worker finish, we update the location of thier result files
  // +kubebuilder:validation:Optional
  repeated github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.WorkerRunResult workerResults = 6 [(gogoproto.customname) = "WorkerResults", (gogoproto.nullable) = false];
}

// +kubebuilder:object:root=true
// DatasetList contains a list of Datasets
message DatasetList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1 [(gogoproto.customname) = "ListMeta", (gogoproto.nullable) = false];

  repeated Dataset items = 2 [(gogoproto.customname) = "Items", (gogoproto.nullable) = false];
}

// DatasetSpec defines the desired state of the Dataset
message DatasetSpec {
  // The name of the Account which created the object, which exists in the same tenant as the object
  // +kubebuilder:default:="no-one"
  // +kubebuilder:validation:Optional
  optional string owner = 1 [(gogoproto.customname) = "Owner"];

  // The name of the DataProductVersion which describes the version of the resource
  // that exists in the same DataProduct namespace as the resource
  // +kubebuilder:default:=""
  // +kubebuilder:validation:MaxLength=63
  // +kubebuilder:validation:Required
  // +required
  optional string versionName = 2 [(gogoproto.customname) = "VersionName"];

  // The reference to the Data Source resource which exists in the same Data Product namespace as the object.
  // The Data Source must represent the columns and the task type of the Dataset. The validation rules associated with
  // the Data Source will be validated against the raw data of the Dataset once it is created
  // +kubebuilder:validation:Required
  // +kubebuilder:validation:MaxLength=63
  // +kubebuilder:default:=""
  // +required
  optional string datasourceName = 3 [(gogoproto.customname) = "DataSourceName"];

  // In case of training data, this is the model class name that created it.
  // +kubebuilder:validation:Optional
  optional string featureGroupName = 4 [(gogoproto.customname) = "FeatureGroupName"];

  // In case of training data, this is the model class name that created it.
  // +kubebuilder:validation:Optional
  optional string modelClassName = 5 [(gogoproto.customname) = "ModelClassName"];

  // User-provided description of the object
  // +kubebuilder:validation:MaxLength=512
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string description = 6 [(gogoproto.customname) = "Description"];

  // User-provided display name of the object
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string displayName = 7 [(gogoproto.customname) = "DisplayName"];

  // The dataset role
  // +kubebuilder:default:="training"
  // +kubebuilder:validation:Optional
  optional string role = 8 [(gogoproto.casttype) = "DatasetRole", (gogoproto.customname) = "Role"];

  // Indicates if a PDF report containing the Dataset's profile should be generated
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool reported = 9 [(gogoproto.customname) = "Reported"];

  // Indicates if the resource controller has created a snapshot of the data in the case that it is being read
  // directly from a database, and must be converted to a flat-file type such as a CSV as a result
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool snapshotted = 10 [(gogoproto.customname) = "Snapshotted"];

  // Indicates if the Dataset should be checked against the validation rules of its Data Source
  // +kubebuilder:default:=true
  // +kubebuilder:validation:Optional
  optional bool unitTested = 11 [(gogoproto.customname) = "UnitTested"];

  // Origin is the location of the data file or database query which holds the raw data of the Dataset. When the Dataset is
  // created, the resource controller will retrieve the data from the location, validate it against its Data Source
  // if applicable, and store it inside the `live` section of the Virtual Bucket resource specified by the location
  // +kubebuilder:validation:Optional
  optional DataLocation origin = 12 [(gogoproto.customname) = "Origin", (gogoproto.nullable) = false];

  // Location is the final location of the data which was copied from the `Origin` location during the ingestion phase.
  // This field is set by the Dataset resource controller and should not be changed by any end-users
  // +kubebuilder:validation:Required
  // +required
  optional DataLocation location = 14 [(gogoproto.customname) = "Location", (gogoproto.nullable) = false];

  // Resources specifies the resource requirements which the Dataset will request when creating Jobs to analyze the data
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ResourceSpec resources = 15 [(gogoproto.customname) = "Resources", (gogoproto.nullable) = false];

  // The deadline in seconds for all Jobs created by the Dataset
  // +kubebuilder:default:=600
  // +kubebuilder:validation:Optional
  optional int64 activeDeadlineSeconds = 16 [(gogoproto.customname) = "ActiveDeadlineSeconds"];

  // The type of dataset which was uploaded. `tabular` is the only supported type as of the current release
  // +kubebuilder:default:="tabular"
  // +kubebuilder:validation:Optional
  optional string type = 17 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.DatasetType", (gogoproto.customname) = "Type"];

  // The specification for how the data should be sampled, if applicable. Sampling may improve dataset and model creation
  // time in the case of very large datasets that are being rapidly prototyped and iterated on
  // +kubebuilder:validation:Optional
  optional SampleSpec sample = 18 [(gogoproto.customname) = "Sample", (gogoproto.nullable) = false];

  // If the dataset is syntactic, this is the syntactic spec
  // +kubebuilder:validation:Optional
  optional SyntheticSpec syntactic = 19 [(gogoproto.customname) = "Synthetic", (gogoproto.nullable) = false];

  // The machine learning task relevant to the Dataset. This field *must* be the same as the Data Source of the object
  // +kubebuilder:validation:Optional
  optional string task = 20 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.MLTask", (gogoproto.customname) = "Task"];

  // The machine learning sub task relevant to the Dataset. This field *must* be the same as the Data Source of the object
  // +kubebuilder:default:=none
  // +kubebuilder:validation:Optional
  optional string subtask = 21 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.MLSubtask", (gogoproto.customname) = "SubTask"];

  // The specification for how to find the correlations of the Dataset's features during the profiling phase.
  // Based on the specification, the data plane will compute the correlation between each feature and will store the highest-scoring
  // +kubebuilder:validation:Optional
  optional CorrelationSpec correlation = 23 [(gogoproto.customname) = "Correlation", (gogoproto.nullable) = false];

  // Indicates if the Dataset should be quickly processed.
  // If enabled, the validation, profiling, and reporting phases will be skipped.
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool fast = 24 [(gogoproto.customname) = "Fast"];

  // Indicates if the Dataset should be featurized. Features are computed using tsfresh.
  // If the dataset is grouped dataset, a feature will be computed to each group.
  // If enabled, the validation, profiling, and reporting phases will be skipped.
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool featurized = 25 [(gogoproto.customname) = "Featurized"];

  // The reference to the Lab under which Jobs created by the Dataset will be executed
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference labRef = 26 [(gogoproto.customname) = "LabRef", (gogoproto.nullable) = false];

  // For dataset that contain feedback information, this is reference to the serving dataset
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference servingDatasetRef = 27 [(gogoproto.customname) = "ServingDatasetRef", (gogoproto.nullable) = false];

  // Used for prediction dataset, contain a reference to the predictor resource that created this dataset
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference predictorRef = 28 [(gogoproto.customname) = "PredictorRef", (gogoproto.nullable) = false];

  // If true generate feature histogram object from this dataset columns.
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool generateFeatureHistogram = 29 [(gogoproto.customname) = "GenerateFeatureHistogram"];

  // The specification for tests for a new dataset
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuite unitTests = 30 [(gogoproto.customname) = "UnitTests", (gogoproto.nullable) = false];

  // Define how to group by the base dataset, before making the forecasts.
  // By default, this dataset is assigned
  optional GroupBySpec groupBy = 31 [(gogoproto.customname) = "GroupBy", (gogoproto.nullable) = false];

  // Define how to group by the base dataset, before making the forecasts.
  // By default, this dataset is assigned
  optional GroupDatasetLocationsSpec groupLocations = 32 [(gogoproto.customname) = "GroupLocations", (gogoproto.nullable) = false];

  // If this dataset represent a group in a multi series dataset, these are the values of the group key.
  // +kubebuilder:validation:Optional
  repeated string key = 33 [(gogoproto.customname) = "Key"];
}

// DatasetStatistics contains statistics about the Dataset's overall data, as well as every feature of the data. The
// data structure is populated with information during the `Profiling` phase of the parent Dataset.
message DatasetStatistics {
  // Columns contains the collection of statistics for each feature
  // +kubebuilder:validation:Optional
  repeated ColumnStatistics columns = 1 [(gogoproto.customname) = "Columns", (gogoproto.nullable) = false];

  // Number of rows observed from the data
  // +kubebuilder:validation:Optional
  optional int32 rows = 3 [(gogoproto.customname) = "Rows", (gogoproto.nullable) = false];

  // Number of columns observed from the data
  // +kubebuilder:validation:Optional
  optional int32 cols = 4 [(gogoproto.customname) = "Cols", (gogoproto.nullable) = false];

  // The file size of the data in bytes
  // +kubebuilder:validation:Optional
  optional int32 fileSize = 5 [(gogoproto.customname) = "FileSize", (gogoproto.nullable) = false];

  // The top correlations between all features and the target feature
  // +kubebuilder:validation:Optional
  repeated Correlation correlationsWithTarget = 6 [(gogoproto.customname) = "CorrelationsWithTarget", (gogoproto.nullable) = false];

  // The top correlations between features, computed per the CorrelationSpec of the parent Dataset
  // +kubebuilder:validation:Optional
  repeated Correlation topCorrelations = 7 [(gogoproto.customname) = "TopCorrelations", (gogoproto.nullable) = false];
}

// DatasetStatus defines the observed state of a Dataset object
message DatasetStatus {
  // Statistics for each column of the Dataset, which are generated during the profiling phase.
  // +kubebuilder:validation:Optional
  optional DatasetStatistics statistics = 1 [(gogoproto.customname) = "Statistics", (gogoproto.nullable) = false];

  // The current phase of the Dataset progress
  // +kubebuilder:default:="Pending"
  // +kubebuilder:validation:Optional
  optional string phase = 2 [(gogoproto.casttype) = "DatasetPhase", (gogoproto.customname) = "Phase", (gogoproto.nullable) = false];

  // Reference to the report object that was generated for the dataset, which exists in the same Data Product namespace
  // as the object
  // +kubebuilder:validation:Optional
  optional string reportName = 3 [(gogoproto.customname) = "ReportName", (gogoproto.nullable) = false];

  // The location of report generated during the reporting phase. This field is intended for internal use
  // +kubebuilder:validation:Optional
  optional string reportUri = 4 [(gogoproto.customname) = "ReportUri", (gogoproto.nullable) = false];

  // The location of raw profile data. This field is intended for internal use
  // +kubebuilder:validation:Optional
  optional string profileUri = 5 [(gogoproto.customname) = "ProfileUri", (gogoproto.nullable) = false];

  // Whether or not the data was detected as imbalanced
  // +kubebuilder:validation:Optional
  optional bool imbalanced = 6 [(gogoproto.customname) = "Imbalanced", (gogoproto.nullable) = false];

  // The location of anomaly file. The file contain the list of rows that were marked as anomaly by an isolation forest.
  // algorithm
  // +kubebuilder:validation:Optional
  optional string anomaliesUri = 7 [(gogoproto.customname) = "AnomaliesUri", (gogoproto.nullable) = false];

  // ObservedGeneration is the last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 8 [(gogoproto.customname) = "ObservedGeneration", (gogoproto.nullable) = false];

  // List of validation results which are generated for every validation rule associated with the Dataset's Data Source
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuiteResult unitTestResults = 9 [(gogoproto.customname) = "UnitTestResults", (gogoproto.nullable) = false];

  // Last time the Dataset was used with a Study
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastStudyTime = 10 [(gogoproto.customname) = "LastStudyTime"];

  // In the case of failure, the Dataset resource controller will set this field with a failure reason
  // +kubebuilder:validation:Optional
  optional string failureReason = 12 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.StatusError", (gogoproto.customname) = "FailureReason"];

  // In the case of failure, the Dataset resource controller will set this field with a failure message
  // +kubebuilder:validation:Optional
  optional string failureMessage = 13 [(gogoproto.customname) = "FailureMessage"];

  // The current progress of the Dataset, with a maximum of 100, that is associated with the current phase
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional int32 progress = 14 [(gogoproto.customname) = "Progress", (gogoproto.nullable) = false];

  // Sha256 signature of the raw data. Intended for internal use
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string hash = 15 [(gogoproto.customname) = "Hash", (gogoproto.nullable) = false];

  // The log file specification that determines the location of all logs produced by the object
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.Logs logs = 16 [(gogoproto.customname) = "Logs", (gogoproto.nullable) = false];

  // If the dataset is derived, the name of the Dataset that the object is derived from
  // +kubebuilder:validation:Optional
  optional string derivedFromDataset = 17 [(gogoproto.customname) = "DerivedFromDataset"];

  // The last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastUpdated = 18 [(gogoproto.customname) = "LastUpdated"];

  // The Docker images used during the analysis of the Dataset
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.Images images = 19 [(gogoproto.customname) = "Images", (gogoproto.nullable) = false];

  // The time that the system started processing the Dataset, usually after the creation of the object
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time startTime = 20 [(gogoproto.customname) = "StartTime"];

  // The time that the Dataset finished processing, either due to completion or failure
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time endTime = 21 [(gogoproto.customname) = "EndTime"];

  // The generated training feature histogram, Empty if no feature histogram generated
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference featureHistogramRef = 22 [(gogoproto.customname) = "FeatureHistogramRef", (gogoproto.nullable) = false];

  // The location of dataset index file
  // +kubebuilder:validation:Optional
  optional DatasetGroupByStatus groupby = 23 [(gogoproto.customname) = "GroupBy", (gogoproto.nullable) = false];

  // +patchMergeKey=type
  // +patchStrategy=merge
  // +kubebuilder:validation:Optional
  repeated DatasetCondition conditions = 24 [(gogoproto.customname) = "Conditions", (gogoproto.nullable) = false];
}

// DatasetTemplate is used to generate new datasets
message DatasetTemplate {
  // Standard object's metadata.
  // More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1 [(gogoproto.customname) = "ObjectMeta", (gogoproto.nullable) = false];

  optional DatasetSpec spec = 2 [(gogoproto.customname) = "Spec", (gogoproto.nullable) = false];
}

// Define a threshold
message DriftThreshold {
  // The metric type name (e.g. F1 / Accuracy)
  // +kubebuilder:validation:Required
  optional string metric = 1 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.Metric", (gogoproto.customname) = "Metric", (gogoproto.nullable) = false];

  // The value of the metric for quantitive observations
  // +kubebuilder:validation:Required
  // +required
  optional double value = 2 [(gogoproto.customname) = "Value", (gogoproto.nullable) = false];
}

// Entity represents a entity object
// +kubebuilder:object:root=true
// +kubebuilder:storageversion
// +kubebuilder:subresource:status
// +kubebuilder:printcolumn:name="Ready",type="string",JSONPath=".status.conditions[?(@.type==\"Ready\")].status",description=""
// +kubebuilder:printcolumn:name="Owner",type="string",JSONPath=".spec.owner"
// +kubebuilder:printcolumn:name="Description",type="string",JSONPath=".spec.description"
// +kubebuilder:printcolumn:name="Version",type="string",JSONPath=".spec.versionName"
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp",description=""
// +kubebuilder:resource:path=entities,singular=entity,shortName=et,categories={data,modela}
message Entity {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1 [(gogoproto.customname) = "ObjectMeta", (gogoproto.nullable) = false];

  optional EntitySpec spec = 2 [(gogoproto.customname) = "Spec", (gogoproto.nullable) = false];

  // +optional
  optional EntityStatus status = 3 [(gogoproto.customname) = "Status", (gogoproto.nullable) = false];
}

// EntityCondition describes the state of a deployment at a certain point.
message EntityCondition {
  // Type of account condition.
  optional string type = 1 [(gogoproto.casttype) = "EntityConditionType", (gogoproto.customname) = "Type", (gogoproto.nullable) = false];

  // Status of the condition, one of True, False, Unknown.
  optional string status = 2 [(gogoproto.casttype) = "k8s.io/api/core/v1.ConditionStatus", (gogoproto.customname) = "Status", (gogoproto.nullable) = false];

  // Last time the condition transitioned from one status to another.
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastTransitionTime = 7 [(gogoproto.customname) = "LastTransitionTime"];

  // The reason for the condition's last transition.
  optional string reason = 4 [(gogoproto.customname) = "Reason", (gogoproto.nullable) = false];

  // A human readable message indicating details about the transition.
  optional string message = 5 [(gogoproto.customname) = "Message", (gogoproto.nullable) = false];
}

// +kubebuilder:object:root=true
// EntityList contains a list of Entity
message EntityList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1 [(gogoproto.customname) = "ListMeta", (gogoproto.nullable) = false];

  repeated Entity items = 2 [(gogoproto.customname) = "Items", (gogoproto.nullable) = false];
}

// EntitySpec contain the desired state of a Entity.
message EntitySpec {
  // The product version of the entity
  // +kubebuilder:default:=""
  optional string versionName = 1 [(gogoproto.customname) = "VersionName"];

  // Description of the entity
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  // +kubebuilder:validation:MaxLength=512
  optional string description = 2 [(gogoproto.customname) = "Description"];

  // Join keys are the way to join all the feature groups
  // +kubebuilder:validation:Optional
  repeated string joinKeys = 3 [(gogoproto.customname) = "JoinKeys"];

  // Owner of this Entity
  // +kubebuilder:default:="no-one"
  // +kubebuilder:validation:Pattern="[a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*"
  // +kubebuilder:validation:Optional
  optional string owner = 5 [(gogoproto.customname) = "Owner"];

  // +kubebuilder:validation:Optional
  optional string datasourceName = 6 [(gogoproto.customname) = "DataSourceName"];
}

// EntityStatus defines the observed state of Entity
message EntityStatus {
  // ObservedGeneration is the Last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 1 [(gogoproto.customname) = "ObservedGeneration", (gogoproto.nullable) = false];

  // Last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastUpdated = 2 [(gogoproto.customname) = "LastUpdated"];

  // +patchMergeKey=type
  // +patchStrategy=merge
  // +kubebuilder:validation:Optional
  repeated EntityCondition conditions = 3 [(gogoproto.customname) = "Conditions", (gogoproto.nullable) = false];
}

// ExcelNotebookSpec specifies the format of an excel file
message ExcelNotebookSpec {
  // Indicates if the excel reader should use the first sheet that contains data
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool firstSheetWithData = 1 [(gogoproto.customname) = "FirstSheetWithData"];

  // The name of the sheet that exists in the excel file to read data from
  // +kubebuilder:validation:Optional
  optional string sheetName = 2 [(gogoproto.customname) = "SheetName"];

  // The index of the sheet in the excel file to read data from
  // +kubebuilder:validation:Optional
  optional int32 sheetIndex = 3 [(gogoproto.customname) = "SheetIndex"];

  // The position of the row that contains the column names (i.e. the header)
  // +kubebuilder:validation:Optional
  optional int32 columnNameRow = 4 [(gogoproto.customname) = "ColumnNamesRow"];

  // The specification for the bounds of the data
  // +kubebuilder:validation:Optional
  optional ExcelSheetArea data = 5 [(gogoproto.customname) = "Data", (gogoproto.nullable) = false];
}

// ExcelSheetArea specifies the bounds of the data within an excel sheet
message ExcelSheetArea {
  // Indicates if the excel reader should read the entire sheet; if false, it will read only within the bounds
  // specified by the `To` and `From` fields of the ExcelSheetArea
  // +kubebuilder:default:=false
  optional bool entireSheet = 1 [(gogoproto.customname) = "EntireSheet"];

  // If reading part of the excel sheet, start with the column in this position
  optional int32 fromColumn = 2 [(gogoproto.customname) = "FromColumn"];

  // If reading part of the excel sheet, end with the column in this position
  optional int32 toColumn = 3 [(gogoproto.customname) = "ToColumn"];

  // If reading part of the excel sheet, start with the row in this position
  optional int32 fromRow = 4 [(gogoproto.customname) = "FromRow"];

  // If reading part of the excel sheet, end with the row in this position
  optional int32 toRow = 5 [(gogoproto.customname) = "ToRow"];
}

// FeatureGroup represent a group of features
// +kubebuilder:object:root=true
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Ready",type="string",JSONPath=".status.conditions[?(@.type==\"Ready\")].status",description=""
// +kubebuilder:printcolumn:name="Version",type="string",JSONPath=".spec.versionName"
// +kubebuilder:printcolumn:name="Schedule",type="string",JSONPath=".spec.schedule",description=""
// +kubebuilder:printcolumn:name="Last Run",type="date",JSONPath=".status.lastRun.at",description=""
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp",description=""
// +kubebuilder:resource:path=featuregroupes,singular=featuregroup,shortName="fsc",categories={data,modela}
// +kubebuilder:subresource:status
message FeatureGroup {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1 [(gogoproto.customname) = "ObjectMeta", (gogoproto.nullable) = false];

  optional FeatureGroupSpec spec = 2 [(gogoproto.customname) = "Spec", (gogoproto.nullable) = false];

  // +optional
  optional FeatureGroupStatus status = 3 [(gogoproto.customname) = "Status", (gogoproto.nullable) = false];
}

// FeatureGroupCondition describes the state of a deployment at a certain point.
message FeatureGroupCondition {
  // Type of account condition.
  optional string type = 1 [(gogoproto.casttype) = "FeatureGroupConditionType", (gogoproto.customname) = "Type", (gogoproto.nullable) = false];

  // Status of the condition, one of True, False, Unknown
  optional string status = 2 [(gogoproto.casttype) = "k8s.io/api/core/v1.ConditionStatus", (gogoproto.customname) = "Status", (gogoproto.nullable) = false];

  // Last time the condition transitioned from one status to another.
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastTransitionTime = 7 [(gogoproto.customname) = "LastTransitionTime"];

  // The reason for the condition's last transition.
  optional string reason = 4 [(gogoproto.customname) = "Reason", (gogoproto.nullable) = false];

  // A human readable message indicating details about the transition.
  optional string message = 5 [(gogoproto.customname) = "Message", (gogoproto.nullable) = false];
}

// +kubebuilder:object:root=true
// FeatureList contain a list of feature objects
message FeatureGroupList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1 [(gogoproto.customname) = "ListMeta", (gogoproto.nullable) = false];

  repeated FeatureGroup items = 2 [(gogoproto.customname) = "Items", (gogoproto.nullable) = false];
}

// FeatureGroupSpec contain the desired state of a FeatureGroup
message FeatureGroupSpec {
  // Owner is the owner of the feature group.
  // +kubebuilder:default:="no-one"
  // +kubebuilder:validation:Pattern="[a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*"
  // +kubebuilder:validation:Optional
  optional string owner = 1 [(gogoproto.customname) = "Owner"];

  // Version name is the product version for the feature group.
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string versionName = 2 [(gogoproto.customname) = "VersionName"];

  // Description of the feature group.
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  // +kubebuilder:validation:MaxLength=512
  optional string description = 3 [(gogoproto.customname) = "Description", (gogoproto.nullable) = false];

  // How this group is ingested
  // +kubebuilder:default:="batch"
  // +kubebuilder:validation:Optional
  optional string ingestType = 4 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.FeatureStoreIngestType", (gogoproto.customname) = "IngestType"];

  // A feature group must be part of an entity.
  optional string entityName = 5 [(gogoproto.customname) = "EntityName", (gogoproto.nullable) = false];

  // The features in the group.
  // +kubebuilder:validation:Optional
  repeated string features = 6 [(gogoproto.customname) = "Features"];

  // Schedule for running the pipeline
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.RunSchedule schedule = 7 [(gogoproto.customname) = "Schedule", (gogoproto.nullable) = false];

  // The name of the data source which contain the schema for this entity
  // +kubebuilder:validation:Optional
  optional Schema schema = 8 [(gogoproto.customname) = "Schema", (gogoproto.nullable) = false];

  // Unit test to run on data from this feature group upon ingrest.
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuite unitTests = 9 [(gogoproto.customname) = "UnitTests", (gogoproto.nullable) = false];

  // Specify the data for this feature group
  // +kubebuilder:validation:Optional
  optional DataLocation data = 10 [(gogoproto.customname) = "Data", (gogoproto.nullable) = false];

  // Materialization
  // +kubebuilder:validation:Optional
  optional MaterializationSpec materialization = 11 [(gogoproto.customname) = "Materialization", (gogoproto.nullable) = false];
}

// FeatureStatus defines the observed state of Feature
message FeatureGroupStatus {
  // Last run is the last time the feature group run
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.LastRunStatus lastProfile = 1 [(gogoproto.customname) = "LastProfile", (gogoproto.nullable) = false];

  // The time of the next schedule run
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time nextRun = 2 [(gogoproto.customname) = "NextRun"];

  // ObservedGeneration is the Last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 3 [(gogoproto.customname) = "ObservedGeneration", (gogoproto.nullable) = false];

  // Last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastUpdated = 4 [(gogoproto.customname) = "LastUpdated"];

  // The current number of rows in the feature group.
  // +kubebuilder:validation:Optional
  optional int32 rows = 5 [(gogoproto.customname) = "Rows", (gogoproto.nullable) = false];

  // +patchMergeKey=type
  // +patchStrategy=merge
  // +kubebuilder:validation:Optional
  repeated FeatureGroupCondition conditions = 6 [(gogoproto.customname) = "Conditions", (gogoproto.nullable) = false];
}

// FeatureHistogram represent a single feature in the feature store.
// +kubebuilder:object:root=true
// +kubebuilder:subresource:status
// +kubebuilder:printcolumn:name="Status",type="string",JSONPath=".status.phase"
// +kubebuilder:printcolumn:name="Owner",type="string",JSONPath=".spec.owner"
// +kubebuilder:printcolumn:name="Description",type="string",JSONPath=".spec.description"
// +kubebuilder:printcolumn:name="Version",type="string",JSONPath=".spec.versionName"
// +kubebuilder:printcolumn:name="Live",type="boolean",JSONPath=".spec.live"
// +kubebuilder:printcolumn:name="Start",type="date",JSONPath=".spec.start"
// +kubebuilder:printcolumn:name="End",type="date",JSONPath=".spec.end"
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp",description=""
// +kubebuilder:resource:path=featurehistograms,shortName=fh,singular=featurehistogram,categories={data,modela}
message FeatureHistogram {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1 [(gogoproto.customname) = "ObjectMeta", (gogoproto.nullable) = false];

  optional FeatureHistogramSpec spec = 2 [(gogoproto.customname) = "Spec", (gogoproto.nullable) = false];

  // +optional
  optional FeatureHistogramStatus status = 3 [(gogoproto.customname) = "Status", (gogoproto.nullable) = false];
}

// FeatureHistogramCondition describes the state of a deployment at a certain point.
message FeatureHistogramCondition {
  // Type of account condition.
  optional string type = 1 [(gogoproto.casttype) = "FeatureHistogramConditionType", (gogoproto.customname) = "Type", (gogoproto.nullable) = false];

  // Status of the condition, one of True, False, Unknown
  optional string status = 2 [(gogoproto.casttype) = "k8s.io/api/core/v1.ConditionStatus", (gogoproto.customname) = "Status", (gogoproto.nullable) = false];

  // Last time the condition transitioned from one status to another.
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastTransitionTime = 7 [(gogoproto.customname) = "LastTransitionTime"];

  // The reason for the condition's last transition.
  optional string reason = 4 [(gogoproto.customname) = "Reason", (gogoproto.nullable) = false];

  // A human readable message indicating details about the transition.
  optional string message = 5 [(gogoproto.customname) = "Message", (gogoproto.nullable) = false];
}

// +kubebuilder:object:root=true
// FeatureHistogramList contain a list of feature objects
message FeatureHistogramList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1 [(gogoproto.customname) = "ListMeta", (gogoproto.nullable) = false];

  repeated FeatureHistogram items = 2 [(gogoproto.customname) = "Items", (gogoproto.nullable) = false];
}

// FeatureHistogramSpec contain the desired state of a FeatureHistogram
message FeatureHistogramSpec {
  // The feature owner
  // +kubebuilder:validation:Optional
  // +kubebuilder:default:="no-one"
  optional string owner = 1 [(gogoproto.customname) = "Owner"];

  // The product version for the feature.
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string versionName = 2 [(gogoproto.customname) = "VersionName"];

  // Comments is a description of the feature
  // +kubebuilder:validation:Optional
  // +kubebuilder:default:=""
  // +kubebuilder:validation:MaxLength=512
  optional string description = 3 [(gogoproto.customname) = "Description"];

  // The list of columns to generate the histograms.
  // +kubebuilder:validation:Optional
  repeated string columns = 5 [(gogoproto.customname) = "Columns"];

  // A reference to the dataset or predictor that contain the column with this histogram
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference sourceRef = 6 [(gogoproto.customname) = "SourceRef"];

  // If true, this is a training dataset feature histogram. If false the histogram was generated during serving.
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool training = 7 [(gogoproto.customname) = "Training"];

  // If true, this is an active feature histogram. This feature histogram is being live updated by the predictorlet
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool live = 9 [(gogoproto.customname) = "Live"];

  // The start time of this feature histogram. For training dataset histogram this is set to the creation
  // time of the dataset
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time start = 10 [(gogoproto.customname) = "Start"];

  // The end time of the feature histogram. If reached, the predictor will start a new feature histogram
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time end = 11 [(gogoproto.customname) = "End"];

  // The histogram to compare to for data drift calc
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference baseRef = 12 [(gogoproto.customname) = "BaseRef", (gogoproto.nullable) = false];

  // Define drift thresholds. This is usually assigned from the predictor.
  // +kubebuilder:validation:Optional
  repeated DriftThreshold driftThresholds = 13 [(gogoproto.customname) = "DriftThresholds", (gogoproto.nullable) = false];

  // How much time in seconds, we should sync the im memory histograms to etcd
  // Default is one minute.
  // +kubebuilder:default:=60
  // +kubebuilder:validation:Optional
  optional int32 syncIntervalSec = 14 [(gogoproto.customname) = "SyncIntervalSec"];

  // Test suite for this histogram.
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuite unitTests = 15 [(gogoproto.customname) = "UnitTests", (gogoproto.nullable) = false];

  // If true, generate the unit tests
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool genUnitTests = 16 [(gogoproto.customname) = "GenUnitTests"];

  // Filter the filter for this unit test.
  // +kubebuilder:validation:Optional
  optional string featureFilter = 17 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.FeatureFilterType", (gogoproto.customname) = "FeatureFilter", (gogoproto.nullable) = false];

  // Set the reference type for this unit test
  // +kubebuilder:validation:Optional
  optional string referenceType = 18 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.ReferenceDataType", (gogoproto.customname) = "ReferenceType", (gogoproto.nullable) = false];
}

// FeatureHistogramStatus defines the observed state of FeatureHistogram
message FeatureHistogramStatus {
  // ObservedGeneration is the Last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 1 [(gogoproto.customname) = "ObservedGeneration", (gogoproto.nullable) = false];

  // The histogram values, map from column name to an histogram
  // +kubebuilder:validation:Optional
  repeated ColumnHistogram columns = 2 [(gogoproto.customname) = "Columns", (gogoproto.nullable) = false];

  // Last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastUpdated = 3 [(gogoproto.customname) = "LastUpdated"];

  // The log file specification that determines the location of all logs produced by the object
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.Logs logs = 5 [(gogoproto.customname) = "Logs", (gogoproto.nullable) = false];

  // The phase of the feature histogram
  // +kubebuilder:validation:Optional
  optional string phase = 6 [(gogoproto.casttype) = "FeatureHistogramPhase", (gogoproto.customname) = "Phase", (gogoproto.nullable) = false];

  // In the case of failure, the Dataset resource controller will set this field with a failure reason
  // +kubebuilder:validation:Optional
  optional string failureReason = 7 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.StatusError", (gogoproto.customname) = "FailureReason", (gogoproto.nullable) = false];

  // In the case of failure, the Dataset resource controller will set this field with a failure message
  // +kubebuilder:validation:Optional
  optional string failureMessage = 8 [(gogoproto.customname) = "FailureMessage", (gogoproto.nullable) = false];

  // Test suite for this histogram.
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuiteResult unitTestsResult = 9 [(gogoproto.customname) = "UnitTestsResult", (gogoproto.nullable) = false];

  // Total prediction recorded by this feature histograms
  // +kubebuilder:validation:Optional
  optional int32 total = 10 [(gogoproto.customname) = "Total", (gogoproto.nullable) = false];

  // Errors predictions
  // +kubebuilder:validation:Optional
  optional int32 errors = 11 [(gogoproto.customname) = "Errors", (gogoproto.nullable) = false];

  // +patchMergeKey=type
  // +patchStrategy=merge
  // +kubebuilder:validation:Optional
  repeated FeatureHistogramCondition conditions = 12 [(gogoproto.customname) = "Conditions", (gogoproto.nullable) = false];
}

// FlatFileFormatSpec defines the format for incoming flat-files to be parsed
message FlatFileFormatSpec {
  // The file type of incoming data which uses the DataSource (by default, a CSV file)
  // +kubebuilder:default:="csv"
  // +kubebuilder:validation:Optional
  optional string fileType = 1 [(gogoproto.casttype) = "FlatFileType", (gogoproto.customname) = "FileType"];

  // The file format for CSV files, if applicable
  // +kubebuilder:validation:Optional
  optional CsvFileSpec csv = 2 [(gogoproto.customname) = "Csv", (gogoproto.nullable) = false];

  // The file format for Excel files, if applicable
  // +kubebuilder:validation:Optional
  optional ExcelNotebookSpec excel = 3 [(gogoproto.customname) = "Excel", (gogoproto.nullable) = false];

  // The file format for Parquet files, if applicable
  // +kubebuilder:validation:Optional
  optional ParquetFileSpec parquet = 4 [(gogoproto.customname) = "Parquet", (gogoproto.nullable) = false];
}

message GaugeSpec {
  // Dataset is the name of the dataset
  // +kubebuilder:validation:Optional
  optional string datasetName = 1 [(gogoproto.customname) = "DatasetName"];

  // Column is the name of the column
  // +kubebuilder:validation:Optional
  optional string column = 2 [(gogoproto.customname) = "Column"];

  // Row is the row number
  // +kubebuilder:validation:Optional
  optional int32 row = 3 [(gogoproto.customname) = "Row"];

  // Scalar the a const value
  // +kubebuilder:validation:Optional
  optional string scalar = 4 [(gogoproto.customname) = "Scalar"];
}

// GitLocation specifies the Git location where Modela will track resources as YAML
message GitLocation {
  // The Git Connection resource which exists in the same tenant as the parent DataProduct
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string gitConnectionName = 1 [(gogoproto.customname) = "GitConnectionName"];

  // The URL to the destination Git repository
  // +kubebuilder:default:=""
  // +kubebuilder:validation:MaxLength=256
  optional string url = 2 [(gogoproto.customname) = "URL"];

  // The branch inside the Git repository
  // +kubebuilder:default:=""
  // +kubebuilder:validation:MaxLength=256
  optional string branch = 3 [(gogoproto.customname) = "Branch"];

  // Indicates if the repository is private
  // +kubebuilder:default:=true
  optional bool private = 4 [(gogoproto.customname) = "Private"];
}

message GovernanceReviewStatus {
  // The approval status, which can be approved or rejected
  optional string result = 1 [(gogoproto.casttype) = "ApprovalType", (gogoproto.customname) = "Result", (gogoproto.nullable) = false];

  // The date of the approval
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time approvalDate = 2 [(gogoproto.customname) = "ApprovalDate"];

  // Notes taken during the review
  optional string notes = 3 [(gogoproto.customname) = "Notes", (gogoproto.nullable) = false];
}

// GovernanceSpec describes the governance requirements for models produced under a DataProduct
message GovernanceSpec {
  // Indicates if governance is enabled
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool enabled = 1 [(gogoproto.customname) = "Enabled"];

  // The country whose regulations are under consideration
  // +kubebuilder:validation:Optional
  optional string country = 2 [(gogoproto.customname) = "Country"];

  // The account name of the IT reviewer
  // +kubebuilder:validation:Optional
  optional string itReviewer = 3 [(gogoproto.customname) = "ITReviewer"];

  // The account name of the compliance reviewer
  // +kubebuilder:validation:Optional
  optional string complianceReviewer = 4 [(gogoproto.customname) = "ComplianceReviewer"];

  // The account name of the business reviewer
  // +kubebuilder:validation:Optional
  optional string businessReviewer = 5 [(gogoproto.customname) = "BusinessReviewer"];

  // The name of the team members account that goveren this data product.
  // +kubebuilder:validation:Optional
  repeated string members = 6 [(gogoproto.customname) = "Members"];
}

// GovernanceStatus describes the current state of a governance review for a model
message GovernanceStatus {
  // The review status for IT department
  // +kubebuilder:validation:Optional
  optional GovernanceReviewStatus ITReviewStatus = 1 [(gogoproto.nullable) = false];

  // The review status for the compliance department
  // +kubebuilder:validation:Optional
  optional GovernanceReviewStatus complianceReviewStatus = 2 [(gogoproto.customname) = "ComplianceReviewStatus", (gogoproto.nullable) = false];

  // The review status for the management department
  // +kubebuilder:validation:Optional
  optional GovernanceReviewStatus businessReviewStatus = 3 [(gogoproto.customname) = "BusinessReviewStatus", (gogoproto.nullable) = false];
}

// Define how to group by the data, before processing.
message GroupBySpec {
  // Enabled the group by, if not enabled, the dataset is treated as defined in the data source.
  // +kubebuilder:validation:Optional
  optional bool enabled = 1 [(gogoproto.customname) = "Enabled"];

  // For group forecasting, this is the key of the group
  // If not specify this will be the key from the data source.
  // +kubebuilder:validation:Optional
  repeated string groupby = 2 [(gogoproto.customname) = "GroupBy"];

  // The time series frequency, if not specify they freq will be the base freq from the data source.
  // +kubebuilder:default:="day"
  // +kubebuilder:validation:Optional
  optional string freq = 3 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.Freq", (gogoproto.customname) = "Freq"];

  // The interval to forecast at this level. If not specify the interval will be the base interval
  // the data source
  // +kubebuilder:default:=1
  // +kubebuilder:validation:Optional
  optional int32 interval = 4 [(gogoproto.customname) = "Interval"];

  // Aggregation function. Define how to aggregate
  // By default this is the aggregation function from the data source.
  // +kubebuilder:default:="sum"
  // +kubebuilder:validation:Optional
  optional string aggr = 5 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.Aggregate", (gogoproto.customname) = "Aggr", (gogoproto.nullable) = false];
}

// If this is a group dataset , the group spec contain the location of the different artifacts
message GroupDatasetLocationsSpec {
  // The root folder of all the groups
  optional string groupsRoot = 1 [(gogoproto.customname) = "GroupsRoot"];

  // The root of the group folders and files
  // +kubebuilder:validation:Optional
  optional string groupRoot = 2 [(gogoproto.customname) = "GroupRoot"];

  // The folder of group data
  // +kubebuilder:validation:Optional
  optional string groupDataFolder = 3 [(gogoproto.customname) = "GroupDataFolder"];

  // The folder of group data
  // +kubebuilder:validation:Optional
  optional string groupDataFile = 4 [(gogoproto.customname) = "GroupDataFile"];

  // The folder group data profile
  // +kubebuilder:validation:Optional
  optional string groupProfileFolder = 5 [(gogoproto.customname) = "GroupProfileFolder"];

  // The path of the group report
  // +kubebuilder:validation:Optional
  optional string groupReportFile = 6 [(gogoproto.customname) = "GroupReportFile"];

  // The path of the group features files
  // +kubebuilder:validation:Optional
  optional string groupFeaturesFile = 7 [(gogoproto.customname) = "GroupFeaturesFile"];
}

message HistogramSpec {
  // Dataset is the name of the dataset
  // +kubebuilder:validation:Optional
  optional string datasetName = 1 [(gogoproto.customname) = "DatasetName"];

  // name of the X column
  // +kubebuilder:validation:Optional
  optional string x = 2 [(gogoproto.customname) = "X"];

  // Show borther
  // +kubebuilder:validation:Optional
  optional int32 bins = 3 [(gogoproto.customname) = "Bins"];
}

// ImageLocation specifies the destination for all model images produced under a DataProduct
message ImageLocation {
  // The canonical name of the image repository. If not set, it will default to docker/{dataproduct_name}
  // +kubebuilder:default:=""
  // +kubebuilder:validation:MaxLength=256
  optional string name = 1 [(gogoproto.customname) = "Name"];

  // The image repository Connection resource which exists in the same tenant as the parent DataProduct. If the field
  // is not set, Modela will ignore the image location and not push images
  // +kubebuilder:default:=""
  optional string registryConnectionName = 2 [(gogoproto.customname) = "RegistryConnectionName"];
}

// KPI specifies a key performance indicator for a DataProduct. Currently not implemented.
message KPI {
  // The name of the KPI
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string name = 1 [(gogoproto.customname) = "Name"];

  // The value of the KPI
  optional double value = 2 [(gogoproto.customname) = "Value"];
}

// Labeling rule define a column expression
message LabelingRule {
  // +kubebuilder:validation:Optional
  optional string column = 1 [(gogoproto.customname) = "Column", (gogoproto.nullable) = false];

  // +kubebuilder:validation:Optional
  optional string operator = 2 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.Op", (gogoproto.customname) = "Operator", (gogoproto.nullable) = false];

  // +kubebuilder:validation:Optional
  optional string value = 3 [(gogoproto.customname) = "Value", (gogoproto.nullable) = false];
}

message LabelingSpec {
  // If true enable labeling.
  optional bool enabled = 1 [(gogoproto.customname) = "Enabled"];

  // The name of the column that will hold the result.
  optional string resultColumn = 2 [(gogoproto.customname) = "ResultColumn", (gogoproto.nullable) = false];

  // List of rules for positive rules.
  repeated LabelingRule positive = 3 [(gogoproto.customname) = "Positive", (gogoproto.nullable) = false];

  // List of negative rules
  repeated LabelingRule negative = 4 [(gogoproto.customname) = "Negative", (gogoproto.nullable) = false];
}

message LineChartSpec {
  // Dataset is the name of the dataset
  optional string datasetName = 1 [(gogoproto.customname) = "DatasetName"];

  // name of the X column
  // +kubebuilder:validation:Optional
  optional string x = 2 [(gogoproto.customname) = "X"];

  // Y column
  // +kubebuilder:validation:Optional
  optional string y = 3 [(gogoproto.customname) = "Y"];

  // Show borther
  // +kubebuilder:validation:Optional
  optional bool legend = 4 [(gogoproto.customname) = "Legend"];
}

message MaterializationSpec {
  // If true, update the online store
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool online = 1 [(gogoproto.customname) = "Online"];

  // If true update the offline store.
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool offline = 2 [(gogoproto.customname) = "Offline"];

  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time startDate = 3 [(gogoproto.customname) = "StartDate"];

  // +kubebuilder:validation:Optional
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:default:=0
  optional int32 ttl = 4 [(gogoproto.customname) = "TTL"];

  // Number of days to store information from the past in the feature store.
  // +kubebuilder:validation:Optional
  // +kubebuilder:default:=21
  // +kubebuilder:validation:Minimum=0
  optional int32 backfill = 5 [(gogoproto.customname) = "Backfill"];
}

message MetricSpec {
  // Dataset is the name of the dataset
  // +kubebuilder:validation:Optional
  optional string datasetName = 1 [(gogoproto.customname) = "DatasetName"];

  // Column is the name of the column
  // +kubebuilder:validation:Optional
  optional string column = 2 [(gogoproto.customname) = "Column"];

  // Row is the row number
  // +kubebuilder:validation:Optional
  optional int32 row = 3 [(gogoproto.customname) = "Row"];

  // Scalar the a const value
  // +kubebuilder:validation:Optional
  optional string scalar = 4 [(gogoproto.customname) = "Scalar"];
}

message OutlierStat {
  // The number of outliers below baseline
  optional int32 lower = 1 [(gogoproto.customname) = "Lower", (gogoproto.nullable) = false];

  // The number of outliers above baseline
  optional int32 upper = 2 [(gogoproto.customname) = "Upper", (gogoproto.nullable) = false];

  // Percentage of rows detected as outliers
  optional float percent = 3 [(gogoproto.customname) = "Percent", (gogoproto.nullable) = false];
}

message PageSpec {
  repeated RowSpec rows = 1 [(gogoproto.customname) = "Rows", (gogoproto.nullable) = false];
}

// ParquetFileSpec specifies the format of a CSV (comma-separated values) file
message ParquetFileSpec {
  // The character used to separate fields (by default, a comma)
  // +kubebuilder:default:="auto"
  // +kubebuilder:validation:Optional
  optional string engine = 1 [(gogoproto.customname) = "Engine"];
}

// Recipe represents a single batch of data
// +kubebuilder:object:root=true
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Ready",type="string",JSONPath=".status.conditions[?(@.type==\"Ready\")].status"
// +kubebuilder:printcolumn:name="Owner",type="string",JSONPath=".spec.owner"
// +kubebuilder:printcolumn:name="Version",type="string",JSONPath=".spec.versionName"
// +kubebuilder:printcolumn:name="Description",type="string",JSONPath=".spec.description"
// +kubebuilder:printcolumn:name="Last Run",type="date",JSONPath=".status.lastRun.at",description=""
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp",description=""
// +kubebuilder:subresource:status
// +kubebuilder:resource:path=recipes,shortName=rc,singular=recipe,categories={data,modela,all}
message Recipe {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1 [(gogoproto.customname) = "ObjectMeta", (gogoproto.nullable) = false];

  optional RecipeSpec spec = 2 [(gogoproto.customname) = "Spec", (gogoproto.nullable) = false];

  // +optional
  optional RecipeStatus status = 3 [(gogoproto.customname) = "Status", (gogoproto.nullable) = false];
}

// RecipeCondition describes the state of a dataset at a certain point.
message RecipeCondition {
  optional string type = 1 [(gogoproto.casttype) = "RecipeConditionType", (gogoproto.customname) = "Type", (gogoproto.nullable) = false];

  // Status of the condition, one of True, False, Unknown.
  optional string status = 2 [(gogoproto.casttype) = "k8s.io/api/core/v1.ConditionStatus", (gogoproto.customname) = "Status", (gogoproto.nullable) = false];

  // Last time the condition transitioned from one status to another.
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastTransitionTime = 3 [(gogoproto.customname) = "LastTransitionTime"];

  // The reason for the condition's last transition.
  // +kubebuilder:validation:Optional
  optional string reason = 4 [(gogoproto.customname) = "Reason", (gogoproto.nullable) = false];

  // A human readable message indicating details about the transition.
  // +kubebuilder:validation:Optional
  optional string message = 5 [(gogoproto.customname) = "Message", (gogoproto.nullable) = false];
}

// RecipeInputSpec specify the input for a recipe
message RecipeInputSpec {
  // DatasetName is the name of the dataset
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string datasetName = 1 [(gogoproto.customname) = "DatasetName"];

  // Location is the folder of the actual data resides, if not using dataset
  // +required.
  optional DataLocation location = 2 [(gogoproto.customname) = "Location"];

  // Format is the dataset format
  // +kubebuilder:default:=csv
  optional string format = 3 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.DatastoreType", (gogoproto.customname) = "Format"];
}

// RecipeList contains a list of Recipes
// +kubebuilder:object:root=true
message RecipeList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1 [(gogoproto.customname) = "ListMeta", (gogoproto.nullable) = false];

  repeated Recipe items = 2 [(gogoproto.customname) = "Items", (gogoproto.nullable) = false];
}

// RecipeOutputSpec for the recipe output
message RecipeOutputSpec {
  // CreateDataset if true, create a new dataset when the recipe is done.
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool createDataset = 1 [(gogoproto.customname) = "CreateDataset"];

  // DatasetName is the name of the dataset output to the recipe
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string datasetName = 2 [(gogoproto.customname) = "DatasetName"];

  // Location is the data location folder of the actual data resides.
  // +kubebuilder:validation:Required
  // +required
  optional DataLocation location = 3 [(gogoproto.customname) = "Location"];
}

message RecipePartSpec {
  // RecipeName is the name of the recipe to run
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string recipeName = 1 [(gogoproto.customname) = "RecipeName"];

  // Dependents is the list of recipe that need to run after this recipe.
  repeated string dependents = 2 [(gogoproto.customname) = "Dependents"];
}

// RecipeRun represent one execution of the recipe.
// Execution is performed by creating a Kubernetes job.
// +kubebuilder:object:root=true
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Status",type="string",JSONPath=".status.phase"
// +kubebuilder:printcolumn:name="Owner",type="string",JSONPath=".spec.owner"
// +kubebuilder:printcolumn:name="Version",type="string",JSONPath=".spec.versionName"
// +kubebuilder:printcolumn:name="Recipe",type="string",JSONPath=".spec.recipeName"
// +kubebuilder:printcolumn:name="StartTime",type="date",JSONPath=".status.startTime",priority=1
// +kubebuilder:printcolumn:name="CompletionTime",type="date",JSONPath=".status.completionTime",priority=1
// +kubebuilder:subresource:status
// +kubebuilder:resource:path=reciperuns,shortName=rcr,singular=reciperun,categories={data,modela,all}
message RecipeRun {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1 [(gogoproto.customname) = "ObjectMeta", (gogoproto.nullable) = false];

  optional RecipeRunSpec spec = 2 [(gogoproto.customname) = "Spec", (gogoproto.nullable) = false];

  // +optional
  optional RecipeRunStatus status = 3 [(gogoproto.customname) = "Status", (gogoproto.nullable) = false];
}

// RecipeRunCondition describes the state of a dataset at a certain point.
message RecipeRunCondition {
  optional string type = 1 [(gogoproto.casttype) = "RecipeConditionType", (gogoproto.customname) = "Type", (gogoproto.nullable) = false];

  // Status of the condition, one of True, False, Unknown.
  optional string status = 2 [(gogoproto.casttype) = "k8s.io/api/core/v1.ConditionStatus", (gogoproto.customname) = "Status", (gogoproto.nullable) = false];

  // Last time the condition transitioned from one status to another.
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastTransitionTime = 3 [(gogoproto.customname) = "LastTransitionTime"];

  // The reason for the condition's last transition.
  // +kubebuilder:validation:Optional
  optional string reason = 4 [(gogoproto.customname) = "Reason", (gogoproto.nullable) = false];

  // A human readable message indicating details about the transition.
  // +kubebuilder:validation:Optional
  optional string message = 5 [(gogoproto.customname) = "Message", (gogoproto.nullable) = false];
}

// +kubebuilder:object:root=true
// RecipeRunList contains a list of Recipes
message RecipeRunList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1 [(gogoproto.customname) = "ListMeta", (gogoproto.nullable) = false];

  repeated RecipeRun items = 2 [(gogoproto.customname) = "Items", (gogoproto.nullable) = false];
}

// RecipeSpec defines the desired state of a dataset
message RecipeRunSpec {
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string versionName = 1 [(gogoproto.customname) = "VersionName"];

  // The name of the recipe that execute this run
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string recipeName = 2 [(gogoproto.customname) = "RecipeName"];

  // The execution env of this recipes
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference labRef = 3 [(gogoproto.customname) = "LabRef", (gogoproto.nullable) = false];

  // The location of the data output.
  // +required.
  optional DataLocation output = 4 [(gogoproto.customname) = "Output", (gogoproto.nullable) = false];

  // Resources are hardware resource req for a recipe run.
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ResourceSpec resources = 5 [(gogoproto.customname) = "Resources", (gogoproto.nullable) = false];

  // TTL.
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional int32 ttl = 6 [(gogoproto.customname) = "TTL"];
}

// RecipeStatus defines the observed state of Recipe
message RecipeRunStatus {
  // Represents the start time
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time startTime = 1 [(gogoproto.customname) = "StartTime"];

  // Represents the end time
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time endTime = 2 [(gogoproto.customname) = "EndTime"];

  // The phase of the dataset processing
  // +kubebuilder:default:="Pending"
  // +kubebuilder:validation:Optional
  optional string phase = 3 [(gogoproto.casttype) = "RecipeRunPhase", (gogoproto.customname) = "Phase", (gogoproto.nullable) = false];

  // ObservedGeneration is the Last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 4 [(gogoproto.customname) = "ObservedGeneration", (gogoproto.nullable) = false];

  // Update in case of terminal failure
  // Borrowed from cluster api controller
  // +kubebuilder:validation:Optional
  optional string failureReason = 5 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.StatusError", (gogoproto.customname) = "FailureReason"];

  // Update in case of terminal failure message
  // +kubebuilder:validation:Optional
  optional string failureMessage = 6 [(gogoproto.customname) = "FailureMessage"];

  // What triggered the run
  // +kubebuilder:validation:Optional
  optional string triggeredBy = 7 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.TriggerType", (gogoproto.customname) = "TriggeredBy", (gogoproto.nullable) = false];

  // Holds the location of log paths
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.Logs logs = 8 [(gogoproto.customname) = "Logs", (gogoproto.nullable) = false];

  // Last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastUpdated = 9 [(gogoproto.customname) = "LastUpdated"];

  // Test suite for this recipe
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuiteResult unitTestsResult = 10 [(gogoproto.customname) = "UnitTestsResult", (gogoproto.nullable) = false];

  // +patchMergeKey=type
  // +patchStrategy=merge
  // +kubebuilder:validation:Optional
  repeated RecipeCondition conditions = 11 [(gogoproto.customname) = "Conditions", (gogoproto.nullable) = false];
}

// RecipeSpec defines the desired state of a dataset
message RecipeSpec {
  // Owner is the owner of the recipe
  // +kubebuilder:default:="no-one"
  // +kubebuilder:validation:Optional
  optional string owner = 1 [(gogoproto.customname) = "Owner"];

  // VersionName is the data product version of the recipe
  // +kubebuilder:default:=""
  // +kubebuilder:validation:MaxLength=63
  // required.
  optional string versionName = 2 [(gogoproto.customname) = "VersionName"];

  // Description is the user provided description
  // +kubebuilder:validation:MaxLength=512
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string description = 3 [(gogoproto.customname) = "Description"];

  // Input is the input recipe spec
  optional RecipeInputSpec input = 4 [(gogoproto.customname) = "Input", (gogoproto.nullable) = false];

  // Steps are the list of recipe steps
  repeated RecipeStep steps = 5 [(gogoproto.customname) = "Steps", (gogoproto.nullable) = false];

  // Output is the desired output
  optional RecipeOutputSpec output = 6 [(gogoproto.customname) = "Output", (gogoproto.nullable) = false];

  // Sample specify the sampling paramters when viewing the recipe
  // +kubebuilder:validation:Optional
  optional SampleSpec sample = 7 [(gogoproto.customname) = "Sample", (gogoproto.nullable) = false];

  // Resource define the resource requirements to run the recipe
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ResourceSpec resources = 8 [(gogoproto.customname) = "Resources", (gogoproto.nullable) = false];

  // ActiveDeadlineSeconds is the deadline setup on jobs for this recipe.
  // +kubebuilder:default:=600
  // +kubebuilder:validation:Optional
  optional int64 activeDeadlineSeconds = 10 [(gogoproto.customname) = "ActiveDeadlineSeconds"];

  // TTL.
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional int32 ttl = 11 [(gogoproto.customname) = "TTL"];

  // Unit tests templates operating on the recipe run.
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuite unitTestsTemplate = 12 [(gogoproto.customname) = "UnitTestsTemplate", (gogoproto.nullable) = false];
}

// RecipeStatus defines the observed state of Recipe
message RecipeStatus {
  // ObservedGeneration is the Last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 1 [(gogoproto.customname) = "ObservedGeneration", (gogoproto.nullable) = false];

  // Last run is the last time a data pipeline run was created
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.LastRunStatus lastRun = 2 [(gogoproto.customname) = "LastRun", (gogoproto.nullable) = false];

  // The time of the next schedule run
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time nextRun = 3 [(gogoproto.customname) = "NextRun"];

  // Last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastUpdated = 4 [(gogoproto.customname) = "LastUpdated"];

  // +patchMergeKey=type
  // +patchStrategy=merge
  // +kubebuilder:validation:Optional
  repeated RecipeCondition conditions = 7 [(gogoproto.customname) = "Conditions", (gogoproto.nullable) = false];
}

// RecipeStep defines one step in the recipe
message RecipeStep {
  optional string op = 1 [(gogoproto.casttype) = "RecipeStepOperation", (gogoproto.customname) = "Op", (gogoproto.nullable) = false];

  repeated RecipeStepParam parameters = 2 [(gogoproto.customname) = "Parameters"];
}

// RecipeStepParam is a key value parameter of the recipe
message RecipeStepParam {
  optional string name = 1 [(gogoproto.customname) = "Name", (gogoproto.nullable) = false];

  optional string value = 2 [(gogoproto.customname) = "Value", (gogoproto.nullable) = false];
}

message RecommendationSchema {
  // The name of the column that specifies user IDs (i.e. the primary key)
  // +kubebuilder:default:="user_id"
  // +kubebuilder:validation:Optional
  optional string userIDColumn = 1 [(gogoproto.customname) = "UserID"];

  // The name of the column that specifies item IDs
  // +kubebuilder:default:="item_id"
  // +kubebuilder:validation:Optional
  optional string itemIDColumn = 2 [(gogoproto.customname) = "ItemID"];

  // The name of the column that specifies ratings
  // +kubebuilder:default:="rating"
  // +kubebuilder:validation:Optional
  optional string ratingColumn = 3 [(gogoproto.customname) = "Rating"];
}

// RelationSpec defines a relationship between two DataSource objects
message RelationshipSpec {
  // The name of the relationship
  // +kubebuilder:validation:Required
  // +required
  optional string type = 1 [(gogoproto.customname) = "Name", (gogoproto.nullable) = false];

  // The name of the columns that holds the foreign key
  optional string column = 2 [(gogoproto.customname) = "Column", (gogoproto.nullable) = false];

  // The relationship arity
  optional string arity = 3 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.RelationshipArity", (gogoproto.customname) = "Arity"];

  // The name of the other DataSource object
  // +kubebuilder:validation:Required
  // +required
  optional string relatesTo = 4 [(gogoproto.customname) = "RelatesTo", (gogoproto.nullable) = false];
}

message RowSpec {
  repeated ColumnSpec cols = 1 [(gogoproto.customname) = "Cols", (gogoproto.nullable) = false];
}

// SampleSpec specifies how the contents of a dataset should be sampled
message SampleSpec {
  // Indicates if sampling is enabled
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool enabled = 1 [(gogoproto.customname) = "Enabled"];

  // The type of sampling (random sampling, by default)
  // +kubebuilder:default:="random"
  // +kubebuilder:validation:Optional
  optional string type = 2 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.SamplingType", (gogoproto.customname) = "Type", (gogoproto.nullable) = false];

  // The number of rows to sample (by default, 500)
  // +kubebuilder:default:=500
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Optional
  optional int32 rows = 3 [(gogoproto.customname) = "Rows"];

  // The percentage of rows to sample
  // +kubebuilder:default:=100
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Optional
  optional int32 percent = 4 [(gogoproto.customname) = "Pct"];

  // The filter formula, valid only if the sample type is a filter
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string filter = 5 [(gogoproto.customname) = "Filter"];

  // The name of the column to be used for stratified sampling
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string column = 6 [(gogoproto.customname) = "Column"];
}

message ScatterPlotSpec {
  // Dataset is the name of the dataset
  // +kubebuilder:validation:Optional
  optional string datasetName = 1 [(gogoproto.customname) = "DatasetName"];

  // name of the X column
  // +kubebuilder:validation:Optional
  optional string x = 2 [(gogoproto.customname) = "X"];

  // name of the Y axis columns
  // +kubebuilder:validation:Optional
  optional string y = 3 [(gogoproto.customname) = "Y"];
}

// Schema defines the column-level format and validation rules for data associated with a DataSource
message Schema {
  // The time-series schema, which sets time-series specific parameters
  // +kubebuilder:validation:Optional
  optional TimeSeriesSchema timeSeriesSchema = 1 [(gogoproto.customname) = "TimeSeriesSchema", (gogoproto.nullable) = false];

  // The recommendation schema, which is used for the recommendation ML task
  // +kubebuilder:validation:Optional
  optional RecommendationSchema recommendationSchema = 2 [(gogoproto.customname) = "RecommendationSchema", (gogoproto.nullable) = false];

  // The collection of columns and their attributes
  // +kubebuilder:validation:Optional
  repeated Column columns = 3 [(gogoproto.customname) = "Columns", (gogoproto.nullable) = false];

  // The keys columns are the index of the file or table. The set of keys will be used as an index for the in memory representation(e.g. pandas)
  // +kubebuilder:validation:Optional
  repeated string key = 4 [(gogoproto.customname) = "Key"];
}

// SqlQuery represent a single sqlquery in the sqlquery store.
// +kubebuilder:object:root=true
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Ready",type="string",JSONPath=".status.conditions[?(@.type==\"Ready\")].status",description=""
// +kubebuilder:printcolumn:name="Owner",type="string",JSONPath=".spec.owner"
// +kubebuilder:printcolumn:name="Version",type="string",JSONPath=".spec.versionName"
// +kubebuilder:printcolumn:name="Description",type="string",JSONPath=".spec.description"
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp",description=""
// +kubebuilder:resource:path=sqlqueries,singular=sqlquery,categories={data,modela}
// +kubebuilder:subresource:status
message SqlQuery {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1 [(gogoproto.customname) = "ObjectMeta", (gogoproto.nullable) = false];

  optional SqlQuerySpec spec = 2 [(gogoproto.customname) = "Spec", (gogoproto.nullable) = false];

  // +optional
  optional SqlQueryStatus status = 3 [(gogoproto.customname) = "Status", (gogoproto.nullable) = false];
}

// SqlQueryCondition describes the state of a deployment at a certain point.
message SqlQueryCondition {
  // Type of account condition.
  optional string type = 1 [(gogoproto.casttype) = "SqlQueryConditionType", (gogoproto.customname) = "Type", (gogoproto.nullable) = false];

  // Status of the condition, one of True, False, Unknown.
  optional string status = 2 [(gogoproto.casttype) = "k8s.io/api/core/v1.ConditionStatus", (gogoproto.customname) = "Status", (gogoproto.nullable) = false];

  // Last time the condition transitioned from one status to another.
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastTransitionTime = 7 [(gogoproto.customname) = "LastTransitionTime"];

  // The reason for the condition's last transition.
  optional string reason = 4 [(gogoproto.customname) = "Reason", (gogoproto.nullable) = false];

  // A human readable message indicating details about the transition.
  optional string message = 5 [(gogoproto.customname) = "Message", (gogoproto.nullable) = false];
}

// +kubebuilder:object:root=true
// SqlQueryList contain a list of sqlquery objects
message SqlQueryList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1 [(gogoproto.customname) = "ListMeta", (gogoproto.nullable) = false];

  repeated SqlQuery items = 2 [(gogoproto.customname) = "Items", (gogoproto.nullable) = false];
}

// SqlQueryRun represent a single sqlquery in the sqlquery store.
// +kubebuilder:object:root=true
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Ready",type="string",JSONPath=".status.conditions[?(@.type==\"Ready\")].status",description=""
// +kubebuilder:printcolumn:name="Owner",type="string",JSONPath=".spec.owner"
// +kubebuilder:printcolumn:name="Version",type="string",JSONPath=".spec.versionName"
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp",description=""
// +kubebuilder:resource:path=sqlqueryruns,singular=sqlqueryrun,categories={data,modela}
// +kubebuilder:subresource:status
message SqlQueryRun {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1 [(gogoproto.customname) = "ObjectMeta", (gogoproto.nullable) = false];

  optional SqlQueryRunSpec spec = 2 [(gogoproto.customname) = "Spec", (gogoproto.nullable) = false];

  // +optional
  optional SqlQueryRunStatus status = 3 [(gogoproto.customname) = "Status", (gogoproto.nullable) = false];
}

// SqlQueryRunCondition describes the state of a deployment at a certain point.
message SqlQueryRunCondition {
  // Type of account condition.
  optional string type = 1 [(gogoproto.casttype) = "SqlQueryRunConditionType", (gogoproto.customname) = "Type", (gogoproto.nullable) = false];

  // Status of the condition, one of True, False, Unknown.
  optional string status = 2 [(gogoproto.casttype) = "k8s.io/api/core/v1.ConditionStatus", (gogoproto.customname) = "Status", (gogoproto.nullable) = false];

  // Last time the condition transitioned from one status to another.
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastTransitionTime = 7 [(gogoproto.customname) = "LastTransitionTime"];

  // The reason for the condition's last transition.
  optional string reason = 4 [(gogoproto.customname) = "Reason", (gogoproto.nullable) = false];

  // A human readable message indicating details about the transition.
  optional string message = 5 [(gogoproto.customname) = "Message", (gogoproto.nullable) = false];
}

// +kubebuilder:object:root=true
// SqlQueryRunList contain a list of sqlquery objects
message SqlQueryRunList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1 [(gogoproto.customname) = "ListMeta", (gogoproto.nullable) = false];

  repeated SqlQueryRun items = 2 [(gogoproto.customname) = "Items", (gogoproto.nullable) = false];
}

// SqlQueryRunSpec contain the desired state of a SqlQueryRun
message SqlQueryRunSpec {
  // The sqlquery owner
  // +kubebuilder:validation:Optional
  // +kubebuilder:default:="no-one"
  optional string owner = 1 [(gogoproto.customname) = "Owner"];

  // The product version for the sqlquery.
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string versionName = 2 [(gogoproto.customname) = "VersionName"];

  // Comments is a description of the sqlquery
  // +kubebuilder:validation:Optional
  // +kubebuilder:default:=""
  // +kubebuilder:validation:MaxLength=512
  optional string description = 3 [(gogoproto.customname) = "Description"];

  // Database
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string database = 4 [(gogoproto.customname) = "Database"];

  // If true this table
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool table = 5 [(gogoproto.customname) = "Table"];

  // Type name of the column key, this column is the key column in the entity.
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string sqlOrTable = 6 [(gogoproto.customname) = "SqlOrTable"];

  // The name of the connection to the SQL data source
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string connectionName = 7 [(gogoproto.customname) = "ConnectionName"];

  // Resources is the hardware resource req.
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ResourceSpec resources = 8 [(gogoproto.customname) = "Resources", (gogoproto.nullable) = false];

  // ActiveDeadlineSeconds is the deadline of a job for this dataset.
  // +kubebuilder:default:=600
  // +kubebuilder:validation:Minimum=0
  // +kubebuilder:validation:Optional
  optional int64 activeDeadlineSeconds = 9 [(gogoproto.customname) = "ActiveDeadlineSeconds"];

  // The priority of this prediction. The default is medium.
  // +kubebuilder:default:=medium
  // +kubebuilder:validation:Optional
  optional string priority = 10 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.PriorityLevel", (gogoproto.customname) = "Priority"];

  // Aborted is set when we want to abort the prediction
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool aborted = 11 [(gogoproto.customname) = "Aborted"];

  // If true save the query results
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool materialized = 12 [(gogoproto.customname) = "Materialized"];

  // If true generate a report each time the web request is executed
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool reported = 13 [(gogoproto.customname) = "Reported"];

  // The source web request
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string sqlQueryName = 14 [(gogoproto.customname) = "SqlQueryName"];

  // The execution env of this recipes
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference labRef = 15 [(gogoproto.customname) = "LabRef", (gogoproto.nullable) = false];

  // unit tests on the result
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuite unitTests = 16 [(gogoproto.customname) = "UnitTests", (gogoproto.nullable) = false];
}

// SqlQueryRunStatus defines the observed state of SqlQueryRun
message SqlQueryRunStatus {
  // StartTime is the start time of the prediction.
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time startTime = 1 [(gogoproto.customname) = "StartTime"];

  // EndTime is the end time of the prediction.
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time endTime = 2 [(gogoproto.customname) = "EndTime"];

  // Phase is the current phase of the prediction
  // +kubebuilder:default:="Pending"
  // +kubebuilder:validation:Optional
  optional string phase = 3 [(gogoproto.casttype) = "SqlQueryRunPhase", (gogoproto.customname) = "Phase", (gogoproto.nullable) = false];

  // ObservedGeneration is the Last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 4 [(gogoproto.customname) = "ObservedGeneration", (gogoproto.nullable) = false];

  // The number of rows in the result query
  // +kubebuilder:validation:Optional
  optional int32 rows = 5 [(gogoproto.customname) = "Rows", (gogoproto.nullable) = false];

  // What triggered the run
  // +kubebuilder:validation:Optional
  optional string triggeredBy = 6 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.TriggerType", (gogoproto.customname) = "TriggeredBy", (gogoproto.nullable) = false];

  // Holds the location of log paths
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.Logs logs = 7 [(gogoproto.customname) = "Logs", (gogoproto.nullable) = false];

  // The location of the materialized view
  // +kubebuilder:validation:Optional
  optional DataLocation location = 9 [(gogoproto.customname) = "Location", (gogoproto.nullable) = false];

  // The name of the report object.
  optional string reportName = 10 [(gogoproto.customname) = "ReportName", (gogoproto.nullable) = false];

  // Last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastUpdated = 11 [(gogoproto.customname) = "LastUpdated"];

  // Update in case of terminal failure
  // Borrowed from cluster api controller
  // +kubebuilder:validation:Optional
  optional string failureReason = 12 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.StatusError", (gogoproto.customname) = "FailureReason"];

  // Update in case of terminal failure message
  // +kubebuilder:validation:Optional
  optional string failureMessage = 13 [(gogoproto.customname) = "FailureMessage"];

  // The unit tests results.
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuiteResult unitTestsResult = 16 [(gogoproto.customname) = "UnitTestsResult", (gogoproto.nullable) = false];

  // +patchMergeKey=type
  // +patchStrategy=merge
  // +kubebuilder:validation:Optional
  repeated SqlQueryRunCondition conditions = 14 [(gogoproto.customname) = "Conditions", (gogoproto.nullable) = false];
}

// SqlQuerySpec contain the desired state of a SqlQuery
message SqlQuerySpec {
  // The sqlquery owner
  // +kubebuilder:validation:Optional
  // +kubebuilder:default:="no-one"
  optional string owner = 1 [(gogoproto.customname) = "Owner"];

  // The product version for the sqlquery.
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string versionName = 2 [(gogoproto.customname) = "VersionName"];

  // Description of the cron query
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string description = 3 [(gogoproto.customname) = "Description"];

  // The sql template to create.
  // +kubebuilder:validation:Optional
  optional SqlQueryRunSpec template = 4 [(gogoproto.customname) = "Template", (gogoproto.nullable) = false];

  // Schedule for running the sql query
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.RunSchedule schedule = 5 [(gogoproto.customname) = "Schedule", (gogoproto.nullable) = false];
}

// SqlQueryStatus defines the observed state of SqlQuery
message SqlQueryStatus {
  // Last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastUpdated = 1 [(gogoproto.customname) = "LastUpdated"];

  // ObservedGeneration is the Last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 2 [(gogoproto.customname) = "ObservedGeneration", (gogoproto.nullable) = false];

  // Last run is the last time a data pipeline run was created
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.LastRunStatus lastRun = 3 [(gogoproto.customname) = "LastRun", (gogoproto.nullable) = false];

  // The time of the next schedule run
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time nextRun = 4 [(gogoproto.customname) = "NextRun"];

  // +patchMergeKey=type
  // +patchStrategy=merge
  // +kubebuilder:validation:Optional
  repeated SqlQueryCondition conditions = 7 [(gogoproto.customname) = "Conditions", (gogoproto.nullable) = false];
}

message SyntheticSpec {
  // Enabled syntatic data
  // +kubebuilder:validation:Optional
  optional bool enabled = 1 [(gogoproto.customname) = "Enabled"];

  // The number of top correlations to be included in the correlation results
  // +kubebuilder:default:=0
  // +kubebuilder:validation:Optional
  optional int32 rows = 2 [(gogoproto.customname) = "Rows"];
}

message TableSpec {
  // Dataset is the name of the dataset
  // +kubebuilder:validation:Optional
  optional string datasetName = 1 [(gogoproto.customname) = "DatasetName"];

  // List of table columns, if empty use call the columns
  // +kubebuilder:validation:Optional
  repeated string columns = 2 [(gogoproto.customname) = "Columns"];

  // one or more filters
  // +kubebuilder:validation:Optional
  repeated string filters = 3 [(gogoproto.customname) = "Filters"];

  // Groupby columns
  // +kubebuilder:validation:Optional
  repeated string groupby = 4 [(gogoproto.customname) = "GroupBy"];

  // Row is the row number
  // +kubebuilder:validation:Optional
  optional int32 rows = 5 [(gogoproto.customname) = "Rows"];

  // Show index column
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool showIndex = 6 [(gogoproto.customname) = "ShowIndex"];

  // Show borther
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool border = 7 [(gogoproto.customname) = "Border"];
}

message TimeSeriesSchema {
  // The time series type
  // +kubebuilder:default:="series"
  // +kubebuilder:validation:Optional
  optional string type = 1 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.TimeSeriesType", (gogoproto.customname) = "Type"];

  // The time series frequency
  // +kubebuilder:default:="day"
  // +kubebuilder:validation:Optional
  optional string freq = 2 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.Freq", (gogoproto.customname) = "Freq"];

  // The interval to forecast at this level
  // +kubebuilder:default:=1
  // +kubebuilder:validation:Optional
  optional int32 interval = 3 [(gogoproto.customname) = "Interval"];
}

// WebRequest represent a single sqlquery in the sqlquery store.
// +kubebuilder:object:root=true
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Ready",type="string",JSONPath=".status.conditions[?(@.type==\"Ready\")].status",description=""
// +kubebuilder:printcolumn:name="Owner",type="string",JSONPath=".spec.owner"
// +kubebuilder:printcolumn:name="Version",type="string",JSONPath=".spec.versionName"
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp",description=""
// +kubebuilder:resource:path=webrequests,singular=webrequest,categories={data,modela}
// +kubebuilder:subresource:status
message WebRequest {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1 [(gogoproto.customname) = "ObjectMeta", (gogoproto.nullable) = false];

  optional WebRequestSpec spec = 2 [(gogoproto.customname) = "Spec", (gogoproto.nullable) = false];

  // +optional
  optional WebRequestStatus status = 3 [(gogoproto.customname) = "Status", (gogoproto.nullable) = false];
}

// WebRequestCondition describes the state of a deployment at a certain point.
message WebRequestCondition {
  // Type of account condition.
  optional string type = 1 [(gogoproto.casttype) = "WebRequestConditionType", (gogoproto.customname) = "Type", (gogoproto.nullable) = false];

  // Status of the condition, one of True, False, Unknown.
  optional string status = 2 [(gogoproto.casttype) = "k8s.io/api/core/v1.ConditionStatus", (gogoproto.customname) = "Status", (gogoproto.nullable) = false];

  // Last time the condition transitioned from one status to another.
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastTransitionTime = 7 [(gogoproto.customname) = "LastTransitionTime"];

  // The reason for the condition's last transition.
  optional string reason = 4 [(gogoproto.customname) = "Reason", (gogoproto.nullable) = false];

  // A human readable message indicating details about the transition.
  optional string message = 5 [(gogoproto.customname) = "Message", (gogoproto.nullable) = false];
}

// +kubebuilder:object:root=true
// WebRequestList contain a list of sqlquery objects
message WebRequestList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1 [(gogoproto.customname) = "ListMeta", (gogoproto.nullable) = false];

  repeated WebRequest items = 2 [(gogoproto.customname) = "Items", (gogoproto.nullable) = false];
}

// WebRequestRun represent a single webrequest in the webrequest store.
// +kubebuilder:object:root=true
// +kubebuilder:storageversion
// +kubebuilder:printcolumn:name="Ready",type="string",JSONPath=".status.conditions[?(@.type==\"Ready\")].status",description=""
// +kubebuilder:printcolumn:name="Owner",type="string",JSONPath=".spec.owner"
// +kubebuilder:printcolumn:name="Version",type="string",JSONPath=".spec.versionName"
// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp",description=""
// +kubebuilder:resource:path=webrequestruns,singular=webrequestrun,categories={data,modela}
// +kubebuilder:subresource:status
message WebRequestRun {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ObjectMeta metadata = 1 [(gogoproto.customname) = "ObjectMeta", (gogoproto.nullable) = false];

  optional WebRequestRunSpec spec = 2 [(gogoproto.customname) = "Spec", (gogoproto.nullable) = false];

  // +optional
  optional WebRequestRunStatus status = 3 [(gogoproto.customname) = "Status", (gogoproto.nullable) = false];
}

// WebRequestRunCondition describes the state of a deployment at a certain point.
message WebRequestRunCondition {
  // Type of account condition.
  optional string type = 1 [(gogoproto.casttype) = "WebRequestRunConditionType", (gogoproto.customname) = "Type", (gogoproto.nullable) = false];

  // Status of the condition, one of True, False, Unknown.
  optional string status = 2 [(gogoproto.casttype) = "k8s.io/api/core/v1.ConditionStatus", (gogoproto.customname) = "Status", (gogoproto.nullable) = false];

  // Last time the condition transitioned from one status to another.
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastTransitionTime = 7 [(gogoproto.customname) = "LastTransitionTime"];

  // The reason for the condition's last transition.
  optional string reason = 4 [(gogoproto.customname) = "Reason", (gogoproto.nullable) = false];

  // A human readable message indicating details about the transition.
  optional string message = 5 [(gogoproto.customname) = "Message", (gogoproto.nullable) = false];
}

// +kubebuilder:object:root=true
// WebRequestRunList contain a list of webrequest objects
message WebRequestRunList {
  optional k8s.io.apimachinery.pkg.apis.meta.v1.ListMeta metadata = 1 [(gogoproto.customname) = "ListMeta", (gogoproto.nullable) = false];

  repeated WebRequestRun items = 2 [(gogoproto.customname) = "Items", (gogoproto.nullable) = false];
}

// WebRequestRunSpec contain the desired state of a WebRequestRun
message WebRequestRunSpec {
  // The webrequest owner
  // +kubebuilder:validation:Optional
  // +kubebuilder:default:="no-one"
  optional string owner = 1 [(gogoproto.customname) = "Owner"];

  // The product version for the webrequest.
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string versionName = 2 [(gogoproto.customname) = "VersionName"];

  // Comments is a description of the webrequest
  // +kubebuilder:validation:Optional
  // +kubebuilder:default:=""
  // +kubebuilder:validation:MaxLength=512
  optional string description = 3 [(gogoproto.customname) = "Description"];

  // Type name of the column key, this column is the key column in the entity.
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string query = 4 [(gogoproto.customname) = "URL"];

  // HTTP Verb to use
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string verb = 5 [(gogoproto.customname) = "Verb"];

  // URL Parameters
  // +kubebuilder:validation:Optional
  map<string, string> parameters = 6 [(gogoproto.customname) = "Parameters", (gogoproto.nullable) = false];

  // The Http headers to use
  // +kubebuilder:validation:Optional
  map<string, string> headers = 7 [(gogoproto.customname) = "Headers", (gogoproto.nullable) = false];

  // The name of the connection to the data source.
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string connectionName = 8 [(gogoproto.customname) = "ConnectionName"];

  // The WebRequest statement timeout
  // +kubebuilder:default:=3600
  // +kubebuilder:validation:Optional
  optional int32 timeout = 9 [(gogoproto.customname) = "Timeout"];

  // If true save the query results
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool materialized = 10 [(gogoproto.customname) = "Materialized"];

  // If true generate a report each time the web request is executed
  // +kubebuilder:default:=false
  // +kubebuilder:validation:Optional
  optional bool reported = 11 [(gogoproto.customname) = "Reported"];

  // Resources is the hardware resource req.
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.ResourceSpec resources = 12 [(gogoproto.customname) = "Resources", (gogoproto.nullable) = false];

  // The source web request
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string webRequestName = 13 [(gogoproto.customname) = "WebRequestName"];

  // The execution env of this web request run.
  // If none, use the default lab from the data product
  // +kubebuilder:validation:Optional
  optional k8s.io.api.core.v1.ObjectReference labRef = 14 [(gogoproto.customname) = "LabRef", (gogoproto.nullable) = false];

  // unit tests on the result
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuite unitTests = 15 [(gogoproto.customname) = "UnitTests", (gogoproto.nullable) = false];
}

// WebRequestRunStatus defines the observed state of WebRequestRun
message WebRequestRunStatus {
  // StartTime is the start time of the prediction.
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time startTime = 1 [(gogoproto.customname) = "StartTime"];

  // EndTime is the end time of the prediction.
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time endTime = 2 [(gogoproto.customname) = "EndTime"];

  // Phase is the current phase of the prediction
  // +kubebuilder:default:="Pending"
  // +kubebuilder:validation:Optional
  optional string phase = 3 [(gogoproto.casttype) = "WebRequestRunPhase", (gogoproto.customname) = "Phase", (gogoproto.nullable) = false];

  // ObservedGeneration is the Last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 4 [(gogoproto.customname) = "ObservedGeneration", (gogoproto.nullable) = false];

  // The number of rows in the result query
  // +kubebuilder:validation:Optional
  optional int32 rows = 5 [(gogoproto.customname) = "Rows", (gogoproto.nullable) = false];

  // What triggered the run
  // +kubebuilder:validation:Optional
  optional string triggeredBy = 6 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.TriggerType", (gogoproto.customname) = "TriggeredBy", (gogoproto.nullable) = false];

  // The result of the HTTP execution
  // +kubebuilder:validation:Optional
  optional int32 httpResultCode = 7 [(gogoproto.customname) = "HttpResultCode", (gogoproto.nullable) = false];

  // The location of the result
  // +kubebuilder:validation:Optional
  optional DataLocation resultLocation = 8 [(gogoproto.customname) = "Location", (gogoproto.nullable) = false];

  // The name of the report object.
  // +kubebuilder:validation:Optional
  optional string reportName = 9 [(gogoproto.customname) = "ReportName", (gogoproto.nullable) = false];

  // Update in case of terminal failure
  // Borrowed from cluster api controller
  // +kubebuilder:validation:Optional
  optional string failureReason = 10 [(gogoproto.casttype) = "github.com/metaprov/modelaapi/pkg/apis/catalog/v1alpha1.StatusError", (gogoproto.customname) = "FailureReason"];

  // Update in case of terminal failure message
  // +kubebuilder:validation:Optional
  optional string failureMessage = 11 [(gogoproto.customname) = "FailureMessage"];

  // Holds the location of log paths
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.Logs logs = 12 [(gogoproto.customname) = "Logs", (gogoproto.nullable) = false];

  // Last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastUpdated = 13 [(gogoproto.customname) = "LastUpdated"];

  // The unit tests results.
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.TestSuiteResult unitTestsResult = 14 [(gogoproto.customname) = "UnitTestsResult", (gogoproto.nullable) = false];

  // +patchMergeKey=type
  // +patchStrategy=merge
  // +kubebuilder:validation:Optional
  repeated WebRequestRunCondition conditions = 15 [(gogoproto.customname) = "Conditions", (gogoproto.nullable) = false];
}

// WebRequestSpec contain the desired state of a WebRequest
message WebRequestSpec {
  // The sqlquery owner
  // +kubebuilder:validation:Optional
  // +kubebuilder:default:="no-one"
  optional string owner = 1 [(gogoproto.customname) = "Owner"];

  // The product version for the sqlquery.
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string versionName = 2 [(gogoproto.customname) = "VersionName"];

  // Description of the cron api call
  // +kubebuilder:default:=""
  // +kubebuilder:validation:Optional
  optional string description = 3 [(gogoproto.customname) = "Description"];

  // The sql template to create.
  // +kubebuilder:validation:Optional
  optional WebRequestRunSpec template = 4 [(gogoproto.customname) = "Template", (gogoproto.nullable) = false];

  // Schedule for running the sql query
  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.RunSchedule schedule = 5 [(gogoproto.customname) = "Schedule", (gogoproto.nullable) = false];
}

// WebRequestStatus defines the observed state of WebRequest
message WebRequestStatus {
  // Last time the object was updated
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time lastUpdated = 1 [(gogoproto.customname) = "LastUpdated"];

  // ObservedGeneration is the Last generation that was acted on
  // +kubebuilder:validation:Optional
  optional int64 observedGeneration = 2 [(gogoproto.customname) = "ObservedGeneration", (gogoproto.nullable) = false];

  // +kubebuilder:validation:Optional
  optional github.com.metaprov.modelaapi.pkg.apis.catalog.v1alpha1.LastRunStatus lastRun = 3 [(gogoproto.customname) = "LastRun", (gogoproto.nullable) = false];

  // The time of the next schedule run
  // +kubebuilder:validation:Optional
  optional k8s.io.apimachinery.pkg.apis.meta.v1.Time nextRun = 4 [(gogoproto.customname) = "NextRun"];

  // +patchMergeKey=type
  // +patchStrategy=merge
  // +kubebuilder:validation:Optional
  repeated WebRequestCondition conditions = 7 [(gogoproto.customname) = "Conditions", (gogoproto.nullable) = false];
}

